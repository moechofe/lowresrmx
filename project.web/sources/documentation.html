<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
<title>Retro Game Creator - Documentation</title>
<style>
a { color: #36b; }
a:visited { color: #639; }
body { font-family: 'Baskerville', 'Libre Baskerville', serif; font-size: 1.3em; margin: 0; background: #f7f2ed; }
h1, h2, h3, h4 { margin: 2.0em 0 1em 0; background: #639; color: #fff; padding: 0.5em 1em 0.4em 1em; }
body h1 { margin-top: 0; }
p { margin: 1em; }
blockquote { margin: 1em 0; border-left: solid 1em #c66; padding: 0.2em 0.4em; background-color: #f2d9d9; font-style: italic; }
code { background-color: #927353; color: #fff; padding: 0.2em 0.3em; margin: -0.2em 0.1em; border-radius: 0.3em; text-decoration: none; }
a code { text-decoration: underline solid 1px #fff; }
del { text-decoration-color: #fff; }
del code { background-color: #a35; }
h4 { background-color: #e94; color: #420; }
h4>code { background-color: unset; color: unset; padding: unset; margin: 0; border-radius: unset; font-size: 1.5em; }
code+code { display: inline-block; }
pre { white-space: pre-wrap; font-family: 'Menlon-Regular', monospace; margin: 0; background-color: #dad0c6; padding: 0.5em 1em; display: inline-block; -moz-tab-size:2; -o-tab-size:2; tab-size:2; border-top-right-radius: 0.3em; border-bottom-right-radius: 0.3em; }
pre>code { padding: 0; margin: 0; background-color: unset; color: #000; }
blockquote>pre { margin-left: 1em; }
ul { padding-left: 2em; }
ul li>pre { margin-left: -2em; padding-left: 2.0em; }
ol li>pre { margin-left: -2em; padding-left: 2.5em; }
blockquote pre,blockquote code { background-color: #c66; font-style: normal; }
table { border-collapse: collapse; margin: 0 1em; display: inline-block; }
table+table { margin-left: 2em; vertical-align:top; }
td, th { padding: 0.2em 0.8em; text-align: left; }
tbody>tr, tr+tr { border-top: solid 0.1em #b8a189; }
hr { border: none; border-top: solid 0.15em #639; margin: 1em; }
</style>
</head>
<body>



<!-- Tool: https://markdowntohtml.com/ -->
<!-- remove antislash for br and hr tag -->
<!-- & # 39; ' -->
<!-- fix table -->

<h1 id="retro-game-creator-documentation">Retro Game Creator - Documentation</h1>
<blockquote>
<p>This is a fork of the excellent fantasy console Lowres NX by Timo &quot;Inutilis&quot; Kloss.<br>
This is a heavily modified version and way more complicated to use, I recommend you to stay on the original app:<br>
üåê<a href="https://apps.apple.com/app/lowres-nx-coder/id1318884577">LowRes NX Coder on App Store</a>.</p>
</blockquote>
<h2 id="what-is-retro-game-creator-">What is Retro Game Creator?</h2>
<p>Create games and play them on the go using an iPhone or iPad. Retro Game Creator is a virtual game console and game development environment that includes all the tools needed to start and finish a project.</p>
<p>It includes a project manager, a code editor, and various tools to edit game assets: sprites, palettes, backgrounds, instruments, and music.</p>
<p>Retro Game Creator simulates a virtual retro game console directly inside your device, allowing users to create, play, and share their games.</p>
<p>It emulates old-school 8-bit/16-bit console hardware by replicating their limitations: a low number of colors, limited memory, and slow processing power.</p>
<h2 id="difference">Difference</h2>
<p>The goal of the app is to provide a development environment that I can use during my commutes on the subway, and later, to be able to publish a real app on the stores.</p>
<p>The original LowRes NX, despite being an excellent development environment, lacks some capabilities needed for use on a handheld device.</p>
<blockquote>
<p>If you already know how to use Lowres NX, you can read the list of differences below.<br>
For new users, I recommend jumping to the <a href="#how-does-it-work">How does it work</a> section.</p>
</blockquote>
<p><strong>Background:</strong></p>
<ul>
<li><p><a href="#backgrounds">4 background layers</a> instead of 2, with 64x64 cells instead of 32x32.</p>
</li>
<li><p>Support for large 16x16 pixel cells has been removed.</p>
<p>  Removed syntaxes: <del><code>CELL SIZE</code></del>.</p>
</li>
<li><p>The <a href="#flip-horizontalvertical"><code>FLIP</code> command now takes optional arguments</a>.</p>
</li>
<li><p>New settings with the <code>SYSTEM</code> command to <a href="#system-settingvalue">render a layer at double size</a>.</p>
</li>
<li><p>Internal scroll offset is no longer capped at 512, but at 0xFFFF.</p>
</li>
</ul>
<p><strong>Screen:</strong></p>
<ul>
<li><p>A new <a href="#screen">fantasy screen</a> with a maximum resolution of 216x384 pixels.</p>
</li>
<li><p>New functions to <a href="#widthshownwheightshownh">retrieve the visible fantasy display size</a>.</p>
</li>
<li><p>New functions to <a href="#leftsafeltopsafetrightsaferbottomsafeb">query the safe area offset</a>.</p>
</li>
<li><p>Removed commands and functions: <del><code>DISPLAY</code></del>.</p>
</li>
</ul>
<p><strong>Colors:</strong></p>
<ul>
<li><p>The 64 available colors <a href="#colors">do not follow the original EGA style</a> of LowRes NX.</p>
<blockquote>
<p>This makes using the color chooser from the original &quot;Gfx Designer&quot; in LowRes NX a bit more challenging.</p>
</blockquote>
</li>
<li><p>New settings with the <code>SYSTEM</code> command to make <a href="#system-settingvalue">color <code>0</code> for a layer opaque</a> instead of transparent.</p>
</li>
</ul>
<p><strong>Sprites:</strong></p>
<ul>
<li><p>170 sprites instead of 64. Sprite numbers range from 0 to 169.</p>
</li>
<li><p>Positions support sub-pixels with 1/16 pixel precision.</p>
<pre><code>  sprite <span class="hljs-number">123</span>,sprite.x(<span class="hljs-number">123</span>)+<span class="hljs-number">0.25</span>,
</code></pre></li>
</ul>
<p><strong>Input/Output:</strong></p>
<ul>
<li><p><a href="#xtouchxytouchy">Touch coordinates return floating-point</a> values instead of integers.</p>
</li>
<li><p>The virtual controller and the ability to use a Bluetooth controller have been removed.</p>
<p>  Removed gamepad related functions: <del><code>=BUTTON(p,n)</code></del>, <del><code>=UP(p)</code></del>, <del><code>=DOWN(p)</code></del>, <del><code>=LEFT(p)</code></del>, <del><code>=RIGHT(p)</code></del>, <del><code>GAMEPAD n</code></del>.</p>
<p>  Removed useless commands: <del><code>TOUCHSCREEN</code></del>, <del><code>KEYBOARD OPTIONAL</code></del></p>
</li>
<li><p>When the device's virtual keyboard is hidden by the user, the corresponding I/O <a href="#registers">Registers</a> flag is updated (see <a href="#other-io-status-bits">Other I/O status bits</a>).</p>
</li>
<li><p>New syntax to <a href="#wait-tap">wait until device screen is tapped</a>.</p>
</li>
<li><p>New function that returns <a href="#heightkeyboard">the height taken by the device virtual keyboard</a> in pixels when it's visible.</p>
</li>
<li><p>New <code>HAPTIC</code> command to <a href="#haptic-pattern">trigger haptic feedback</a> on the device.</p>
</li>
</ul>
<p><strong>Control flow:</strong></p>
<ul>
<li>New program control flow: <a href="#on-goto"><code>ON GOTO</code></a>, <a href="#on-gosub"><code>ON GOSUB</code></a> and <a href="#on-restore"><code>ON RESTORE</code></a>.</li>
</ul>
<p><strong>Data:</strong></p>
<ul>
<li><p>New keyword to <a href="#skip-number">skip read data</a>.</p>
</li>
<li><p>It's now possible to <a href="#labels">access data directly using its label</a> without the need to <code>READ</code> them.</p>
</li>
</ul>
<p><strong>Math:</strong></p>
<ul>
<li><p><a href="#cosinecosnumbersinesinnumber">Cosine, sine</a> and <a href="#arcatanxy">arc tangent</a> functions internally replace œÄ with 0.5.</p>
<blockquote>
<p>Pico-8 uses the same approach.</p>
</blockquote>
<ul>
<li>An angle of 0.0 or 1.0 represents the right direction.</li>
<li>An angle of 0.5 represents the left direction.</li>
<li>An angle of 0.25 represents the top direction.</li>
<li>An angle of -0.25 represents the bottom direction.</li>
</ul>
</li>
<li><p>Removed trigonometric functions: <del><code>ACOS</code></del>, <del><code>ASIN</code></del>, <del><code>HCOS</code></del>, <del><code>HSIN</code></del>, <del><code>HTAN</code></del>.</p>
</li>
<li><p>New function to return the <a href="#ceilceilnumber">ceiling value</a> of a numerical value.</p>
</li>
<li><p>New function to return the <a href="#floorfloornumber">flooring value</a> of a numerical value.</p>
</li>
<li><p>New function to <a href="#clampedclampvalueminmax">clamp a numerical value</a>.</p>
</li>
<li><p>New syntax to compute <a href="#lengthlengthxy">vector length</a>.</p>
</li>
<li><p>New function to compute <a href="#interpolationeasefunctionmodevalue">easing function</a>.</p>
</li>
<li><p>New random generator using üåê<a href="https://www.pcg-random.org/">PCG</a>. It produces better randomness.</p>
</li>
<li><p>New syntax to generate random numbers that allows <a href="#randomrnd-addressbrrandomrndmaxaddressbrrandomize-seedaddress">saving the current state</a>.</p>
</li>
</ul>
<p><strong>Text:</strong></p>
<ul>
<li><p>New command to expose the existing <a href="#message-text">overlay message API</a>.</p>
</li>
<li><p><code>PRINT</code> command can now <a href="#print-expression-list">word wrap before breaking words</a>.</p>
<p>  If there is not enough space to print a word inside the window, a new line is inserted to avoid breaking the word in two.</p>
</li>
</ul>
<p><strong>Other:</strong></p>
<ul>
<li><p>New command to <a href="#compat">support programs from the original LowRes NX</a>.</p>
</li>
<li><p>Reuse the <code>PAUSE</code> command to access the <a href="#pause">internal debugger</a>.</p>
</li>
<li><p>Removed commands and functions: <del><code>PAUSE ON/OFF</code></del>, <del><code>PAUSE=</code></del>.</p>
</li>
<li><p>Removed reserved keywords: <del><code>ANIM</code></del>, <del><code>CLOSE</code></del>, <del><code>DECLARE</code></del>, <del><code>DEF</code></del>, <del><code>FLASH</code></del>, <del><code>FN</code></del>, <del><code>FUNCTION</code></del>, <del><code>LBOUND</code></del>, <del><code>OPEN</code></del>, <del><code>OUTPUT</code></del>, <del><code>SHARED</code></del>, <del><code>STATIC</code></del>, <del><code>TEMPO</code></del>, <del><code>VOICE</code></del>, <del><code>WRITE</code></del>.</p>
</li>
</ul>
<p><strong>Memory:</strong></p>
<ul>
<li><p>An almost compatible memory mapping.</p>
<p>  The total addressable memory has increased from 64 Kibit to 128 Kibit.</p>
<p>  Lowres NX:</p>
<table>
<thead>
<tr>
<th style="text-align:right">addr</th>
<th>size</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right"><code>$0000</code></td>
<td>32 Kibit</td>
<td>Cartridge ROM</td>
</tr>
<tr>
<td style="text-align:right"><code>$8000</code></td>
<td>4 Kibit</td>
<td>Character Data</td>
</tr>
<tr>
<td style="text-align:right"><code>$9000</code></td>
<td>2 Kibit</td>
<td>BG0 Data</td>
</tr>
<tr>
<td style="text-align:right"><code>$9800</code></td>
<td>2 Kibit</td>
<td>BG1 Data</td>
</tr>
<tr>
<td style="text-align:right"><code>$A000</code></td>
<td>16 Kibit</td>
<td>Working RAM</td>
</tr>
<tr>
<td style="text-align:right"><code>$E000</code></td>
<td>4 Kibit</td>
<td>Persistent RAM</td>
</tr>
<tr>
<td style="text-align:right"><code>$FE00</code></td>
<td>256 Bytes</td>
<td>Sprite Registers</td>
</tr>
<tr>
<td style="text-align:right"><code>$FF00</code></td>
<td>32 Bytes</td>
<td>Color Registers</td>
</tr>
<tr>
<td style="text-align:right"><code>$FF20</code></td>
<td></td>
<td>Video Registers</td>
</tr>
<tr>
<td style="text-align:right"><code>$FF40</code></td>
<td></td>
<td>Audio Registers</td>
</tr>
<tr>
<td style="text-align:right"><code>$FF70</code></td>
<td></td>
<td>I/O Registers</td>
</tr>
</tbody>
</table>
<p>Retro Game Creator:</p>
<table>
<thead>
<tr>
<th style="text-align:right">addr</th>
<th>size</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right"><code>$0000</code></td>
<td>8 Kibit</td>
<td>BG0 data</td>
</tr>
<tr>
<td style="text-align:right"><code>$2000</code></td>
<td>8 Kibit</td>
<td>BG1 data</td>
</tr>
<tr>
<td style="text-align:right"><code>$4000</code></td>
<td>8 Kibit</td>
<td>BG2 data</td>
</tr>
<tr>
<td style="text-align:right"><code>$6000</code></td>
<td>8 Kibit</td>
<td>BG3 data</td>
</tr>
<tr>
<td style="text-align:right"><code>$8000</code></td>
<td>4 Kibit</td>
<td>Character Data</td>
</tr>
<tr>
<td style="text-align:right"><code>$9000</code></td>
<td>20 Kibit</td>
<td>Working RAM</td>
</tr>
<tr>
<td style="text-align:right"><code>$E000</code></td>
<td>6 Kibit</td>
<td>Persistent RAM</td>
</tr>
<tr>
<td style="text-align:right"><code>$FB00</code></td>
<td>1020 Bytes</td>
<td>Sprite registers</td>
</tr>
<tr>
<td style="text-align:right"><code>$FF00</code></td>
<td>32 Bytes</td>
<td>Color registers</td>
</tr>
<tr>
<td style="text-align:right"><code>$FF20</code></td>
<td>10 Bytes</td>
<td>Video registers</td>
</tr>
<tr>
<td style="text-align:right"><code>$FF40</code></td>
<td>48 Bytes</td>
<td>Audio registers</td>
</tr>
<tr>
<td style="text-align:right"><code>$FF70</code></td>
<td>40 Bytes</td>
<td>I/O registers</td>
</tr>
<tr>
<td style="text-align:right"><code>$FFA0</code></td>
<td>6 Bytes</td>
<td>DMA registers</td>
</tr>
<tr>
<td style="text-align:right"><code>$10000</code></td>
<td>64 Kibit</td>
<td>Cartridge ROM</td>
</tr>
</tbody>
</table>
</li>
</ul>
<ul>
<li><p>New command and registers for <a href="#dma-copy-rom">fast memory copying</a>:</p>
</li>
<li><p>The <code>COPY</code> command is now slightly faster. Other command that operates on memory are not affected.</p>
</li>
</ul>
<p><strong>The BASIC language:</strong></p>
<ul>
<li><p>A colon <code>:</code> can be used to <a href="#instructions-separator">separate multiple instructions</a> on the same line.</p>
</li>
<li><p>Program code is not forced to be uppercase anymore.</p>
</li>
</ul>
<p><strong>The iOS app:</strong></p>
<ul>
<li>The size of the program thumbnails are 128x128 pixels.</li>
</ul>
<p><strong>The fantasy hardware:</strong></p>
<ul>
<li><p>The number of tokens, symbols a program can have has been increased.</p>
</li>
<li><p>The number of CPU-cycles a program can execute per frame, per vbl and per raster has been increased to accommodate with the bigger screen size.</p>
</li>
</ul>
<p><strong>Particles:</strong></p>
<blockquote>
<p><strong>Work in progress:</strong> The particle system is under development and everything is subject to change.</p>
</blockquote>
<p>The particles library reuses sprites to make them appear, disappear, change their character data, and move them across the screen.</p>
<hr>
<p><code>PARTICLE first,count AT address</code></p>
<p>Declare the use of <code>count</code> sprites starting from <code>first</code> and store the internal data at <code>address</code>.</p>
<p>Each sprite will consume 6 bytes of memory. For each sprite:</p>
<table>
<thead>
<tr>
<th style="text-align:right">addr</th>
<th>size</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">+0</td>
<td>2 Bytes</td>
<td>Speed on x axis</td>
</tr>
<tr>
<td style="text-align:right">+2</td>
<td>2 Bytes</td>
<td>Speed on y axis</td>
</tr>
<tr>
<td style="text-align:right">+4</td>
<td>1 Byte</td>
<td>Appearence</td>
</tr>
<tr>
<td style="text-align:right">+5</td>
<td>1 Byte</td>
<td>Current frame</td>
</tr>
<tr>
<td style="text-align:right">+4</td>
<td>2 Bytes</td>
<td>Lifetime</td>
</tr>
</tbody>
</table>
<p>e.g.:</p>
<pre><code>PARTICLE <span class="hljs-number">1</span>,<span class="hljs-number">20</span> AT $<span class="hljs-number">9000</span>
'Will use sprite <span class="hljs-number">1</span> to <span class="hljs-number">20</span> included.
'Store internal data from $<span class="hljs-number">9000</span> to $<span class="hljs-number">9078</span> excluded.
</code></pre><hr>
<p><code>PARTICLE appearance DATA label</code></p>
<p>Declare a <code>label</code> that contains data for the particle <code>appearance</code>.</p>
<p><code>appearance</code> is a number between <code>0</code> and <code>23</code>.</p>
<p>The associated data MUST contain a list of character numbers that will be used to draw the particle. Using a negative number will loop back to the previous data value.</p>
<p>A common example is to use zero (0) and minus one (-1) for the last two data values, which allows the particle to disappear until the sprite is reused.</p>
<p>e.g.:</p>
<pre><code>my_appearance:
data <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">0</span>,-<span class="hljs-number">1</span>
<span class="hljs-symbol">'will</span> show the <span class="hljs-built_in">character</span> <span class="hljs-number">1</span> <span class="hljs-keyword">to</span> <span class="hljs-number">4</span>, each per frame.
<span class="hljs-symbol">'and</span> <span class="hljs-keyword">loop</span> <span class="hljs-keyword">with</span> the <span class="hljs-built_in">character</span> <span class="hljs-number">0</span>.
</code></pre><hr>
<p><code>PARTICLE OFF</code></p>
<p>Clear all sprite positions and reset all particle appearances.</p>
<hr>
<p><code>ON PARTICLE CALL subprogram</code></p>
<p>For each particle, the system will call the subprogram using an interrupt.</p>
<p>The target <code>subprogram</code> will receive two arguments:</p>
<ol>
<li>The <code>sprite</code> number,</li>
<li><p>The particle <code>address</code>.</p>
<p> sub mypart(spr,addr)</p>
<pre><code> sy=peekw(addr+<span class="hljs-number">2</span>)
 pokew addr+<span class="hljs-number">2</span>,sy<span class="hljs-number">-5</span>
 'change the speed in y axis
</code></pre><p> end sub</p>
</li>
</ol>
<p>The number of available cycles will be specified in a future version.</p>
<hr>
<p><code>EMITTER count AT address</code></p>
<p>Declare the use of <code>count</code> emitters and store the internal data at <code>address</code>.</p>
<p><code>count</code> is a number between <code>0</code> and <code>15</code>.</p>
<p>Each emitter will consume 6 bytes of memory. For each emitter:</p>
<table>
<thead>
<tr>
<th style="text-align:right">addr</th>
<th>size</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">+0</td>
<td>2 Bytes</td>
<td>Position on x axis</td>
</tr>
<tr>
<td style="text-align:right">+2</td>
<td>2 Bytes</td>
<td>Position on y axis</td>
</tr>
<tr>
<td style="text-align:right">+4</td>
<td>1 Byte</td>
<td>Delay before emit</td>
</tr>
<tr>
<td style="text-align:right">+5</td>
<td>1 Byte</td>
<td>Number of times to emit</td>
</tr>
</tbody>
</table>
<hr>
<p><code>EMITTER emitter DATA label</code></p>
<p>Declare a <code>label</code> that contains DATA for the <code>emitter</code>.</p>
<p>The associated data MUST follow this list:</p>
<ol>
<li><code>appearance</code> index of <code>appearance</code>, see: <code>PARTICLE appearance DATA label</code>.</li>
<li><code>shape</code> (documentation pending),</li>
<li><code>outer</code> ring radius,</li>
<li><code>inner</code> ring radius,</li>
<li><code>arc</code> (documentation pending),</li>
<li><code>rotation</code> (documentation pending),</li>
<li>initial particle <code>speed</code> on x axis,</li>
<li>initial particle <code>speed</code> on y axis,</li>
<li><code>explosivity</code> (documentation pending),</li>
<li><code>count</code> of the number of particles to spawn at this frame,</li>
<li>number of frames to <code>delay</code> before re-emission,</li>
<li>how many times to <code>repeat</code> the emission.</li>
</ol>
<p>When a particle is spawned, a random position is computed between the <code>outer</code> and <code>inner</code> ring.</p>
<hr>
<p><code>EMITTER emitter ON x,y</code></p>
<p>Tell the <code>emitter</code> to emit particles starting at position <code>x</code> and <code>y</code>.</p>
<p>It will automatically end when <code>repeat</code> reaches 0.</p>
<hr>
<p><code>EMITTER emitter OFF</code></p>
<p>Manually stop the <code>emitter</code>.</p>
<h2 id="how-does-it-work">How does it work</h2>
<p>Retro Game Creator does not have a framebuffer where users paint pixels like in Pico-8. Instead, it simulates a üåê<a href="https://www.nesdev.org/wiki/PPU">NES/Gameboy PPU chip</a>, which traverses its memory to generate output pixels based on characters, backgrounds, sprites, palettes and register information.</p>
<h3 id="screen">Screen</h3>
<p>The fantasy screen has a maximum resolution of 216x384 pixels.</p>
<p>It features perfectly square pixels, a fixed portrait orientation, and always fills the entire device screen.</p>
<p>Depending on the device's screen ratio, the number of visible virtual pixels may vary from 216x288 on 4:3 devices to 177x384 on 19.5:9 devices.</p>
<p>That's why Retro Game Creator provides an API to request the <a href="#widthshownwheightshownh">actual visible dimension of the screen</a>.</p>
<p>Additionally, the device can have a notch and bottom inset full-width buttons. Retro Game Creator provides an API to request the offset from the visible dimension to the <a href="#leftsafeltopsafetrightsaferbottomsafeb">safe area</a>.</p>
<h3 id="colors">Colors</h3>
<p>Retro Game Creator provides the user with a fixed set of <a href="#64-colors">64 colors</a>.</p>
<p>The colors are grouped into sets of 4 called palettes, with 8 palettes available for users to colorize their creations.</p>
<p>The 1st color of the 1st palette is used as the background color for the whole program. For the following palettes (2nd to 8th), the 1st color is transparent.</p>
<p>This can be altered by the <a href="#system-setting-value"><code>SYSTEM</code> command</a>.</p>
<p>From now on, the terms:</p>
<ul>
<li><strong>a palette</strong> apply to one of the 8 palettes with 4 colors inside,</li>
<li><strong>a color</strong> means one of the 4 colors within a palette or one of the 64 available colors.</li>
</ul>
<p>Sauce: üåê<a href="https://lospec.com/palette-list/famicube">FAMICUBE palette created by Arne</a>.</p>
<h3 id="characters">Characters</h3>
<p>The 256 characters are blocks of 8x8 pixels assigned to numbers from 0 to 255.
When a number is used to draw in a background layer or sprite, the rendering process draws the corresponding 8x8 pixel block.</p>
<p>From now on, the term:</p>
<ul>
<li><strong>a character</strong> is a block of 8x8 pixels and takes 16 bytes.</li>
</ul>
<h3 id="backgrounds">Backgrounds</h3>
<p>Retro Game Creator has 4 background layers, each with an independent:</p>
<ul>
<li>X and Y position,</li>
<li>and 64x64 character cells.</li>
</ul>
<p>The 4 layers are drawn in order from 4th to 1st. Cells of the 1st background will be visible above the others unless the priority flag is used.</p>
<p>Each cell has its own:</p>
<ul>
<li>character number,</li>
<li>palette,</li>
<li>horizontal and vertical flip,</li>
<li>priority to alter which layer's cell is drawn on top of another and on top of sprites.</li>
</ul>
<p>Layers are not framebuffers; you cannot easily paint pixels directly. Instead, every cell references a character number, and those hold the pixel color information.</p>
<p>Each layer can be shifted using the position on the X and Y axes. When reaching the edges, the cells will wrap around and remain visible.
Put another way, when the rendering process tries to draw the 65th cell of a row, because it does not exist, it will draw the 1st cell instead. This can be used to achieve infinite scrolling.</p>
<p>As mentioned before, the 1st color of each palette is transparent except for the 1st color of the 1st palette, which determines the background color of the whole fantasy screen.</p>
<p>This can be altered by the <a href="#system-setting-value"><code>SYSTEM</code> command</a>.</p>
<p>From now on, the terms:</p>
<ul>
<li><strong>a layer</strong> is a background layer of 64x64 cells,</li>
<li><strong>a cell</strong> is a square of a layer that shows one character, so 8x8 pixel.</li>
</ul>
<p>Check background <a href="#registers">registers</a> for information about the memory mapping and data format.</p>
<h3 id="sprites">Sprites</h3>
<p>Retro Game Creator offers 170 sprites, each with:</p>
<ul>
<li>X and Y position,</li>
<li>a dimension of 8x8, 16x16, 24x24 or 32x32 pixels,</li>
<li>a character number for the top left one,</li>
<li>a palette,</li>
<li>horizontal and vertical flip,</li>
<li>and priority to show the sprite on top of bg cells with priorities.</li>
</ul>
<p>The 170 sprites are drawn in order from 170th (bottom) to 1st (top).
The sprite numbers range starts at 0, so the last one is 169.</p>
<p>Sprites are groups of characters ranging from 1x1 to 4x4. The difference with backgrounds is that you only choose the top-left character. The other character numbers are dependent on the top-left one. To compute them, add 1 from the first one to reach the character to the right, and add 16 from the first one to get the one below.</p>
<p>Example with a 2x2 sprite with the first character to be 1:</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>2</td>
</tr>
<tr>
<td>16</td>
<td>17</td>
</tr>
</tbody>
</table>
<p>A sprite can be freely placed anywhere on the screen with 1/16 sub-pixel precision. This means you can add 0.5 to its position even if there will be no visual change.</p>
<h3 id="rendering">Rendering</h3>
<p>The fantasy screen is rendered line by line; this is called a raster.</p>
<p>During raster, the pixels from background layers and sprites are drawn according to priority flags and the palette is applied. All impacted parameters are not fixed, and a sub-routine can be used between each line to alter some parameters and create interesting visual effects, see <a href="#on-raster-call-s"><code>ON RASTER CALL s</code></a> and <a href="#raster"><code>=RASTER</code></a>.</p>
<p>Check the <a href="#sprite-api">sprite API</a> and the <a href="#background-api">background API</a>.</p>
<h3 id="cpu-cycles">CPU &amp; cycles</h3>
<p>Retro Game Creator simulates a fantasy console with limitations, one of them being the number of instructions the CPU can execute before the next frame MUST be drawn and presented to the player.</p>
<p>This is achieved by a set of different rules applied to an internal CPU cycle counter. When the maximum is reached, the next frame is drawn no matter what. This can have the following effects:</p>
<ol>
<li><p>The execution of the main program is halted and will continue after the frame is drawn. The program will run slower.</p>
</li>
<li><p>If the maximum cycles are reached during a raster interrupt, the next line is not drawn.</p>
</li>
</ol>
<h3 id="cartridge">Cartridge</h3>
<p>A Retro Game Creator cartridge is a text file containing the program code and 16 virtual files after the text.</p>
<p>The virtual files data are encoded in hexadecimal and SHOULD respect a specific format.</p>
<blockquote>
<p>Manually editing the virtual files data is NOT RECOMMENDED as it can lead to unexpected behavior. Instead, use the provided tools and APIs to manipulate the virtual files.</p>
</blockquote>
<h3 id="virtual-file">Virtual file</h3>
<p>There are 16 virtual files identified by a number (<code>id</code>) and can contain a <code>comment$</code>.</p>
<pre><code><span class="hljs-meta">#id:comment$</span>
<span class="hljs-class"><span class="hljs-keyword">data</span></span>
</code></pre><ul>
<li><code>id</code> is a number between 0 and 15.</li>
<li><code>comment$</code> is a string <strong>without double quotes</strong> of 32 characters max.</li>
<li><code>data</code> is a list of hexadecimal literals.</li>
</ul>
<p>When the program is started, the content of the files is loaded and <a href="#memory-mapping">mapped to the memory</a>.</p>
<p>The memory address for the files starts at $10000, and the best way to know this address is to use the <a href="#addressromfile"><code>ROM(file)</code></a> function.</p>
<p>Check the <a href="#file-api">file API</a>.</p>
<h3 id="memory">Memory</h3>
<p>The fantasy hardware simulates a <a href="#memory-mapping">memory mapping</a>, making access to the cartridge ROM and registers accessible using an address (<code>$0000</code>..<code>$1FFFF</code>).</p>
<p>Each address contains a value of one byte (0..255). Some of those addresses are readable, writable, both or none.</p>
<p>Check the <a href="#memory-api">memory API</a>.</p>
<h3 id="persistent-memory">Persistent Memory</h3>
<p>The fantasy hardware simulates persistent memory allowing users to store some bytes on the device memory, making them persistent even after stopping the program or quitting the app.</p>
<h3 id="sound">Sound</h3>
<p>The fantasy hardware simulates 4 voices to play sound effects and music using an internal tracks player.</p>
<p>Check the <a href="#sound-api">sound API</a>.</p>
<h3 id="overlay">Overlay</h3>
<p>When the program is running, there is an option in the device application that enables showing the screen overlay.</p>
<p>This screen shows the simulated CPU usage by counting how many <a href="#cycles">fantasy CPU cycles</a> have been consumed already.</p>
<p>It also shows any message that has been printed on the overlay using the <a href="#trace-expressionexpression"><code>TRACE</code> command</a>.</p>
<h3 id="keyboard">Keyboard</h3>
<p>The fantasy hardware has access to the device virtual keyboard. It allows users to type while running a program.</p>
<p>Check the <a href="#input-api">input API</a>.</p>
<h2 id="program-language">Program Language</h2>
<p>The programming language follows the path of the original Lowres NX. It's a BASIC-type language and here's how to use it.</p>
<h3 id="program">Program</h3>
<p>A program is a list of so-called instructions executed by the fantasy hardware one by one from top to bottom. The simplest and most iconic program could be:</p>
<pre><code><span class="hljs-built_in">print</span> <span class="hljs-string">"hello world!"</span>
</code></pre><p>Users are invited to create a new program, type the instruction above and run it.</p>
<p>Keywords and values are separated by spaces and instructions by new lines.</p>
<pre><code><span class="hljs-built_in">print</span> <span class="hljs-string">"hello..."</span>
<span class="hljs-built_in">print</span> <span class="hljs-string">"second instruction"</span>
</code></pre><blockquote>
<p>The program does not care about upper or lower case, use the one you prefer.</p>
</blockquote>
<h3 id="instructions">Instructions</h3>
<p>Instructions tell the fantasy hardware to do something.</p>
<ul>
<li>Assigning a <a href="#literals">literal</a> or an <a href="#expressions">expression</a> to a <a href="#variables-and-assignation">variable</a>.</li>
<li>Executing a <a href="#commands">command</a> or a <a href="#functions">function</a>.</li>
<li>Calling a <a href="#procedures">procedure</a> with or without <a href="#parameters-arguments-and-scopes">arguments</a>.</li>
<li>Jumping to a <a href="#labels-jumps-and-embedded-data">label</a> or returning from the <a href="#stack-sub-routine-and-return">stack</a>.</li>
</ul>
<h3 id="identifiers">Identifiers</h3>
<ol>
<li><p>An identifier is a word defined by the user and is used to declare variables, labels or procedures (more on those terms later), e.g.: <code>hero</code>, <code>enemies</code>, <code>HP</code>, <code>score</code>, <code>spawn_monsters</code>, <code>updateScreen</code>, <code>CollectCoins</code>, <code>level12</code>‚Ä¶</p>
</li>
<li><p>An identifier can also be a built-in function name provided by Retro Game Creator as part of the <a href="#api-instructions">API</a>.</p>
</li>
</ol>
<p>Valid characters for identifiers are: ASCII letters, digits and the underscore <code>_</code>. However, they cannot start with a digit and they cannot have more than 21 characters.</p>
<p><strong>Important:</strong> Not all identifiers are valid because some of them are reserved by the language itself. Check the <a href="#reserved-keywords">list of reserved keywords</a> and learn them to avoid common mistakes.</p>
<h3 id="variables-and-assignation">Variables and assignation</h3>
<p>A variable is a value that is retained in the fantasy hardware memory as long as the program is running. Variables can be used to store positions, scores, HP and all sorts of information. The purpose of a variable is to store a value to retrieve it later.</p>
<p>Example: a score counter that starts at zero and increments every time a plumber hero jumps on enemies' heads. An appropriate name for this value is <code>score</code> and it can be declared and assigned like this:</p>
<pre><code><span class="hljs-attr">score</span>=<span class="hljs-number">0</span>
</code></pre><p>And to increment it:</p>
<pre><code><span class="hljs-attr">score</span>=score+<span class="hljs-number">1</span>
</code></pre><p>As you can see, variables are declared using an identifier. That's why users SHOULD choose descriptive names that help them remember what's inside.</p>
<p>As a real example, this is a program that increments and prints a score every time the player taps the device screen.</p>
<pre><code><span class="hljs-keyword">score</span>=0
<span class="hljs-keyword">do</span>
    <span class="hljs-keyword">print</span> <span class="hljs-string">"score"</span>,<span class="hljs-keyword">score</span>
    wait tap
    <span class="hljs-keyword">score</span>=<span class="hljs-keyword">score</span>+1
loop
</code></pre><p>Variable can also store strings:</p>
<pre><code><span class="hljs-built_in">name</span>$=<span class="hljs-string">"Untel"</span>
print <span class="hljs-built_in">name</span>$
</code></pre><p>Variable syntax:</p>
<pre><code>identifier[<span class="hljs-string">$</span>][<span class="hljs-symbol">(expression)</span>]
</code></pre><p>This allows variables to have 4 different forms:</p>
<ul>
<li><code>my_number</code></li>
<li><code>my_string$</code></li>
<li><code>my_number_array()</code></li>
<li><code>my_string_array$()</code></li>
</ul>
<h3 id="literals">Literals</h3>
<p>Identifiers can store two types of values: numbers and strings.</p>
<p>Numbers can be integers or decimals, e.g.: <code>123</code>, <code>-45</code>, <code>0.01</code>, <code>12345.6789</code></p>
<p>Strings can only contain ASCII7 characters: letters, digits, some punctuation and some control characters: <code>&quot;hello WORLD! 123&quot;</code></p>
<p>Learn more about the technical information about <a href="#number-limits">number type</a> and <a href="#string">string type</a>.</p>
<h3 id="arrays">Arrays</h3>
<p>Arrays are lists of values grouped into one variable:</p>
<pre><code>dim player_score(<span class="hljs-number">1</span>)
<span class="hljs-function"><span class="hljs-title">player_score</span><span class="hljs-params">(<span class="hljs-number">0</span>)</span></span>=<span class="hljs-number">123</span>
<span class="hljs-function"><span class="hljs-title">player_score</span><span class="hljs-params">(<span class="hljs-number">1</span>)</span></span>=<span class="hljs-number">456</span>
</code></pre><p>Arrays are zero-based indexed.</p>
<p>Arrays can also store strings:</p>
<pre><code>dim player_name<span class="hljs-variable">$(</span><span class="hljs-number">1</span>)
player_name<span class="hljs-variable">$(</span><span class="hljs-number">0</span>)=<span class="hljs-string">"Untel"</span>
player_name<span class="hljs-variable">$(</span><span class="hljs-number">1</span>)=<span class="hljs-string">"John Doe"</span>
</code></pre><p>See <a href="#dim"><code>DIM</code></a> and <a href="#ubound"><code>=UBOUND</code></a> for more information.</p>
<h3 id="labels-jumps-and-embedded-data">Labels, jumps and embedded data</h3>
<p>Another feature that uses identifiers are labels. They are used to mark a position in the program to go back to it later. Users need to understand that programs are executed line by line from top to bottom and labels are one solution to go back to the top of the program or anywhere else (almost).</p>
<p>Here is an example that demonstrates how to recreate the program above using labels:</p>
<pre><code><span class="hljs-built_in">score</span>=<span class="hljs-number">0</span>
start:
    print <span class="hljs-string">"score"</span>,<span class="hljs-built_in">score</span>
    wait tap
    <span class="hljs-built_in">score</span>=<span class="hljs-built_in">score</span>+<span class="hljs-number">1</span>
<span class="hljs-built_in">goto</span> start
</code></pre><p>A label is declared by an identifier followed by a colon <code>:</code> (here &quot;start&quot;), and the <code>GOTO</code> command will make the program execution &quot;jump&quot; to the previous label &quot;start&quot;, creating an infinite loop.</p>
<hr>
<p>About using label identifiers as <a href="#lvalue-and-rvalue">rvalue</a>: This feature allows using label names that lead to <a href="#data-rom-and-files">constant string values</a> directly instead of having to store the value in a variable.</p>
<p>Example, instead of writing:</p>
<pre><code>data <span class="hljs-string">"chocolate"</span>
<span class="hljs-built_in">read</span> like$
<span class="hljs-built_in">print</span> <span class="hljs-string">"I like"</span>,like$
</code></pre><p>You can write:</p>
<pre><code><span class="hljs-keyword">like</span>: data <span class="hljs-string">"chocolate"</span>
print <span class="hljs-string">"I like"</span>,<span class="hljs-keyword">like</span>
</code></pre><p>And it works in all <a href="#expressions">expressions</a> that involve <a href="#literals">literal strings</a> or <a href="#variables-and-assignation">string variables</a>.</p>
<pre><code><span class="hljs-built_in">test</span>1: data <span class="hljs-string">"entanglem"</span>
<span class="hljs-built_in">print</span> <span class="hljs-built_in">test</span>1+left$(<span class="hljs-built_in">test</span>1,3)
<span class="hljs-built_in">test</span>2: data 1234.5
<span class="hljs-built_in">print</span> <span class="hljs-built_in">test</span>2*2
</code></pre><h3 id="stack-sub-routine-and-return">Stack, sub-routine and return</h3>
<p>Using the <code>GOTO</code> command to jump to another part of the program is very useful to organize the code and create loops. Sometimes this is not enough, introducing the <code>GOSUB</code> command.</p>
<p>The stack is a place inside the fantasy hardware that tracks where a program was before jumping to a label, allowing you to <code>RETURN</code> to the previous location.</p>
<p>This allows reaching the same label from different parts of the code, while being able to return to it later.</p>
<p>Example of a program that reaches the same label from two places.</p>
<pre><code>one:
    <span class="hljs-keyword">print</span> <span class="hljs-string">"one"</span>
    <span class="hljs-keyword">gosub</span> common
two:
    <span class="hljs-keyword">print</span> <span class="hljs-string">"two"</span>
    <span class="hljs-keyword">gosub</span> common
    <span class="hljs-keyword">goto</span> one

common:
    <span class="hljs-built_in">wait</span> tap
    <span class="hljs-keyword">return</span>
</code></pre><h3 id="procedures">Procedures</h3>
<p>The last usage of identifiers are procedures. They are meant to be reusable sub-parts of a program.</p>
<p>Here's a quick example:</p>
<pre><code><span class="hljs-keyword">sub </span><span class="hljs-keyword">addition(a,b,c)
</span>    c<span class="hljs-symbol">=a</span>+<span class="hljs-keyword">b
</span><span class="hljs-symbol">end</span> <span class="hljs-keyword">sub</span>
</code></pre><p>By running this program, nothing will happen because procedures do not get executed automatically. Instead the user MUST use a dedicated command for it:</p>
<pre><code><span class="hljs-literal">result</span>=<span class="hljs-number">0</span>
call addition(<span class="hljs-number">120</span>,<span class="hljs-number">3</span>,<span class="hljs-literal">result</span>)
print <span class="hljs-string">"result"</span>,<span class="hljs-literal">result</span>
</code></pre><p>By adding this piece of code after the previous one and running the program, the solution of the operation 120+3 will be printed on the screen: &quot;result 123&quot;.</p>
<p>The advantage of calling procedures is being able to do it again and again.</p>
<pre><code><span class="hljs-keyword">call</span> addition(<span class="hljs-number">45</span>,<span class="hljs-number">-78</span>,<span class="hljs-keyword">result</span>)
print <span class="hljs-string">"result"</span>,<span class="hljs-keyword">result</span>
</code></pre><p>This time, it will print &quot;result -33&quot;.</p>
<p>The difference with <a href="#stack-sub-routine-and-return">sub-routines</a> is the <a href="#parameters-arguments-and-scopes">scope</a>.</p>
<h3 id="parameters-arguments-and-scopes">Parameters, arguments and scopes</h3>
<p>Another concept that comes with procedures are parameters and arguments, but first, users need to learn a thing about variable scope.</p>
<p>By default, when declaring a variable in a program, its scope is limited and the variable is unknown inside a procedure.</p>
<pre><code><span class="hljs-keyword">score=0
</span><span class="hljs-keyword">sub </span>print_score
    üêûprint <span class="hljs-string">"score"</span>,<span class="hljs-keyword">score
</span>end <span class="hljs-keyword">sub
</span>call print_score
</code></pre><p>This program will produce the error: &quot;variable not initialized&quot;. The program can't access the variable <code>score</code> inside the <code>print_score</code> procedure.</p>
<p>One option is to pass the variable to the procedure. Two changes MUST be made for that.</p>
<ol>
<li><p>Users need to add a parameter to the procedure declaration:</p>
<pre><code> <span class="hljs-keyword">sub</span> print_score(s)
     print <span class="hljs-string">"score"</span>,s
 <span class="hljs-keyword">end</span> <span class="hljs-keyword">sub</span>
</code></pre></li>
<li><p>Users also need to add an argument to the procedure call:</p>
<pre><code> call print_score(<span class="hljs-name">score</span>)
</code></pre></li>
</ol>
<p>When the procedure <code>print_score</code> is called, the argument <code>score</code> is passed to the procedure inside the <code>s</code> parameter.</p>
<p>Corrected program:</p>
<pre><code>    <span class="hljs-keyword">score</span>=0
    sub print_score(s)
        <span class="hljs-keyword">print</span> <span class="hljs-string">"score"</span>,<span class="hljs-built_in">s</span>
    end sub
    call print_score(<span class="hljs-keyword">score</span>)
</code></pre><p>Another option is to rely on <a href="#local-and-global-scope">global scope</a>.</p>
<h3 id="passed-by-reference">Passed by reference</h3>
<p>Arguments are passed by reference. This means that a variable passed to a procedure and being modified by this procedure will stay modified when exiting the procedure.</p>
<pre><code>sub modify_it(<span class="hljs-name">a</span>)
    a=123
end sub
my_value=0
call modify_it(<span class="hljs-name">my_value</span>)
print my_value
</code></pre><p>It will print <code>123</code>.</p>
<p>To avoid this behavior, encapsulate the argument in round brackets <code>(identifier)</code>.</p>
<pre><code>sub modify_it(<span class="hljs-name">a</span>)
    a=123
end sub
my_value=0
call modify_it((<span class="hljs-name">my_value</span>))
print my_value
</code></pre><p>It will print <code>0</code>.</p>
<h3 id="local-and-global-scope">Local and global scope</h3>
<p>When variables are initialized or declared in the main program body, they are local to the program body.</p>
<p>When variables are initialized or declared inside a procedure body, they are local to this procedure body.</p>
<p>It is possible to declare a variable global so it can be accessed in both scopes.</p>
<pre><code><span class="hljs-keyword">global</span> <span class="hljs-keyword">score</span>
sub frag
    <span class="hljs-keyword">score</span>=<span class="hljs-keyword">score</span>+1
end sub
<span class="hljs-keyword">do</span>
    cls
    <span class="hljs-keyword">print</span> <span class="hljs-string">"score:"</span>,<span class="hljs-keyword">score</span>
    wait tap
    call frag
loop
</code></pre><p>Global variables MUST be declared before trying to access them.</p>
<p>The syntax to declare a global array is a bit different:</p>
<pre><code><span class="hljs-keyword">dim</span> <span class="hljs-keyword">global</span> enemies
</code></pre><p>See <a href="#global"><code>GLOBAL</code></a> and <a href="#dim-global"><code>DIM GLOBAL</code></a> for more information.</p>
<h3 id="comments">Comments</h3>
<p>Comments are pieces of text that are not executed. They are useful for taking notes of what a particular piece of code is doing.</p>
<pre><code>'get <span class="hljs-section">touch</span> position in cells coordinates
tx=<span class="hljs-section">touch</span>.x\<span class="hljs-number">8</span>
</code></pre><blockquote>
<p>Avoid üåê<a href="https://en.wikipedia.org/wiki/Captain_Obvious">Captain Obvious</a> comments!</p>
</blockquote>
<h3 id="grammar">Grammar</h3>
<p>As said earlier, a program is a list of instructions read and executed one by one. To make it easier to read, developers use a set of spaces, indentations, new lines, comments, procedures‚Ä¶</p>
<p>Here is a set of rules on how it works:</p>
<ul>
<li><p>An instruction cannot be split on two lines.</p>
<p>  This will not work:</p>
<pre><code>  <span class="hljs-comment">üêûa=</span>
  <span class="hljs-comment">123</span>
</code></pre></li>
<li><p>Labels are not instructions; users can place instructions on the same line.</p>
<p>  ‚úÖ This will work:</p>
<pre><code>  <span class="hljs-built_in">test</span>: <span class="hljs-built_in">print</span> 123
  <span class="hljs-built_in">wait</span> tap
  goto <span class="hljs-built_in">test</span>
</code></pre></li>
<li><p>The only way to squeeze two instructions on one line is to use the <code>:</code> colon separator.</p>
<p>  ‚úÖ This will work:</p>
<pre><code>  x=<span class="hljs-keyword">touch</span>.x : y=<span class="hljs-keyword">touch</span>.y
</code></pre><blockquote>
<p>I recommend placing spaces before and after the <code>:</code> colon until I fix the parsing issue.</p>
</blockquote>
</li>
<li><p><code>IF...THEN</code> uses a different syntax for one-line instructions, and <code>:</code> colon as instruction separator will not work correctly.</p>
<p>  This will not work as intended:</p>
<pre><code>  <span class="hljs-keyword">do</span>
      x=<span class="hljs-number">0</span> : y=<span class="hljs-number">0</span>
      <span class="hljs-keyword">if</span> tap <span class="hljs-keyword">then</span> x=<span class="hljs-keyword">touch</span>.x : y=<span class="hljs-keyword">touch</span>.y
      <span class="hljs-built_in">print</span> x,y
      <span class="hljs-keyword">wait</span> tap
  loop
</code></pre><p>  <code>y=touch.y</code> will always be executed.</p>
</li>
<li><p>Comments can be placed after the <code>:</code> colon instruction separator.</p>
<p>  ‚úÖ This will work:</p>
<pre><code>  a=<span class="hljs-number">123</span> :<span class="hljs-symbol">'Default</span> <span class="hljs-keyword">value</span>
</code></pre></li>
</ul>
<ul>
<li><p>Indentation has no meaning; users can place it however they want.</p>
<p>  ‚úÖ This will work:</p>
<pre><code>  <span class="hljs-built_in">test</span>:
          <span class="hljs-built_in">print</span>       <span class="hljs-string">"far"</span>
  <span class="hljs-built_in">print</span> <span class="hljs-string">"near"</span>
</code></pre></li>
</ul>
<ul>
<li>Check the <a href="#reserved-keywords">list of reserved keywords</a>, as users cannot use them for identifiers.</li>
</ul>
<h3 id="expressions">Expressions</h3>
<p>Expressions are used to compute values, be assigned to identifiers or passed to functions as arguments. An expression can be one of:</p>
<ul>
<li><p>A <a href="#literals">literal value</a>:</p>
<pre><code>  <span class="hljs-number">123</span>
  <span class="hljs-string">"gabu"</span>
</code></pre></li>
<li><p>A <a href="#variables-and-assignation">variable identifier</a>:</p>
<pre><code>  myVar<span class="hljs-variable">$
</span>  myArray(<span class="hljs-number">0</span>)
</code></pre></li>
<li><p>A <a href="#functions">function call</a>:</p>
<pre><code>  <span class="hljs-built-in">cos</span>(<span class="hljs-number">1.314</span>)
  left<span class="hljs-symbol">$</span>(name<span class="hljs-symbol">$</span>,<span class="hljs-number">8</span>)
</code></pre></li>
<li><p>An <a href="#operators">unary, binary or group operator</a>:</p>
<pre><code>  <span class="hljs-number">42</span>+<span class="hljs-number">24</span>
  $FF00+A*<span class="hljs-number">2</span>
  count&gt;=<span class="hljs-number">0</span>
  not dead
  (<span class="hljs-number">2</span>+<span class="hljs-number">3</span>)*<span class="hljs-number">4</span>
</code></pre></li>
<li><p>A <a href="#labels-jumps-and-embedded-data">label identifier</a>:</p>
<pre><code><span class="hljs-attribute">  mylabel</span>
</code></pre></li>
</ul>
<h3 id="operators">Operators</h3>
<p>Operators are used inside <a href="#expressions">expressions</a> to compute or alter their values.</p>
<p><strong>Arithmetic operators:</strong></p>
<p>Operate on two numeric values to produce a new one.</p>
<table>
<thead>
<tr>
<th style="text-align:right">symbol</th>
<th>example</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right"><code>-</code></td>
<td><code>-42</code></td>
<td>negation</td>
</tr>
<tr>
<td style="text-align:right"><code>^</code></td>
<td><code>x^3</code></td>
<td>exponentiation</td>
</tr>
<tr>
<td style="text-align:right"><code>*</code></td>
<td><code>2*y</code></td>
<td>multiplication</td>
</tr>
<tr>
<td style="text-align:right"><code>/</code></td>
<td><code>x/2</code></td>
<td>division</td>
</tr>
<tr>
<td style="text-align:right"><code>\</code></td>
<td><code>x\2</code></td>
<td>integer division</td>
</tr>
<tr>
<td style="text-align:right"><code>mod</code></td>
<td><code>x mod 2</code></td>
<td>modulo</td>
</tr>
<tr>
<td style="text-align:right"><code>+</code></td>
<td><code>c+2</code></td>
<td>addition</td>
</tr>
<tr>
<td style="text-align:right"><code>-</code></td>
<td><code>100-d</code></td>
<td>subtraction</td>
</tr>
</tbody>
</table>
<p>The priority of execution respects the mathematical rules.</p>
<p><strong>Group operator:</strong></p>
<p>Rounded parentheses <code>()</code> are used to counter the operator priority.</p>
<p><strong>Comparison operator:</strong></p>
<p>Used to compare two numeric or string values and produce <code>-1</code> if the test succeeds or <code>0</code> otherwise. Generally used as <a href="#expressions">expressions</a> in <a href="#control-flow">conditional flow control</a>.</p>
<table>
<thead>
<tr>
<th style="text-align:right">symbol</th>
<th>example</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right"><code>=</code></td>
<td><code>a=10</code></td>
<td>equal</td>
</tr>
<tr>
<td style="text-align:right"><code>&lt;&gt;</code></td>
<td><code>a&lt;&gt;100</code></td>
<td>not equal</td>
</tr>
<tr>
<td style="text-align:right"><code>&gt;</code></td>
<td><code>b&gt;c</code></td>
<td>greater</td>
</tr>
<tr>
<td style="text-align:right"><code>&lt;</code></td>
<td><code>5&lt;x</code></td>
<td>less</td>
</tr>
<tr>
<td style="text-align:right"><code>&gt;=</code></td>
<td><code>X&gt;=20</code></td>
<td>greater or equal</td>
</tr>
<tr>
<td style="text-align:right"><code>&lt;=</code></td>
<td><code>X&lt;=30</code></td>
<td>less or equal</td>
</tr>
</tbody>
</table>
<p><strong>Bitwise operator:</strong></p>
<p>Used to manipulate each bit of numeric values.</p>
<table>
<thead>
<tr>
<th style="text-align:right">symbol</th>
<th>example</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right"><code>not</code></td>
<td><code>not (x=15)</code><br><code>not 0</code></td>
<td>Bits that are 0 become 1,<br>and those that are 1 become 0.</td>
</tr>
<tr>
<td style="text-align:right"><code>and</code></td>
<td><code>a=1 and b=12</code><br><code>170 and 15</code></td>
<td>If both bits are 1, the<br>result is 1, 0 otherwise.</td>
</tr>
<tr>
<td style="text-align:right"><code>or</code></td>
<td><code>x=10 or y=0</code><br><code>128 or 2</code></td>
<td>The result is 0 if both<br>bits are 0, 1 otherwise.</td>
</tr>
<tr>
<td style="text-align:right"><code>xor</code></td>
<td><code>a xor b</code></td>
<td>The result is 1 if only<br>one bit is 1, 0 otherwise.</td>
</tr>
</tbody>
</table>
<p><strong>Concatenation operator:</strong></p>
<p>Copy a string at the end of another string.</p>
<table>
<thead>
<tr>
<th style="text-align:right">symbol</th>
<th>example</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right"><code>+</code></td>
<td><code>&quot;ab&quot;+&quot;c&quot;</code></td>
<td>Concatenate two strings into one.</td>
</tr>
</tbody>
</table>
<h3 id="commands">Commands</h3>
<p>Retro Game Creator provide a bunch of built-in commands to manipulate the fantasy device hardware such as the graphic or sound. You'll find them by consulting the <a href="#api-instructions">list of API instructions</a>.</p>
<p>To execute a command, use it's identifier followed by a list of coma-separated arguments or other reserved keywords. The exact syntax depends on the command.</p>
<pre><code>sprite off <span class="hljs-number">0</span> to <span class="hljs-number">169</span>
sprite <span class="hljs-number">0</span>,<span class="hljs-number">40</span>,<span class="hljs-number">60</span>,<span class="hljs-number">1</span>
</code></pre><h3 id="functions">Functions</h3>
<p>Retro Game Creator provide a bunch of built-in function to manipulate the fantasy device hardware such as the graphic or sound. You'll find them by consulting the <a href="#api-instructions">list of API instructions</a>.</p>
<p>To execute a function, use it's identifier followed by a list of coma-separated arguments surrounded by rounded parenthesis.</p>
<pre><code><span class="hljs-keyword">print</span> mid$(<span class="hljs-string">"test"</span>,3,1) :'<span class="hljs-keyword">print</span> <span class="hljs-built_in">s</span>
</code></pre><p>A function will always return something and MUST be used as <a href="#lvalue-and-rvalue">rvalue</a> inside an <a href="#expressions">expressions</a>.</p>
<h3 id="lvalue-and-rvalue">Lvalue and Rvalue</h3>
<p>The equal <code>=</code> sign is used both as variable assignement and comparison operator, and It can lead to some confusion. Here is a tip to help you:</p>
<ul>
<li><p>If the line start by the variable name, it's <a href="#variables-and-assignation">a variable assignation</a>.</p>
</li>
<li><p>In all other cases, the variable is used as <a href="#expressions">a part of an expression</a>.</p>
</li>
</ul>
<p>An lvalue appears on the left side of an assignment, and an rvalue appears on the right side of an assignment. Also, rvalue is used as an argument of <a href="#functions">functions</a> or <a href="#procedures">procedures</a>.</p>
<table>
<thead>
<tr>
<th style="text-align:right">expression</th>
<th>type of value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right"><a href="#variables">variable</a></td>
<td>lvalue or rvalue</td>
</tr>
<tr>
<td style="text-align:right"><a href="#literals">literal</a></td>
<td>rvalue</td>
</tr>
<tr>
<td style="text-align:right"><a href="#functions">function call</a></td>
<td>rvalue</td>
</tr>
<tr>
<td style="text-align:right"><a href="#operators">any operator</a></td>
<td>rvalue</td>
</tr>
<tr>
<td style="text-align:right"><a href="#labels">label</a></td>
<td>rvalue</td>
</tr>
</tbody>
</table>
<h3 id="instructions-separator">Instructions separator</h3>
<p>An instruction generally end by a new line <code>\n</code>.</p>
<p>It's possible to put multiple instructions using a colon <code>:</code> on one line but with limitation:</p>
<ol>
<li><p>Can be miss-interpreted as a label declaration. So the best way is to add a space between the idenfier and the colon.</p>
<p> This will not work:</p>
<pre><code> <span class="hljs-built_in">test</span>: data 123
 üêûrestore <span class="hljs-built_in">test</span>: <span class="hljs-built_in">wait</span> vbl
</code></pre><p> ‚úÖ This will work:</p>
<pre><code> <span class="hljs-built_in">test</span>: data 123
 restore <span class="hljs-built_in">test</span> : <span class="hljs-built_in">wait</span> vbl
</code></pre></li>
<li><p>Does not work with the one line syntaxe of <a href="#ifthenelse-ifthelendf-ififthen">the <code>IF/THEN</code> command</a>.</p>
<pre><code> <span class="hljs-keyword">if</span> expression <span class="hljs-keyword">then</span> instruction1 : <span class="hljs-type">instruction2</span>
</code></pre><p> <code>instruction2</code> will always be executed.</p>
</li>
</ol>
<h3 id="reserved-keywords">Reserved keywords</h3>
<p>Some identifier cannot be used by the user for variables, proceduce or label name because they are keywords reserved by the language and it's API:</p>
<p><code>ABS</code>, <code>ADD</code>, <code>AND</code>, <code>ASC</code>, <code>ATAN</code>, <code>ATTR</code>, <code>AT</code>, <code>BG</code>, <code>BIN$</code>, <code>CALL</code>, <code>CEIL</code>, <code>CELL.A</code>, <code>CELL.C</code>, <code>CELL</code>, <code>CHAR</code>, <code>CHR$</code>, <code>CLAMP</code>, <code>CLS</code>, <code>CLW</code>, <code>COLOR</code>, <code>COMPAT</code>, <code>COPY</code>, <code>COS</code>, <code>CURSOR.X</code>, <code>CURSOR.Y</code>, <code>DATA</code>, <code>DEC</code>, <code>DIM</code>, <code>DMA</code>, <code>DO</code>, <code>EASE</code>, <code>ELSE</code>, <code>EMITTER</code>, <code>END</code>, <code>ENVELOPE</code>, <code>EXIT</code>, <code>EXP</code>, <code>FILE$</code>, <code>FILES</code>, <code>FILL</code>, <code>FLIP</code>, <code>FLOOR</code>, <code>FONT</code>, <code>FOR</code>, <code>FSIZE</code>, <code>GLOBAL</code>, <code>GOSUB</code>, <code>GOTO</code>, <code>HAPTIC</code>&quot;  <code>HEX$</code>, <code>HIT</code>, <code>IF</code>, <code>INC</code>, <code>INKEY$</code>, <code>INPUT</code>, <code>INSTR</code>, <code>INT</code>, <code>KEYBOARD</code>, <code>LEFT$</code>, <code>LEN</code>, <code>LET</code>, <code>LFO.A</code>, <code>LFO</code>, <code>LOAD</code>, <code>LOCATE</code>, <code>LOG</code>, <code>LOOP</code>, <code>MAX</code>, <code>MCELL.A</code>, <code>MCELL.C</code>, <code>MCELL</code>, <code>MESSAGE</code>, <code>MID$</code>, <code>MIN</code>, <code>MOD</code>, <code>MUSIC</code>, <code>NEXT</code>, <code>NOT</code>, <code>NUMBER</code>, <code>OFF</code>, <code>ON</code>, <code>OR</code>, <code>PALETTE</code>, <code>PAL</code>, <code>PARTICLE</code>, <code>PAUSE</code>, <code>PEEKL</code>, <code>PEEKW</code>, <code>PEEK</code>, <code>PI</code>, <code>PLAY</code>, <code>POKEL</code>, <code>POKEW</code>, <code>POKE</code>, <code>PRINT</code>, <code>PRIO</code>, <code>RANDOMIZE</code>, <code>RASTER</code>, <code>READ</code>, <code>REPEAT</code>, <code>RESTORE</code>, <code>RETURN</code>, <code>RIGHT$</code>, <code>RND</code>, <code>ROL</code>, <code>ROM</code>, <code>ROR</code>, <code>SAFE.B</code>, <code>SAFE.L</code>, <code>SAFE.R</code>, <code>SAFE.T</code>, <code>SAVE</code>, <code>SCROLL.X</code>, <code>SCROLL.Y</code>, <code>SCROLL</code>, <code>SGN</code>, <code>SHOWN.H</code>, <code>SHOWN.W</code>, <code>SIN</code>, <code>SIZE</code>, <code>SKIP</code>, <code>SOUND</code>, <code>SOURCE</code>, <code>SPRITE.A</code>, <code>SPRITE.C</code>, <code>SPRITE.X</code>, <code>SPRITE.Y</code>, <code>SPRITE</code>, <code>SQR</code>, <code>STEP</code>, <code>STOP</code>, <code>STR$</code>, <code>SUB</code>, <code>SWAP</code>, <code>SYSTEM</code>, <code>TAN</code>, <code>TAP</code>, <code>TEXT</code>, <code>THEN</code>, <code>TIMER</code>, <code>TINT</code>, <code>TOUCH.X</code>, <code>TOUCH.Y</code>, <code>TOUCH</code>, <code>TO</code>, <code>TRACE</code>, <code>TRACK</code>, <code>UBOUND</code>, <code>UNTIL</code>, <code>VAL</code>, <code>VBL</code>, <code>VIEW</code>, <code>VOLUME</code>, <code>WAIT</code>, <code>WAVE</code>, <code>WEND</code>, <code>WHILE</code>, <code>WINDOW</code>, <code>XOR</code>.</p>
<h2 id="basic-instructions">BASIC instructions</h2>
<p>To be able to use the language as a tool to make games, Retro Game Creator provides instructions to:</p>
<ul>
<li><p>manipulates the execution of a program: go here, go back, wait for this, do that if this happens and stuff like that.</p>
</li>
<li><p>store same values here, read those values there, skip this...</p>
</li>
<li><p>declare this variables, make it available there...</p>
</li>
</ul>
<p>In the following sections, you'll learn how to do all this abstract but important things.</p>
<h3 id="control-flow">Control flow</h3>
<p>¬´ In software, üåê<a href="https://en.wikipedia.org/wiki/Control_flow">control flow (or flow of control)</a> describes how execution progresses from one command to the next. ¬ª</p>
<p>-- wikipedia</p>
<h4 id="-end-"><code>END</code></h4>
<p>Stop the execution of the program.</p>
<p>It has the same effect as the execution reach the end of the program.</p>
<h4 id="-if-then-else-if-else-end-if-br-if-then-"><code>IF/THEN/ELSE IF/ELSE/END IF</code><br><code>IF/THEN</code></h4>
<pre><code><span class="hljs-keyword">if</span> expression <span class="hljs-keyword">then</span>
    instruction...
[<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> expression <span class="hljs-keyword">then</span>
    instruction...]
[<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>...]
[<span class="hljs-keyword">else</span>
    instruction]
<span class="hljs-keyword">end</span> <span class="hljs-keyword">if</span>
</code></pre><p>Will execute the list of <code>instruction...</code> if the above <code>expression</code> is true.
An <a href="#expression">expression</a> is evaluated as <code>true</code> if the result of the expression is different from 0.</p>
<p>It's possible to have multiple <code>ELSE IF</code> blocks but a maximum of one <code>ELSE</code> block is authorized.</p>
<p>Real example of a game that asks the player to guess a number:</p>
<pre><code>again: <span class="hljs-keyword">print</span> <span class="hljs-string">"guess the number"</span>
answer=<span class="hljs-keyword">rnd</span>(<span class="hljs-number">100</span>)
retry: <span class="hljs-keyword">input</span> <span class="hljs-string">"1-100:"</span><span class="hljs-comment">;guess</span>
<span class="hljs-keyword">if</span> guess&lt;<span class="hljs-number">1</span> <span class="hljs-keyword">or</span> guess&gt;<span class="hljs-number">100</span> then
    <span class="hljs-keyword">print</span> <span class="hljs-string">"a number between 1 and 100"</span>
    <span class="hljs-keyword">goto</span> retry
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> guess=answer then
    <span class="hljs-keyword">print</span> <span class="hljs-string">"you got it!"</span>
    <span class="hljs-keyword">print</span>
    <span class="hljs-keyword">goto</span> again
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> guess&lt;answer then
    <span class="hljs-keyword">print</span> <span class="hljs-string">"too low"</span>
    <span class="hljs-keyword">goto</span> retry
<span class="hljs-keyword">else</span>
    <span class="hljs-keyword">print</span> <span class="hljs-string">"too high"</span>
    <span class="hljs-keyword">goto</span> retry
<span class="hljs-keyword">end</span> <span class="hljs-keyword">if</span>
</code></pre><hr>
<pre><code><span class="hljs-keyword">if</span> condition <span class="hljs-keyword">then</span> instruction
</code></pre><p>This form only allow one <code>instruction</code>, but it's also shorter.</p>
<p>Real example of the same game with less lines:</p>
<pre><code>again: <span class="hljs-keyword">print</span> <span class="hljs-string">"guess the number"</span>
answer=<span class="hljs-keyword">rnd</span>(<span class="hljs-number">100</span>)
retry: <span class="hljs-keyword">input</span> <span class="hljs-string">"1-100:"</span><span class="hljs-comment">;guess</span>
<span class="hljs-keyword">if</span> guess=answer then
    <span class="hljs-keyword">print</span> <span class="hljs-string">"you got it!"</span>
    <span class="hljs-keyword">print</span>
    <span class="hljs-keyword">goto</span> again
<span class="hljs-keyword">end</span> <span class="hljs-keyword">if</span>
<span class="hljs-keyword">if</span> guess&lt;<span class="hljs-number">1</span> <span class="hljs-keyword">or</span> guess&gt;<span class="hljs-number">100</span> then <span class="hljs-keyword">print</span> <span class="hljs-string">"a number between 1 and 100"</span>
<span class="hljs-keyword">if</span> guess&lt;answer then <span class="hljs-keyword">print</span> <span class="hljs-string">"too low"</span>
<span class="hljs-keyword">if</span> guess&gt;answer then <span class="hljs-keyword">print</span> <span class="hljs-string">"too high"</span>
<span class="hljs-keyword">goto</span> retry
</code></pre><h4 id="-do-loop-exit-"><code>DO/LOOP/EXIT</code></h4>
<pre><code><span class="hljs-keyword">do</span>
    instruction...
    [<span class="hljs-keyword">exit</span>/<span class="hljs-keyword">goto</span>]
<span class="hljs-keyword">loop</span>
</code></pre><p>Continuously execute the list of <code>instruction...</code>.</p>
<p>Possible way to get out of the loop is using <code>EXIT</code> or <code>GOTO</code>.</p>
<p>Real example of non stop moving square that bounce on the device screen:</p>
<pre><code><span class="hljs-attr">x=shown.w\2</span>
<span class="hljs-attr">y=shown.h\2</span>
<span class="hljs-attr">sx=1</span>
<span class="hljs-attr">sy=1</span>
do
    <span class="hljs-keyword">if</span> <span class="hljs-attr">x=0</span> <span class="hljs-literal">or</span> <span class="hljs-attr">x=shown.w-8</span> <span class="hljs-keyword">then</span> <span class="hljs-attr">sx=-sx</span>
    <span class="hljs-keyword">if</span> <span class="hljs-attr">y=0</span> <span class="hljs-literal">or</span> <span class="hljs-attr">y=shown.h-8</span> <span class="hljs-keyword">then</span> <span class="hljs-attr">sy=-sy</span>
    add x,sx
    add y,sy
    sprite <span class="hljs-number">0</span>,x,y,<span class="hljs-number">1</span>
    wait vbl
    <span class="hljs-keyword">if</span> tap <span class="hljs-keyword">then</span> exit
loop
print <span class="hljs-string">"done"</span>

<span class="hljs-comment">#2:main characters</span>
<span class="hljs-number">00000000000000000000000000000000</span>
<span class="hljs-number">0000000000000000</span>FFFFFFFFFFFFFFFF
</code></pre><p><code>EXIT</code> command will exit one level of <code>DO/LOOP</code>.</p>
<h4 id="-repeat-until-exit-"><code>REPEAT/UNTIL/EXIT</code></h4>
<pre><code><span class="hljs-keyword">repeat</span>
    instruction...
    [<span class="hljs-keyword">exit</span>/<span class="hljs-keyword">goto</span>]
<span class="hljs-keyword">until</span> expression
</code></pre><p>Repeat the list of <code>instruction...</code> until the <code>expression</code> ahead became true.
An <a href="#expressions">expression</a> is evaluated as <code>true</code> if the result of the expression is different from 0.</p>
<p><code>EXIT</code> command will exit one level of <code>REPEAT/UNTIL</code>.</p>
<p>It different from <code>WHILE/WEND</code> because <code>expression</code> is evaluated after the list of <code>instruction...</code> is executed.</p>
<pre><code>stop_now=<span class="hljs-number">-1</span>
<span class="hljs-keyword">repeat</span>
    <span class="hljs-keyword">print</span> <span class="hljs-string">"do it anyway"</span>
<span class="hljs-keyword">until</span> stop_now
</code></pre><p><code>EXIT</code> command will exit one level of <code>REPEAT/UNTIL</code>.</p>
<h4 id="-while-wend-exit-"><code>WHILE/WEND/EXIT</code></h4>
<pre><code><span class="hljs-keyword">while</span> expression
    instruction...
    [<span class="hljs-keyword">exit</span>]
wend
</code></pre><p>Repeat the list of <code>instruction...</code> while the <code>expression</code> above is true.
An <a href="#expressions">expression</a> is evaluated as <code>true</code> if the result of the expression is different from 0.</p>
<p><code>EXIT</code> instruction will exit one level of <code>WHILE/WEND</code>.</p>
<p>It different from <code>REPEAT/UNTIL</code> because <code>expression</code> is evaluated before the <code>instruction...</code> list is executed.</p>
<pre><code><span class="hljs-keyword">count</span>=<span class="hljs-number">0</span>
<span class="hljs-keyword">while</span> <span class="hljs-keyword">count</span>
<span class="hljs-keyword">print</span> <span class="hljs-string">"not executed"</span>
wend
</code></pre><h4 id="-for-to-next-exit-"><code>FOR/TO/NEXT/EXIT</code></h4>
<pre><code><span class="hljs-keyword">for</span> variable=begin to ended [step incr]
    instruction...
    [<span class="hljs-keyword">exit</span>]
<span class="hljs-keyword">next</span> identifier
</code></pre><p>Repeat the <code>instruction...</code> list while varying the value of the <code>variable</code> starting at <code>begin</code> <a href="#expressions">expression</a> until it reach <code>ended</code> expression included.
The increment can be changed using <code>incr</code>, allowing to iterates in reverse.</p>
<p>Real example that print numbers from 1 to 9 in ascending and descending order.</p>
<pre><code><span class="hljs-keyword">for</span> i=<span class="hljs-number">1</span> <span class="hljs-keyword">to</span> <span class="hljs-number">9</span>
    <span class="hljs-built_in">print</span> i;
<span class="hljs-keyword">next</span> i
<span class="hljs-built_in">print</span>
<span class="hljs-keyword">for</span> i=<span class="hljs-number">9</span> <span class="hljs-keyword">to</span> <span class="hljs-number">1</span> <span class="hljs-keyword">step</span> -<span class="hljs-number">1</span>
    <span class="hljs-built_in">print</span> i;
<span class="hljs-keyword">next</span> i
</code></pre><p><code>EXIT</code> command will exit one level of <code>FOR/TO/NEXT</code>.</p>
<h4 id="-goto-"><code>GOTO</code></h4>
<pre><code><span class="hljs-keyword">goto</span> <span class="hljs-keyword">label</span>
</code></pre><p>Make the execution of the program to jump at the specific <code>label</code>.</p>
<p>With <code>label</code> being declared somewhere in the program.</p>
<p>Real example of a tool that flip a coin:</p>
<pre><code>again:
    <span class="hljs-keyword">print</span>
    <span class="hljs-keyword">print</span> <span class="hljs-string">"tap to flip a coin"</span>
    <span class="hljs-keyword">wait</span> tap
    coin=<span class="hljs-keyword">rnd</span>(<span class="hljs-number">2</span>)
    <span class="hljs-keyword">if</span> coin=<span class="hljs-number">1</span> then <span class="hljs-keyword">goto</span> heads
    <span class="hljs-keyword">if</span> coin=<span class="hljs-number">2</span> then <span class="hljs-keyword">goto</span> tails
    <span class="hljs-keyword">goto</span> edge
heads:
    <span class="hljs-keyword">print</span> <span class="hljs-string">"heads"</span>
    <span class="hljs-keyword">goto</span> again
tails:
    <span class="hljs-keyword">print</span> <span class="hljs-string">"tails"</span>
    <span class="hljs-keyword">goto</span> again
edge:
    <span class="hljs-keyword">print</span> <span class="hljs-string">"edge of the coin!"</span>
    <span class="hljs-keyword">goto</span> again
</code></pre><h4 id="-gosub-return-"><code>GOSUB/RETURN</code></h4>
<pre><code>gosub <span class="hljs-keyword">label</span><span class="bash">
...
</span>return
</code></pre><p>Store the current location of the program execution <a href="#stack-subroutine-and-return">on top of the stack</a>, and jump at the specific <code>label</code>.</p>
<p>Expect to found a <code>RETURN</code> command to go back where it was right after the <code>GOSUB</code>.</p>
<p>The return location is store in a stack allow user to jump to a sub-routine and return from it.</p>
<blockquote>
<p>Best practice: always have one <code>RETURN</code> for each <code>GOSUB</code>.</p>
</blockquote>
<p>A common usage of sub-routine is to reuse a piece of code multiple times instead of rewrite it again.</p>
<blockquote>
<p>Users SHOULD place all sub-routines in one place near the end of the program to ensure they are not executed unintentionally.</p>
</blockquote>
<p>Real example. A score is incremented using time and tap:</p>
<pre><code>score=0
gosub <span class="hljs-keyword">update</span>
t=timer
<span class="hljs-keyword">do</span>
    <span class="hljs-keyword">if</span> timer-t&gt;<span class="hljs-number">30</span> <span class="hljs-keyword">then</span> gosub increase
    <span class="hljs-keyword">if</span> tap <span class="hljs-keyword">then</span> gosub increase
    <span class="hljs-keyword">wait</span> vbl
<span class="hljs-keyword">loop</span>
increase:
    inc score
    t=timer
<span class="hljs-keyword">update</span>:
    <span class="hljs-built_in">text</span> <span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-string">"score:"</span>+<span class="hljs-keyword">str</span>$(score)
    <span class="hljs-keyword">return</span>
</code></pre><p>This example has one <code>RETURN</code>, two labels and three <code>GOSUB</code>. The best practice mentioned above is not followed here, but here is the explanation.</p>
<p>The important thing is not the number of <code>RETURN</code> statements in the code but the number of times the command is executed. Users need to understand that one <code>GOSUB</code> execution will <a href="#stack-subroutine-and-return">increase by one the size of the stack</a>, and one execution of <code>RETURN</code> will reduce the same stack by exactly one. If the stack size is empty every time the <code>WAIT VBL</code> instruction is executed, it's a good sign. It means that the stack will not overflow.</p>
<p>Users can print the current stack using the <a href="#dbg-trace">debugger <code>TRACE</code> command</a>.</p>
<h4 id="-on-goto-br-on-gosub-"><code>ON GOTO</code><br><code>ON GOSUB</code></h4>
<pre><code><span class="hljs-keyword">on</span> <span class="hljs-keyword">value</span> <span class="hljs-keyword">goto</span> label0[,label1...]
</code></pre><p>Jump to one of the listed <code>label</code> according to a <code>value</code>.</p>
<p>With <code>ON GOSUB</code> will store the current program location on top of the stack before jumping, allowing to <code>RETURN</code> to this location later.</p>
<p>Will read the <code>value</code> and jump to:</p>
<ul>
<li>the first label if <code>value</code> equal 0,</li>
<li>the second label if <code>value</code> equal 1,</li>
<li>...</li>
</ul>
<p>Real example:</p>
<pre><code>again:
    <span class="hljs-keyword">wait</span> <span class="hljs-number">30</span>
    <span class="hljs-keyword">on</span> <span class="hljs-keyword">rnd</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">goto</span> zero,one
zero:
    <span class="hljs-keyword">print</span> <span class="hljs-string">"zero"</span>
    <span class="hljs-keyword">goto</span> again
one:
    <span class="hljs-keyword">print</span> <span class="hljs-string">"one"</span>
    <span class="hljs-keyword">goto</span> again
</code></pre><h4 id="-sub-end-sub-exit-sub-"><code>SUB/END SUB/EXIT SUB</code></h4>
<p>Syntax:</p>
<pre><code><span class="hljs-keyword">sub</span> name [(parameters...)]
    instruction...
<span class="hljs-keyword">end</span> <span class="hljs-keyword">sub</span>
</code></pre><p>This will define a procedure called <code>name</code> and can optionnaly received a list of <code>parameters</code>.</p>
<p>Syntax of the <code>parameters</code> list:</p>
<pre><code>(identifier[<span class="hljs-string">$</span>][<span class="hljs-symbol">()</span>], identifier[<span class="hljs-string">$</span>][<span class="hljs-symbol">()</span>]...)
</code></pre><p>Hm, it's a mess! Let me explain this. A parameter is always a <code>identifier</code> and can be followed by the type of value it contains. The list of possibilities are:</p>
<ul>
<li>a number: <code>my_num</code></li>
<li>a string: <code>my_str$</code></li>
<li>an array of number: <code>my_num_array()</code></li>
<li>an array of string: <code>my_str_array$()</code></li>
</ul>
<p>An empty list of <code>parameters</code> is not valid. Simply remove the parentheses <code>()</code>.</p>
<p>Procedures are isolated small programs that can be executed using the <code>CALL</code> command. They are isolated because <a href="#local-and-global-scope">variables declared inside are local</a>.</p>
<blockquote>
<p>Body of sub-routines are only executed through the <code>CALL</code> command, so it is safe to place them at the beginning of the program.</p>
</blockquote>
<p>Real example, a game where the player needs to enter a sequence of digits while the computer tries to prevent it:</p>
<pre><code><span class="hljs-comment">'perturb player input</span>
<span class="hljs-keyword">sub</span> perturb
    <span class="hljs-keyword">if</span> cursor.x&lt;<span class="hljs-number">10</span> <span class="hljs-keyword">then</span> print str$(rnd(<span class="hljs-number">9</span>));
<span class="hljs-keyword">end</span> <span class="hljs-keyword">sub</span>

<span class="hljs-comment">'handle player input</span>
<span class="hljs-keyword">sub</span> handle(c$)
    a=asc(c$)
    <span class="hljs-keyword">if</span> a=<span class="hljs-number">8</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">call</span> delete
    <span class="hljs-keyword">if</span> a&lt;<span class="hljs-number">48</span> <span class="hljs-keyword">or</span> a&gt;<span class="hljs-number">57</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">exit</span> <span class="hljs-keyword">sub</span>
    <span class="hljs-keyword">if</span> rnd&lt;<span class="hljs-number">0.3</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">call</span> perturb
    <span class="hljs-keyword">if</span> cursor.x&lt;<span class="hljs-number">10</span> <span class="hljs-keyword">then</span> print c$;
<span class="hljs-keyword">end</span> <span class="hljs-keyword">sub</span>

<span class="hljs-comment">'delete last character</span>
<span class="hljs-keyword">sub</span> delete
    <span class="hljs-keyword">if</span> cursor.x=<span class="hljs-number">0</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">exit</span> <span class="hljs-keyword">sub</span>
    locate cursor.x<span class="hljs-number">-1</span>,cursor.y
    <span class="hljs-keyword">text</span> cursor.x,cursor.y,<span class="hljs-string">" "</span>
<span class="hljs-keyword">end</span> <span class="hljs-keyword">sub</span>

<span class="hljs-comment">'check if input is correct</span>
<span class="hljs-keyword">sub</span> check(r$)
    r$=<span class="hljs-string">"       "</span>
    <span class="hljs-keyword">text</span> <span class="hljs-number">0</span>,<span class="hljs-number">2</span>,<span class="hljs-string">"       "</span>
    <span class="hljs-keyword">if</span> cursor.x&lt;<span class="hljs-number">10</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">exit</span> <span class="hljs-keyword">sub</span>
    ok=<span class="hljs-number">-1</span>
    <span class="hljs-keyword">for</span> i=<span class="hljs-number">0</span> <span class="hljs-keyword">to</span> <span class="hljs-number">9</span>
        <span class="hljs-keyword">if</span> cell.c(i,<span class="hljs-number">1</span>)<span class="hljs-number">-208</span>&lt;&gt;i <span class="hljs-keyword">then</span> ok=<span class="hljs-number">0</span>
    <span class="hljs-keyword">next</span> i
    r$=<span class="hljs-string">"failure"</span>
    <span class="hljs-keyword">if</span> ok <span class="hljs-keyword">then</span> r$=<span class="hljs-string">"success"</span>
<span class="hljs-keyword">end</span> <span class="hljs-keyword">sub</span>

<span class="hljs-comment">'main game</span>
print <span class="hljs-string">"write number form 0 to 9"</span>
result$=<span class="hljs-string">"       "</span>
keyboard <span class="hljs-keyword">on</span>
randomize timer
<span class="hljs-keyword">do</span>
    k$=inkey$
    <span class="hljs-keyword">if</span> k$&lt;&gt;<span class="hljs-string">""</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">call</span> handle(k$)
    wait vbl
    <span class="hljs-keyword">call</span> check(result$)
    <span class="hljs-keyword">text</span> <span class="hljs-number">0</span>,<span class="hljs-number">2</span>,result$
<span class="hljs-keyword">loop</span>
</code></pre><p><code>EXIT SUB</code> command will exit the <code>SUB</code>.</p>
<blockquote>
<p>Using <code>GOTO</code> inside a procedure is NOT RECOMMENDED, especially if the destination target is outside of the body. It will permanently increase the stack size without any possibility to reduce it.</p>
<p>Using <code>GOSUB</code> inside a procedure that jumps to a label outside of the body is NOT RECOMMENDED because the scope of the procedure will be used to execute the instructions.</p>
</blockquote>
<h3 id="embedded-data">Embedded data</h3>
<p>Retro Game Creator provides two ways to store data or assets inside a program.</p>
<ol>
<li><p>Use the combination of <code>DATA</code> and <code>READ</code> to store readable number and string and access it when you need it.</p>
<p> Real example that list the Straw Hat Pirates members:</p>
<pre><code> data <span class="hljs-number">11</span>
 data <span class="hljs-string">"lufy"</span>,<span class="hljs-number">19</span>,<span class="hljs-string">"zoro"</span>,<span class="hljs-number">21</span>,<span class="hljs-string">"nami"</span>,<span class="hljs-number">20</span>
 data <span class="hljs-string">"usopp"</span>,<span class="hljs-number">21</span>,<span class="hljs-string">"sanji"</span>,<span class="hljs-number">21</span>,<span class="hljs-string">"chopper"</span>,<span class="hljs-number">17</span>
 data <span class="hljs-string">"robin"</span>,<span class="hljs-number">30</span>,<span class="hljs-string">"franky"</span>,<span class="hljs-number">36</span>,<span class="hljs-string">"brook"</span>,<span class="hljs-number">90</span>
 data <span class="hljs-string">"jinbe"</span>,<span class="hljs-number">46</span>,<span class="hljs-string">"vivi"</span>,<span class="hljs-number">18</span>
 read count
 for i=<span class="hljs-number">1</span> to count
     read name$,age
     print name$,age
 next i
</code></pre><p> Internaly it will use a read pointer that iterates all constant values.</p>
</li>
<li><p>Use the <a href="#virtual-file">virtual file</a> system accessible throughout the <a href="#file-api">file API</a>.</p>
</li>
</ol>
<h4 id="-data-constant-constant-"><code>DATA constant[,constant...]</code></h4>
<p>A list of <code>constant</code> values (numbers or strings) that can be accessed using the <a href="#read-variablevariable"><code>READ</code></a> command.</p>
<h4 id="-read-variable-variable-"><code>READ variable[,variable...]</code></h4>
<p>Read a list of values inside <code>variable</code> that was declared using <a href="#data-constantconstant"><code>DATA</code></a>.</p>
<h4 id="-restore-label-"><code>RESTORE [label]</code></h4>
<p>Move the read pointer to a specified <code>label</code>. The declared constant values that appear after the label will be read next. When ommited, restore at the beginning of the program.</p>
<h4 id="-skip-number-"><code>SKIP number</code></h4>
<p>Allow to skip a <code>number</code> of constant values by moving the read pointer.</p>
<pre><code>data "failure"
data "success"
<span class="hljs-keyword">skip </span>1
read word$
print word$
</code></pre><h4 id="-on-restore-"><code>ON RESTORE</code></h4>
<pre><code><span class="hljs-keyword">on</span> value restore label0,[label1...]
</code></pre><p>Move the read pointer to one of the listed <code>label</code> according to a <code>value</code>.</p>
<h3 id="variables-and-scopes">Variables and scopes</h3>
<h4 id="-global-"><code>GLOBAL</code></h4>
<pre><code><span class="hljs-function"><span class="hljs-title">global</span></span> identifier...
</code></pre><p>Declare a list of number or string variables to be globally <a href="#local-and-global-scope">accessible in all scopes</a>.</p>
<p><code>GLOBAL</code> are illegal inside a <code>SUB/END SUB</code> subroutine body.</p>
<h4 id="-dim-"><code>DIM</code></h4>
<pre><code><span class="hljs-selector-tag">dim</span> <span class="hljs-selector-tag">identifier</span>(highest) <span class="hljs-selector-attr">[,identifier(highest)]</span>...
</code></pre><p>Will declare one or more arrays with <code>highest</code>+1 number of elements.</p>
<p>Arrays of numbers or strings MUST be declared before reading or writing them.</p>
<pre><code>dim scores(<span class="hljs-number">1</span>),names<span class="hljs-variable">$(</span><span class="hljs-number">1</span>)
<span class="hljs-keyword">for</span> i=<span class="hljs-number">0</span> to <span class="hljs-number">1</span>
    print names<span class="hljs-variable">$(</span>i);<span class="hljs-string">":"</span>,scores(i)
<span class="hljs-keyword">next</span> i
</code></pre><h4 id="-dim-global-"><code>DIM GLOBAL</code></h4>
<pre><code><span class="hljs-keyword">dim</span> <span class="hljs-keyword">global</span> identifier(highest) [,identifier(highest)]...
</code></pre><p>Similar to <code>DIM</code> but will <a href="#arrays">declare the arrays</a> <a href="#local-and-global-scope">globally accessible</a>.</p>
<p><code>DIM GLOBAL</code> are illegal inside a <code>SUB/END SUB</code> subroutine body.</p>
<h4 id="-ubound-"><code>=UBOUND</code></h4>
<pre><code>highest=<span class="hljs-built_in">ubound</span>(identifier[,<span class="hljs-keyword">dimension</span>])
</code></pre><p>Return the <code>highest</code> index of the array variable <code>identifier</code> at specified <code>dimension</code>.</p>
<h4 id="-swap-a-b-"><code>SWAP a,b</code></h4>
<p>Swap the values of the variable <code>a</code> and <code>b</code>. They have to share same type.</p>
<h2 id="api-instructions">API instructions</h2>
<p>¬´ An üåê<a href="https://en.wikipedia.org/wiki/API">application programming interface (API)</a> is a connection between computers or between computer programs. ¬ª</p>
<p>-- wikipedia</p>
<p>Retro Game Creator provide a bunch of built-in <a href="#commands">commands</a> and <a href="#functions">functions</a> to communicates with the differents features provided by the fantasy console: input, graphics, sound, memory and more.</p>
<h3 id="sprite-api">Sprite API</h3>
<p>Sprites are limited in numbers and SHOULD be used to show moving objects above background layers. It is not an obligation and interesting effects can be achieved by breaking these rules.</p>
<p>Check <a href="#sprites">how sprites works</a> and <a href="#sprite-registers">sprites registers</a>.</p>
<h4 id="-sprite-sprite-x-y-character-"><code>SPRITE sprite,[x],[y],[character]</code></h4>
<p>Sets the position <code>x</code> and <code>y</code> in pixel coordinates and <code>character</code> number of the <code>sprite</code>.</p>
<p><code>x</code>,<code>y</code> and <code>character</code> can be ommited to keep their current value.</p>
<p>An example that show a smiley sprite moving in circle:</p>
<pre><code>i=0
<span class="hljs-keyword">do</span>
    <span class="hljs-keyword">add</span> i,<span class="hljs-number">1</span>,<span class="hljs-number">0</span> <span class="hljs-keyword">to</span> <span class="hljs-number">99</span>
    sprite <span class="hljs-number">0</span>,<span class="hljs-keyword">cos</span>(i/<span class="hljs-number">100</span>)*<span class="hljs-number">40</span>+<span class="hljs-number">60</span>,<span class="hljs-keyword">sin</span>(i/<span class="hljs-number">100</span>)*<span class="hljs-number">40</span>+<span class="hljs-number">60</span>,<span class="hljs-number">1</span>
    <span class="hljs-keyword">wait</span> vbl
<span class="hljs-keyword">loop</span>

#<span class="hljs-number">2</span>:<span class="hljs-keyword">MAIN</span> <span class="hljs-keyword">CHARACTERS</span>
<span class="hljs-number">00000000000000000000000000000000</span>
<span class="hljs-number">007</span>EFFFFEDFFFF7E0000003636000000
</code></pre><p>Omitted parameters will keep their previous values.</p>
<h4 id="-sprite-sprite-pal-palette-flip-horizontal-vertical-prio-priority-size-size-"><code>SPRITE sprite [PAL palette] [FLIP horizontal,vertical] [PRIO priority] [SIZE size]</code></h4>
<p>Sets one or more attributes for the <code>sprite</code>:</p>
<ul>
<li><code>PAL palette</code> Change the <code>palette</code> (0..7).</li>
<li><code>FLIP horizontal,vertical</code> Flip the sprite on <code>horizontal</code> and <code>vertical</code> axis.</li>
<li><code>PRIO priority</code> Change the <code>priority</code> (0..1).</li>
<li><code>SIZE s</code> Change the size, a.k.a.: the number of characters width and height.</li>
</ul>
<p>Omitted parameters will keep their previous values.</p>
<p>Example of a sprite that get flipped according to it's position on the screen:</p>
<pre><code><span class="hljs-keyword">do</span>
    sprite <span class="hljs-number">0</span>,<span class="hljs-keyword">touch</span>.x,<span class="hljs-keyword">touch</span>.y,<span class="hljs-number">1</span>
    sprite <span class="hljs-number">0</span> pal <span class="hljs-number">6</span>
    sprite <span class="hljs-number">0</span> flip <span class="hljs-keyword">touch</span>.x&gt;shown.w/<span class="hljs-number">2</span>,<span class="hljs-keyword">touch</span>.y&gt;shown.h/<span class="hljs-number">2</span>
    <span class="hljs-keyword">wait</span> vbl
loop

#<span class="hljs-number">2</span>:MAIN CHARACTERS
<span class="hljs-number">00000000000000000000000000000000</span>
0A0D0E8F4D0E818C06030180C305808
</code></pre><h4 id="-x-sprite-x-sprite-br-y-sprite-y-sprite-"><code>x=SPRITE.X(sprite)</code><br><code>y=SPRITE.Y(sprite)</code></h4>
<p>Return the position <code>x</code> or <code>y</code> of the <code>sprite</code> (0..169) in pixels.</p>
<p>Example of a sprite smoothly following the finger touch:</p>
<pre><code>sprite <span class="hljs-number">0</span>,shown<span class="hljs-selector-class">.w</span>,shown<span class="hljs-selector-class">.h</span>,<span class="hljs-number">1</span>
do
    x=sprite.x(<span class="hljs-number">0</span>)+(touch<span class="hljs-selector-class">.x-sprite</span><span class="hljs-selector-class">.x</span>(<span class="hljs-number">0</span>))/<span class="hljs-number">4</span>
    y=sprite.y(<span class="hljs-number">0</span>)+(touch<span class="hljs-selector-class">.y-sprite</span><span class="hljs-selector-class">.y</span>(<span class="hljs-number">0</span>))/<span class="hljs-number">4</span>
    sprite <span class="hljs-number">0</span>,x,y,
    wait vbl
loop

#<span class="hljs-number">2</span>:MAIN CHARACTERS
<span class="hljs-number">00000000000000000000000000000000</span>
<span class="hljs-number">007</span>E7E66667E7E00FF81BDA5A5BD81FF
</code></pre><h4 id="-character-sprite-c-sprite-"><code>character=SPRITE.C(sprite)</code></h4>
<p>Return the first <code>character</code> number of the <code>sprite</code> (0..169).</p>
<h4 id="-sprite-a-sprite-attributes-"><code>SPRITE.A sprite,attributes</code></h4>
<p>Sets all <code>attributes</code> at once for the <code>sprite</code>.</p>
<p>Check <a href="#character-attributes">Character attributes</a>.</p>
<h4 id="-attributes-sprite-a-sprite-"><code>attributes=SPRITE.A(sprite)</code></h4>
<p>Return the whole <code>attributes</code> flags of the <code>sprite</code> (0..169).</p>
<p>Example: that show how to read sprite attributes:</p>
<pre><code>sprite <span class="hljs-number">0</span>,<span class="hljs-number">80</span>,<span class="hljs-number">80</span>,<span class="hljs-number">1</span>
sprite.<span class="hljs-keyword">a</span> <span class="hljs-number">0</span>,<span class="hljs-number">255</span>
<span class="hljs-built_in">do</span>
    <span class="hljs-keyword">text</span> <span class="hljs-number">4</span>,<span class="hljs-number">4</span>,<span class="hljs-string">"palette: 00000"</span>+bin$(sprite.<span class="hljs-keyword">a</span>(<span class="hljs-number">0</span>) <span class="hljs-keyword">and</span> %<span class="hljs-number">111</span>)
    <span class="hljs-keyword">text</span> <span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-string">"flip:    000"</span>+bin$(sprite.<span class="hljs-keyword">a</span>(<span class="hljs-number">0</span>) <span class="hljs-keyword">and</span> %<span class="hljs-number">11000</span>)
    <span class="hljs-keyword">text</span> <span class="hljs-number">4</span>,<span class="hljs-number">6</span>,<span class="hljs-string">"size:    0"</span>+bin$(sprite.<span class="hljs-keyword">a</span>(<span class="hljs-number">0</span>) <span class="hljs-keyword">and</span> %<span class="hljs-number">1100000</span>)
    <span class="hljs-built_in">wait</span> tap
    sprite.<span class="hljs-keyword">a</span> <span class="hljs-number">0</span>,rnd(<span class="hljs-number">255</span>)
loop

<span class="hljs-comment">#2:MAIN CHARACTERS</span>
<span class="hljs-number">00000000000000000000000000000000</span>
<span class="hljs-number">40</span>A0D0E8F4D0E818C06030180C305808
</code></pre><h4 id="-sprite-off-"><code>SPRITE OFF</code></h4>
<p>Hides all sprites.</p>
<h4 id="-sprite-off-sprite-"><code>SPRITE OFF sprite</code></h4>
<p>Hide one <code>sprite</code>.</p>
<p>Example that hide a sprite at each tap:</p>
<pre><code><span class="hljs-keyword">for</span> i=<span class="hljs-number">0</span> to <span class="hljs-number">159</span>
    sprite <span class="hljs-selector-tag">i</span>,rnd(shown.w-<span class="hljs-number">8</span>),rnd(shown.h-<span class="hljs-number">8</span>),<span class="hljs-number">1</span>
next <span class="hljs-selector-tag">i</span>
i=<span class="hljs-number">0</span>
while i&lt;<span class="hljs-number">159</span>
    wait tap
    sprite off <span class="hljs-selector-tag">i</span>
    add <span class="hljs-selector-tag">i</span>,<span class="hljs-number">1</span>
wend

#<span class="hljs-number">2</span>:MAIN CHARACTERS
<span class="hljs-number">00000000000000000000000000000000</span>
<span class="hljs-number">0000000000000000</span>FFFFFFFFFFFFFFFF
</code></pre><h4 id="-sprite-off-sprite1-to-sprite2-"><code>SPRITE OFF sprite1 TO sprite2</code>.</h4>
<p>Hides all sprites from range <code>sprite1</code> to <code>sprite2</code> included.</p>
<h4 id="-collides-sprite-hit-sprite-"><code>collides=SPRITE HIT(sprite)</code></h4>
<p>Return if the <code>sprite</code> (0..169) <code>collides</code> (0/-1) with another sprite. Collision detection is done by checking overlapping pixels that are not transparent (a.k.a.: not using the color 0).</p>
<p>Example of a ball that bounce on the wall and fall into holes:</p>
<pre><code>again:
for <span class="hljs-attr">i=1</span> to <span class="hljs-number">20</span>
    sprite i,rnd(shown.w)-<span class="hljs-number">8</span>,rnd(shown.h)-<span class="hljs-number">8</span>,<span class="hljs-number">2</span>
next i
<span class="hljs-attr">x=0</span>
<span class="hljs-attr">y=0</span>
<span class="hljs-attr">sx=1</span>
<span class="hljs-attr">sy=1</span>
do
    sprite <span class="hljs-number">0</span>,x,y,<span class="hljs-number">1</span>
    <span class="hljs-keyword">if</span> sprite hit(<span class="hljs-number">0</span>) <span class="hljs-keyword">then</span>
        wait <span class="hljs-number">30</span>
        goto again
    end <span class="hljs-keyword">if</span>
    wait vbl
    <span class="hljs-attr">x=sprite.x(0)+sx</span>
    <span class="hljs-attr">y=sprite.y(0)+sy</span>
    <span class="hljs-keyword">if</span> x&lt;<span class="hljs-number">0</span> <span class="hljs-literal">or</span> x&gt;shown.w-<span class="hljs-number">8</span> <span class="hljs-keyword">then</span> <span class="hljs-attr">sx=-sx</span>
    <span class="hljs-keyword">if</span> y&lt;<span class="hljs-number">0</span> <span class="hljs-literal">or</span> y&gt;shown.h-<span class="hljs-number">8</span> <span class="hljs-keyword">then</span> <span class="hljs-attr">sy=-sy</span>
loop

<span class="hljs-comment">#1:MAIN PALETTES</span>
<span class="hljs-number">0405</span>

<span class="hljs-comment">#2:MAIN CHARACTERS</span>
<span class="hljs-number">00000000000000000000000000000000</span>
<span class="hljs-number">003</span>C7E7A72623C00000030240C1C0000
<span class="hljs-number">000000010101021</span>C003C7E7F7F7F3E1C
</code></pre><p>Use <a href="#sprite-hit"><code>sprite=HIT</code></a> to the colliding <code>sprite</code>.</p>
<h4 id="-collides-sprite-hit-sprite-sprite1-"><code>collides=SPRITE HIT(sprite,sprite1)</code></h4>
<p>Return if the <code>sprite</code> (0..169) <code>collides</code> (0/-1) with the <code>sprite1</code>.</p>
<p>Example of two owerlapping sprites:</p>
<pre><code>sprite 20,46,46,1
<span class="hljs-keyword">do</span>
sprite <span class="hljs-number">10</span>,<span class="hljs-number">40</span>+((timer/<span class="hljs-number">60</span>) <span class="hljs-keyword">mod</span> <span class="hljs-number">2</span>)*<span class="hljs-number">4</span>,<span class="hljs-number">40</span>,<span class="hljs-number">1</span>
<span class="hljs-keyword">if</span> sprite hit(<span class="hljs-number">10</span>,<span class="hljs-number">20</span>) <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">text</span> <span class="hljs-number">8</span>,<span class="hljs-number">5</span>,<span class="hljs-string">"hit"</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">text</span> <span class="hljs-number">8</span>,<span class="hljs-number">5</span>,<span class="hljs-string">"   "</span>
<span class="hljs-keyword">end</span> <span class="hljs-keyword">if</span>
<span class="hljs-keyword">wait</span> vbl
<span class="hljs-keyword">loop</span>

#<span class="hljs-number">2</span>:<span class="hljs-keyword">MAIN</span> <span class="hljs-keyword">CHARACTERS</span>
<span class="hljs-number">00000000000000000000000000000000</span>
FFFFFFFFF0F0F0F00000000000000000
</code></pre><p>Use <a href="#sprite-hit"><code>sprite=HIT</code></a> to the colliding <code>sprite</code>.</p>
<h4 id="-sprite-hit-sprite-sprite1-to-sprite2-"><code>=SPRITE.HIT(sprite,sprite1 to sprite2)</code></h4>
<p>Return if the <code>sprite</code> (0..169) <code>collides</code> with any other from the range <code>sprite1</code> to <code>sprite2</code> included (0..169).</p>
<p>Use <a href="#sprite-hit"><code>sprite=HIT</code></a> to the colliding <code>sprite</code>.</p>
<h4 id="-sprite-hit-"><code>sprite=HIT</code></h4>
<p>Return the <code>sprite</code> which collided, resulting of the last <code>=SPRITE.HIT()</code> function call (any of the three form).</p>
<p>Example of a ball that bounce on the wall and destroy the obstable:</p>
<pre><code>for <span class="hljs-attr">i=1</span> to <span class="hljs-number">20</span>
    sprite i,rnd(shown.w)-<span class="hljs-number">8</span>,rnd(shown.h)-<span class="hljs-number">8</span>,<span class="hljs-number">2</span>
next i
again:
<span class="hljs-attr">x=0</span>
<span class="hljs-attr">y=0</span>
<span class="hljs-attr">sx=1</span>
<span class="hljs-attr">sy=1</span>
do
    sprite <span class="hljs-number">0</span>,x,y,<span class="hljs-number">1</span>
    <span class="hljs-keyword">if</span> sprite hit(<span class="hljs-number">0</span>,<span class="hljs-number">1</span> to <span class="hljs-number">20</span>) <span class="hljs-keyword">then</span>
        wait <span class="hljs-number">15</span>
        sprite off hit
        goto again
    end <span class="hljs-keyword">if</span>
    wait vbl
    <span class="hljs-attr">x=sprite.x(0)+sx</span>
    <span class="hljs-attr">y=sprite.y(0)+sy</span>
    <span class="hljs-keyword">if</span> x&lt;<span class="hljs-number">0</span> <span class="hljs-literal">or</span> x&gt;shown.w-<span class="hljs-number">8</span> <span class="hljs-keyword">then</span> <span class="hljs-attr">sx=-sx</span>
    <span class="hljs-keyword">if</span> y&lt;<span class="hljs-number">0</span> <span class="hljs-literal">or</span> y&gt;shown.h-<span class="hljs-number">8</span> <span class="hljs-keyword">then</span> <span class="hljs-attr">sy=-sy</span>
loop

<span class="hljs-comment">#1:MAIN PALETTES</span>
<span class="hljs-number">0405</span>

<span class="hljs-comment">#2:MAIN CHARACTERS</span>
<span class="hljs-number">00000000000000000000000000000000</span>
<span class="hljs-number">003</span>C7E7A72623C00000030240C1C0000
<span class="hljs-number">000000010101021</span>C003C7E7F7F7F3E1C
</code></pre><h3 id="background-api">Background API</h3>
<p>The most basic way of drawing using the background API is to, first, choose which cell's attribute to use, then paint the cells with a characters number.</p>
<p>Another way of doing is to copy attributes and characters from memory.</p>
<p>Aside to that, there is an API to scroll the layers.</p>
<p>Text generally use background mechanics as well, there is an <a href="#text-api">API to draw text</a> too.</p>
<p>Check <a href="#backgrounds">How backgrounds works</a> and <a href="#background-data">background data</a>.</p>
<h4 id="-cls-"><code>CLS</code></h4>
<p>Clear all background layers with character zero 0, resets the current window to the default and the layer scrolling values.</p>
<h4 id="-cls-layer-"><code>CLS layer</code></h4>
<p>Only clear the background layer numbered <code>layer</code> with character zero 0. Do not alter the scrolling value.</p>
<h4 id="-scroll-layer-x-y-"><code>SCROLL layer,[x],[y]</code></h4>
<p>Set the scroll offset on <code>x</code> and <code>y</code> axis of the <code>layer</code> in pixels.</p>
<pre><code>text <span class="hljs-number">10</span>,<span class="hljs-number">10</span>,<span class="hljs-string">"hello!"</span>
bg <span class="hljs-number">1</span>
text <span class="hljs-number">10</span>,<span class="hljs-number">10</span>,<span class="hljs-string">"hello!"</span>
scroll <span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">-4</span>
</code></pre><p>Omitted parameters will keep their previous values.</p>
<h4 id="-x-scroll-x-layer-br-y-scroll-y-layer-"><code>x=SCROLL.X(layer)</code><br><code>y=SCROLL.Y(layer)</code></h4>
<p>Return the scroll offset on <code>x</code> and <code>y</code> axis of the <code>layer</code> in pixels.</p>
<p>Example of getting the scroll offset of the background layer:</p>
<pre><code><span class="hljs-keyword">for</span> x=<span class="hljs-number">0</span> to <span class="hljs-number">63</span>
<span class="hljs-keyword">for</span> y=<span class="hljs-number">0</span> to <span class="hljs-number">63</span>
    cell x,y,rnd(<span class="hljs-number">3</span>)
next y
next x
<span class="hljs-keyword">do</span>
    x=<span class="hljs-keyword">scroll</span>.x(<span class="hljs-number">0</span>)+(touch.x-<span class="hljs-keyword">scroll</span>.x(<span class="hljs-number">0</span>))/<span class="hljs-number">4</span>
    y=<span class="hljs-keyword">scroll</span>.y(<span class="hljs-number">0</span>)+(touch.y-<span class="hljs-keyword">scroll</span>.y(<span class="hljs-number">0</span>))/<span class="hljs-number">4</span>
    <span class="hljs-keyword">scroll</span> <span class="hljs-number">0</span>,x,y
    <span class="hljs-built_in">wait</span> vbl
loop

<span class="hljs-meta">#2:MAIN CHARACTERS</span>
<span class="hljs-number">00000000000000000000000000000000</span>
FFFFFFFFFFFFFFFF0000000000000000
<span class="hljs-number">0000000000000000</span>FFFFFFFFFFFFFFFF
FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
</code></pre><h4 id="-bg-layer-"><code>BG layer</code></h4>
<p>Change the current <code>layer</code> (0..3) for further cells draw operations.</p>
<pre><code>bg <span class="hljs-number">0</span>
text <span class="hljs-number">10</span>,<span class="hljs-number">10</span>,<span class="hljs-string">"<span class="hljs-subst">\"</span>
bg 1
text 10,10,"</span>/<span class="hljs-string">"</span>
</code></pre><h4 id="-pal-palette-"><code>PAL palette</code></h4>
<p>Change the current <code>palette</code> for further cells draw operations.</p>
<pre><code><span class="hljs-built_in">print</span> <span class="hljs-string">"hello"</span>,
pal <span class="hljs-number">1</span>
<span class="hljs-built_in">print</span> <span class="hljs-string">"world"</span>
</code></pre><h4 id="-flip-horizontal-vertical-"><code>FLIP [horizontal],[vertical]</code></h4>
<p>Change the <code>horizontal</code> and <code>vertical</code> flip attributes for further cells draw operations, considering 0 as not flipped and something else as flipped.</p>
<pre><code>flip <span class="hljs-number">1</span>,<span class="hljs-number">0</span>
print <span class="hljs-string">"dlrow olleh"</span>
</code></pre><p>Omitted parameters will keep their previous values.</p>
<h4 id="-prio-priority-"><code>PRIO priority</code></h4>
<p>Change the <code>priority</code> for further cells draw operations.</p>
<pre><code>sprite <span class="hljs-number">0</span>,<span class="hljs-number">78</span>,<span class="hljs-number">78</span>,<span class="hljs-number">1</span>
prio <span class="hljs-number">1</span>
<span class="hljs-built_in">text</span> <span class="hljs-number">10</span>,<span class="hljs-number">10</span>,<span class="hljs-string">"s"</span>

<span class="hljs-comment">#2:MAIN CHARACTERS</span>
<span class="hljs-number">00000000000000000000000000000000</span>
<span class="hljs-number">003</span>C7E6A7E7E3C000000183C00000000
</code></pre><h4 id="-attr-attributes-"><code>ATTR attributes</code></h4>
<p>Sets the palette, flip and priority <code>attributes</code> all at once for further cells draw operations.</p>
<p>Check the <a href="#cell-attributes">cell attributes reference</a>.</p>
<h4 id="-cell-x-y-character-"><code>CELL x,y,[character]</code></h4>
<p>Draw to the <code>x</code>,<code>y</code> cell of the <a href="#bg-layer"><code>current layer</code></a> with the <code>character</code> using the current attributes.</p>
<p>By omiting the <code>character</code> argument, the command will only alter the attributes: palette, flip and priority.</p>
<p>Use <a href="#bg-layer"><code>BG layer</code></a>, <a href="#pal-palette"><code>PAL palette</code></a>, <a href="#flip-horizontal-vertical"><code>FLIP horizontal,vertical</code></a>, <a href="#prio-priority"><code>PRIO priority</code></a> and <a href="#attr-attributes"><code>ATTR attributes</code></a> to alter the <a href="#cells-attributes">current attributes</a>.</p>
<p>E.g. draw a face:</p>
<pre><code><span class="hljs-selector-tag">cell</span> 10,10,1

<span class="hljs-selector-id">#2</span><span class="hljs-selector-pseudo">:MAIN</span> <span class="hljs-selector-tag">CHARACTERS</span>
00000000000000000000000000000000
003<span class="hljs-selector-tag">C7E6A7E7E3C000000183C00000000</span>
</code></pre><p>E.g. draw an inverted blue r letter:</p>
<pre><code>cell <span class="hljs-number">10</span>,<span class="hljs-number">10</span>,<span class="hljs-number">242</span>
flip <span class="hljs-number">1</span>,<span class="hljs-number">0</span>
pal <span class="hljs-number">1</span>
cell <span class="hljs-number">10</span>,<span class="hljs-number">10</span>,
</code></pre><h4 id="-character-cell-c-x-y-"><code>character=CELL.C(x,y)</code></h4>
<p>Return the <code>character</code> of the <code>x</code>,<code>y</code> cell from the <a href="#bg-layer"><code>current layer</code></a>.</p>
<p>Example of reading the ASCII code of a character:</p>
<pre><code>bg <span class="hljs-number">2</span>
<span class="hljs-keyword">for</span> x=<span class="hljs-number">0</span> <span class="hljs-keyword">to</span> shown.w<span class="hljs-string">\8</span>
<span class="hljs-keyword">for</span> y=<span class="hljs-number">0</span> <span class="hljs-keyword">to</span> shown.h<span class="hljs-string">\8</span>
    cell x,y,<span class="hljs-number">192</span>+rnd(<span class="hljs-number">63</span>)
next y
next x
bg <span class="hljs-number">1</span>
bg copy <span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">6</span>,<span class="hljs-number">4</span> <span class="hljs-keyword">to</span> <span class="hljs-number">4</span>,<span class="hljs-number">4</span>

<span class="hljs-keyword">do</span>
    bg <span class="hljs-number">2</span>
    c=cell.c(touch.x<span class="hljs-string">\8,touch.y\8)</span>
    bg <span class="hljs-number">0</span>
    text <span class="hljs-number">5</span>,<span class="hljs-number">5</span>,<span class="hljs-string">"$"</span>+right$(<span class="hljs-string">"0"</span>+hex$(c-<span class="hljs-number">192</span>),<span class="hljs-number">2</span>)
    wait vbl
<span class="hljs-keyword">loop</span>

<span class="hljs-comment">#2:MAIN CHARACTERS</span>
<span class="hljs-number">00000000000000000000000000000000</span>
FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
<span class="hljs-number">0000000000000000</span>FFFFFFFFFFFFFFFF

<span class="hljs-comment">#3:MAIN BG</span>
<span class="hljs-number">00000604010001000100010001000000</span>
<span class="hljs-number">01000100010001000100020001000100</span>
<span class="hljs-number">01000100010002000000020002000200</span>
<span class="hljs-number">02000200</span>
</code></pre><h4 id="-attributes-cell-a-x-y-"><code>attributes=CELL.A(x,y)</code></h4>
<p>Return the <code>attributes</code> of the <code>x</code>,<code>y</code> call from <a href="#bg-layer"><code>current layer</code></a>.</p>
<p>Example that display cell's attributes:</p>
<pre><code>bg <span class="hljs-number">2</span>
<span class="hljs-keyword">for</span> x=<span class="hljs-number">0</span> <span class="hljs-built_in">to</span> shown.w\<span class="hljs-number">8</span>
<span class="hljs-keyword">for</span> y=<span class="hljs-number">0</span> <span class="hljs-built_in">to</span> shown.h\<span class="hljs-number">8</span>
    attr rnd(<span class="hljs-number">255</span>)
    cell x,y,<span class="hljs-number">192</span>+rnd(<span class="hljs-number">63</span>)
next y
next x
bg <span class="hljs-number">1</span>
bg fill <span class="hljs-number">5</span>,<span class="hljs-number">5</span> <span class="hljs-built_in">to</span> <span class="hljs-number">13</span>,<span class="hljs-number">9</span> <span class="hljs-keyword">char</span> <span class="hljs-number">2</span>
bg fill <span class="hljs-number">4</span>,<span class="hljs-number">4</span> <span class="hljs-built_in">to</span> <span class="hljs-number">12</span>,<span class="hljs-number">8</span> <span class="hljs-keyword">char</span> <span class="hljs-number">1</span>
bg <span class="hljs-number">0</span>
pal <span class="hljs-number">0</span>
prio <span class="hljs-number">1</span>
flip <span class="hljs-number">0</span>,<span class="hljs-number">0</span>
<span class="hljs-keyword">text</span> <span class="hljs-number">5</span>,<span class="hljs-number">5</span>,<span class="hljs-string">"Pal:"</span>
<span class="hljs-keyword">text</span> <span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-string">"Flip:"</span>
<span class="hljs-keyword">text</span> <span class="hljs-number">5</span>,<span class="hljs-number">7</span>,<span class="hljs-string">"Prio:"</span>
<span class="hljs-built_in">do</span>
    bg <span class="hljs-number">2</span>
    <span class="hljs-keyword">a</span>=cell.<span class="hljs-keyword">a</span>(touch.x\<span class="hljs-number">8</span>,touch.y\<span class="hljs-number">8</span>)
    bg <span class="hljs-number">0</span>
    <span class="hljs-keyword">text</span> <span class="hljs-number">9</span>,<span class="hljs-number">5</span>,<span class="hljs-literal">right</span>$(<span class="hljs-string">"00"</span>+bin$(<span class="hljs-keyword">a</span> <span class="hljs-keyword">and</span> %<span class="hljs-number">111</span>),<span class="hljs-number">3</span>)
    <span class="hljs-keyword">text</span> <span class="hljs-number">10</span>,<span class="hljs-number">6</span>,<span class="hljs-literal">right</span>$(<span class="hljs-string">"0"</span>+bin$((<span class="hljs-keyword">a</span>\<span class="hljs-number">8</span>) <span class="hljs-keyword">and</span> %<span class="hljs-number">11</span>),<span class="hljs-number">2</span>)
    <span class="hljs-keyword">text</span> <span class="hljs-number">10</span>,<span class="hljs-number">7</span>,<span class="hljs-literal">right</span>$(<span class="hljs-string">"0"</span>+bin$((<span class="hljs-keyword">a</span>\<span class="hljs-number">32</span>) <span class="hljs-keyword">and</span> %<span class="hljs-number">11</span>),<span class="hljs-number">2</span>)
    <span class="hljs-built_in">wait</span> vbl
loop

<span class="hljs-comment">#2:MAIN CHARACTERS</span>
<span class="hljs-number">00000000000000000000000000000000</span>
FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
<span class="hljs-number">0000000000000000</span>FFFFFFFFFFFFFFFF
</code></pre><p>Check the <a href="#cell-attributes">cell attributes reference</a>.</p>
<h4 id="-bg-fill-x1-y1-to-x2-y2-char-character-"><code>BG FILL x1,y1 TO x2,y2 CHAR character</code></h4>
<p>Fills all cells from <code>x1</code>,<code>y1</code> coordinates to <code>x2</code>,<code>y2</code> with <code>character</code> and the current attributes.</p>
<pre><code>bg<span class="hljs-built_in"> fill </span>1,1 to 5,5 char 1
bg<span class="hljs-built_in"> fill </span>2,2 to 4,4 char 2

<span class="hljs-comment">#2:MAIN CHARACTERS</span>
00000000000000000000000000000000
FFFFFFFFFFFFFFFF0000000000000000
0000000000000000FFFFFFFFFFFFFFFF
</code></pre><h4 id="-tint-y-y-pal-palette-flip-horizontal-vertical-prio-priority-"><code>TINT y,y [PAL palette] [FLIP horizontal,vertical] [PRIO priority]</code></h4>
<p>Sets to the cell <code>x</code>,<code>y</code> (0..63) of the <a href="#bg-layer"><code>current layer</code></a>, one or more attributes: <code>palette</code> (0..3), <code>horizontal</code> (0/1) and <code>vertical</code> (0/1) flip and <code>priority</code> (0/1).</p>
<pre><code>print <span class="hljs-string">"hello!"</span>
tint <span class="hljs-number">5</span>,<span class="hljs-number">0</span> pal <span class="hljs-number">7</span>
</code></pre><h4 id="-bg-tint-y1-y1-to-x2-y2-pal-palette-flip-horizontal-vertical-prio-priority-"><code>BG TINT y1,y1 TO x2,y2 [PAL palette] [FLIP horizontal,vertical] [PRIO priority]</code></h4>
<p>Sets to the cells from the rectangle <code>x1</code>,<code>y1</code> to <code>x2</code>,<code>y2</code> (0..63), one or more attributes: <code>palette</code> (0..3), <code>horizontal</code> (0/1) and <code>vertical</code> (0/1) flip and <code>priority</code> (0/1).</p>
<p>Similar to <code>TINT y,y [PAL pal] [FLIP h,v] [PRIO p]</code> but with a rectangle of cells instead of just one.</p>
<h4 id="-bg-scroll-x1-y1-to-x2-y2-step-x3-y3-"><code>BG SCROLL x1,y1 to x2,y2 step x3,y3</code></h4>
<p>Move the cell's attributes and character from the rectangle <code>x1</code>,<code>y1</code> to <code>x2</code>,<code>y2</code> (0..63) of the <a href="#bg-layer"><code>current layer</code></a> by <code>x3</code>,<code>y3</code> in cell coordinates.</p>
<p>This feature is internally used to scroll text when it reach the bottom of the <a href="#window-xywidthheightlayer">window</a>.</p>
<h4 id="-bg-source-address-width-height-"><code>BG SOURCE address[,width,height]</code></h4>
<p>Set the memory <code>address</code> to use as source for <a href="#bg-copy-x1-y1-width-height-to-x2-y2"><code>BG COPY x1,y1,width,height TO x2,y2</code></a> operations.</p>
<p>When <code>width</code> and <code>height</code> are specified, they are used as indiquating the number of cells in the source.</p>
<p>If they are not specified, the <a href="#background-source-data">official background data format</a> are used to retrieve the width and the height.</p>
<blockquote>
<p>When the program is stared the default address is taken by internally executing <code>BG SOURCE ROM(3)</code></p>
</blockquote>
<p>Example that generate background using random numbers:</p>
<pre><code>a=$<span class="hljs-number">9000</span>
for r=<span class="hljs-number">0</span> to <span class="hljs-number">63</span>
    for c=<span class="hljs-number">0</span> to <span class="hljs-number">63</span>
        poke a,<span class="hljs-number">1</span>
        inc a
        poke a,rnd(<span class="hljs-number">1</span>)*<span class="hljs-number">8</span>
        inc a
    next c
next r

bg source $<span class="hljs-number">9000</span>,<span class="hljs-number">64</span>,<span class="hljs-number">64</span>
bg copy <span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">64</span>,<span class="hljs-number">64</span> to <span class="hljs-number">0</span>,<span class="hljs-number">0</span>

do
x=<span class="hljs-number">0</span>
add x,sin(<span class="hljs-section">timer</span>/<span class="hljs-number">600</span>)*cos(<span class="hljs-section">timer</span>/<span class="hljs-number">6000</span>)*<span class="hljs-number">200</span>
add x,sin(<span class="hljs-section">timer</span>/<span class="hljs-number">500</span>)*<span class="hljs-number">50</span>

y=<span class="hljs-number">0</span>
add y,cos(<span class="hljs-section">timer</span>/<span class="hljs-number">400</span>)*sin(<span class="hljs-section">timer</span>/<span class="hljs-number">4000</span>)*<span class="hljs-number">200</span>
add y,cos(<span class="hljs-section">timer</span>/<span class="hljs-number">700</span>)*<span class="hljs-number">50</span>

scroll <span class="hljs-number">0</span>,x,y
wait vbl
loop
</code></pre><h4 id="-bg-copy-x1-y1-width-height-to-x2-y2-"><code>BG COPY x1,y1,width,height TO x2,y2</code></h4>
<p>Copy from the rectangle <code>x1</code>,<code>y1</code> (0..63) with <code>width</code>,<code>height</code> (0..63) the cell's attributes and character numbers from background source specified previously using <a href="#bg-source-address-width-height"><code>BG SOURCE address[,width,height]</code></a> to <code>x2</code>,<code>y2</code> (0..63) of the current background layer.</p>
<h4 id="-mcell-x-y-character-"><code>MCELL x,y,character</code></h4>
<p>Draw to the <code>x</code>,<code>y</code> cell to the background source specified previously using <a href="#bg-source-address-width-height"><code>BG SOURCE address[,width,height]</code></a> with the <code>character</code> using the current attributes.</p>
<p>Similar to <a href="#cell-x-y-character"><code>CELL x,y,character</code></a> but modify the source in memory instead of the <a href="#bg-layer"><code>current layer</code></a>.</p>
<p>The source MUST point to writable memory. It will NOT work with <code>BG SOURCE ROM(3)</code>.</p>
<p>Example that continously draw to the background source:</p>
<pre><code>text 4,4,"touch to copy"
bg 1
bg source $a000,64,64

<span class="hljs-keyword">do</span>
    pal rnd(<span class="hljs-number">7</span>)
    mcell rnd(<span class="hljs-keyword">ceil</span>(shown.w/<span class="hljs-number">8</span>)),rnd(<span class="hljs-keyword">ceil</span>(shown.h/<span class="hljs-number">8</span>)),rnd(<span class="hljs-number">1</span>)
    <span class="hljs-keyword">if</span> touch <span class="hljs-keyword">then</span>
        bg copy <span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-keyword">ceil</span>(shown.w/<span class="hljs-number">8</span>),<span class="hljs-keyword">ceil</span>(shown.h/<span class="hljs-number">8</span>) <span class="hljs-keyword">to</span> <span class="hljs-number">0</span>,<span class="hljs-number">0</span>
    <span class="hljs-keyword">end</span> <span class="hljs-keyword">if</span>
    <span class="hljs-keyword">wait</span> vbl
<span class="hljs-keyword">loop</span>

#<span class="hljs-number">2</span>:<span class="hljs-keyword">MAIN</span> <span class="hljs-keyword">CHARACTERS</span>
<span class="hljs-number">00000000000000000000000000000000</span>
FFFFFFFFFFFFFFFF0000000000000000
</code></pre><h4 id="-character-mcell-c-x-y-"><code>character=MCELL.C(x,y)</code></h4>
<p>Return the <code>character</code> of the <code>x</code>,<code>y</code> cell from the background source.</p>
<p>Similar to <a href="#character-cell-c-x-y"><code>character=CELL.C(x,y)</code></a> but modify the source in memory instead of the <a href="#bg-layer"><code>current layer</code></a>.</p>
<h4 id="-attributes-mcell-a-x-y-"><code>attributes=MCELL.A(x,y)</code></h4>
<p>Return the <code>attributes</code> of the <code>x</code>,<code>y</code> call from the background source.</p>
<p>Similar to <a href="#attributes-cell-a-x-y"><code>attributes=CELL.A(x,y</code></a> but modify the source in memory instead of the <a href="#bg-layer"><code>current layer</code></a>.</p>
<h4 id="-text-x-y-text-"><code>TEXT x,y,text$</code></h4>
<p>Will print <code>text$</code> on the <a href="#bg-layer"><code>current layer</code></a> starting at <code>x</code>,<code>y</code> cell using the current background attributes on the <a href="#bg-layer"><code>current layer</code></a>.</p>
<p>  data &quot;ga&quot;,&quot;bu&quot;,&quot;zo&quot;,&quot;meu&quot;
  for i=0 to 3
    pal i
    read c$
    text 8+i*2,10,c$
  next i</p>
<h4 id="-number-x-y-number-count-"><code>NUMBER x,y,number,count</code></h4>
<p>Will print the latest <code>count</code> digits of the <code>number</code> on the current layer starting at <code>x</code>,<code>y</code> cell using the current background attributes on the <a href="#bg-layer"><code>current layer</code></a>.</p>
<p>Similar to <a href="#text-xytext"><code>TEXT x,y,text$</code></a> but dedicated to print number instead of text.</p>
<pre><code>score=<span class="hljs-number">123</span>
number <span class="hljs-number">10</span>,<span class="hljs-number">10</span>,score,<span class="hljs-number">6</span>
</code></pre><h4 id="-font-first-"><code>FONT first</code></h4>
<p>Sets the <code>first</code> character number that will defines the range of ASCII characters used for <code>TEXT</code>, <code>NUMBER</code> and <code>PRINT</code> commands.</p>
<p>The default value is 192, which points to where the default font is loaded at the beginning of the program if the characters are not used. It MAY be overridden by <code>LOAD</code> operation.</p>
<h3 id="text-api">Text API</h3>
<p>Commands dedicated to draw text on layers using characters data. 64 characters can be reserved to print characters on screen. By default those characters number are (192..255) but can be changed using the <a href="#font-first"><code>FONT</code> command</a>.</p>
<h4 id="-window-x-y-width-height-layer-"><code>WINDOW x,y,width,height,layer</code></h4>
<p>Sets the current window at <code>x</code>,<code>y</code> with <code>width</code>,<code>height</code> and on <code>layer</code> where text will be drawn.</p>
<pre><code>window <span class="hljs-number">4</span>,<span class="hljs-number">8</span>,shown.w\<span class="hljs-number">8</span><span class="hljs-number">-8</span>,<span class="hljs-number">20</span>,<span class="hljs-number">0</span>
print <span class="hljs-string">"Oh my god! There's a tremendous amount of work to do. Can I do a little bit of it today."</span>
</code></pre><p>By default, the window is sets inside the safe area delimited by the safe functions.</p>
<h4 id="-clw-"><code>CLW</code></h4>
<p>Clears the window by replacing all the cells by the character 0. It also reset the cursor position.</p>
<h4 id="-locate-x-y-"><code>LOCATE x,y</code></h4>
<p>Move the cursor location at <code>x</code>,<code>y</code> in cells coordinates inside the window.</p>
<pre><code><span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span>=<span class="hljs-number">1</span> to <span class="hljs-number">9</span>
    locate <span class="hljs-built_in">i</span>,<span class="hljs-built_in">i</span>
    print str$(<span class="hljs-built_in">i</span>);
next <span class="hljs-built_in">i</span>
</code></pre><h4 id="-cursor-x-br-cursor-y-"><code>=CURSOR.X</code><br><code>=CURSOR.Y</code></h4>
<p>Return the cursor location <code>x</code>,<code>y</code> in cells coordinates inside the window.</p>
<h4 id="-print-expression-list-"><code>PRINT expression-list</code></h4>
<p>Outputs string <code>expression-list</code> onto the current window.</p>
<p><code>expression-list</code> can be one or more of:</p>
<ul>
<li>a string or numeric literal,</li>
<li>a variable identifier,</li>
<li>a label that point to a string data.</li>
</ul>
<p>When two items are separated by a coma <code>,</code> a space will be inserted between them.</p>
<p>When two items are separated by semicolon <code>;</code> no space is inserted.</p>
<p>Example with different expressions:</p>
<pre><code><span class="hljs-keyword">print</span> <span class="hljs-string">"literal"</span>
v$=<span class="hljs-string">"variable"</span>
<span class="hljs-keyword">print</span> v$
txt: data <span class="hljs-string">"data"</span>
<span class="hljs-keyword">print</span> txt
</code></pre><p>Example with different separators:</p>
<pre><code><span class="hljs-built_in">print</span> <span class="hljs-string">"glu"</span>;<span class="hljs-string">"ed"</span>
<span class="hljs-built_in">print</span> <span class="hljs-string">"sepa"</span>,<span class="hljs-string">"rated"</span>

<span class="hljs-built_in">do</span>
    wait <span class="hljs-number">2</span>
    <span class="hljs-built_in">print</span> <span class="hljs-string">"."</span>;
<span class="hljs-built_in">loop</span>
</code></pre><h4 id="-print-"><code>PRINT</code></h4>
<p>Outputs a new line.</p>
<h3 id="input-api">Input API</h3>
<p>Retro Game Creator support touch input with float-point precision (but not multi-touches), and limited keyboard input.</p>
<p>User can also rely on the OS virtual keyboard to capture typed characters.</p>
<h4 id="-touched-touch-"><code>touched=TOUCH</code></h4>
<p>Return -1 if the device fantasy screen is currently <code>touched</code>.</p>
<p>Example that print a text only when device screen is touched:</p>
<pre><code><span class="hljs-keyword">do</span>
    cls
    <span class="hljs-keyword">if</span> touch <span class="hljs-keyword">then</span> <span class="hljs-built_in">text</span> <span class="hljs-number">4</span>,<span class="hljs-number">4</span>,<span class="hljs-string">"touched"</span>
    <span class="hljs-keyword">wait</span> vbl
<span class="hljs-keyword">loop</span>
</code></pre><h4 id="-touched-tap-"><code>touched=TAP</code></h4>
<p>Return -1 for exactly one frame, if the device fantasy screen is <code>touched</code>.</p>
<p>Example of a flappy letter going down by gravity and up when tapping on the screen:</p>
<pre><code>sprite <span class="hljs-number">0</span>,<span class="hljs-number">0</span>,shown.h/<span class="hljs-number">2</span>,<span class="hljs-number">226</span>
gravity=<span class="hljs-number">3</span>
do
    wait vbl
    x=sprite.x(<span class="hljs-number">0</span>)+<span class="hljs-number">1</span>
    if x+<span class="hljs-number">8</span>&gt;shown.w then x=<span class="hljs-number">0</span>
    if tap then gravity=<span class="hljs-number">-9</span>
    y=clamp(sprite.y(<span class="hljs-number">0</span>)+gravity,<span class="hljs-number">0</span>,shown.h<span class="hljs-number">-8</span>)
    gravity=min(<span class="hljs-number">3</span>,gravity+<span class="hljs-number">1</span>)
    sprite <span class="hljs-number">0</span>,x,y,
loop
</code></pre><h4 id="-x-touch-x-br-y-touch-y-"><code>x=TOUCH.X</code><br><code>y=TOUCH.Y</code></h4>
<p>Returns the last pixel position <code>x</code>,<code>y</code> touched. It returns a floating-point number, with a 1/16 pixel precisions.</p>
<pre><code><span class="hljs-keyword">do</span>
    <span class="hljs-keyword">cls</span>
    <span class="hljs-keyword">print</span> touch.x;<span class="hljs-string">","</span>;touch.y
    <span class="hljs-built_in">wait</span> vbl
loop
</code></pre><h4 id="-keyboard-on-br-keyboard-off-"><code>KEYBOARD ON</code><br><code>KEYBOARD OFF</code></h4>
<p>Show or hide the device virtual keyboard. Because user can hide the keybord using a dedicated key, do not assume the keyboard is visible. Use <code>KEYBOARD ON</code> inside a loop or rely on <code>=KEYBOARD</code> to detect when the keyboard is shown or not.</p>
<h4 id="-height-keyboard-"><code>height=KEYBOARD</code></h4>
<p>Return the <code>height</code> of the virtual screen that has been occluded by the keyboard.</p>
<h4 id="-input-prompt-variable-br-input-prompt-variable-"><code>INPUT [prompt;]variable</code><br><code>INPUT [prompt;]variable$</code></h4>
<p>Wait for the user to type a text or a number and store it to the <code>variable</code> or <code>variable$</code>.</p>
<p>Optionally, a <code>prompt</code> can be printed on the screen before the user input.</p>
<pre><code>a=<span class="hljs-keyword">rnd</span>(<span class="hljs-number">9</span>)+<span class="hljs-number">10</span>
b=<span class="hljs-keyword">rnd</span>(<span class="hljs-number">9</span>)
<span class="hljs-keyword">print</span> <span class="hljs-string">"Captcha:"</span>
<span class="hljs-keyword">print</span> <span class="hljs-keyword">str</span>$(a)<span class="hljs-comment">;"+";str$(b)</span>
<span class="hljs-keyword">do</span>
    <span class="hljs-keyword">input</span> <span class="hljs-string">"?"</span><span class="hljs-comment">;answer</span>
    <span class="hljs-keyword">if</span> answer=a+b then <span class="hljs-keyword">goto</span> pass
<span class="hljs-keyword">loop</span>
pass: <span class="hljs-keyword">print</span> <span class="hljs-string">"you may pass"</span>
</code></pre><h4 id="-pressed-inkey-"><code>pressed$=INKEY$</code></h4>
<p>Returns only once the last <code>pressed$</code> key. It's a string containing one ASCII character supported by Retro Game Creator. If no key was pressed or if the pressed key is not supported, it returns an empty string. See <a href="#ascii-table">ASCII table</a>.</p>
<p>Example that output the pressed key:</p>
<pre><code><span class="hljs-keyword">do</span>
    keyboard on
    k$=inkey$
    <span class="hljs-keyword">if</span> k$&lt;&gt;<span class="hljs-string">""</span> <span class="hljs-keyword">then</span>
        print k$;
    <span class="hljs-keyword">end</span> <span class="hljs-keyword">if</span>
    wait vbl
loop
</code></pre><h4 id="-frames-timer-"><code>frames=TIMER</code></h4>
<p>Returns the number of <code>frames</code> since Retro Game Creator was launched. The value wraps to 0 when 5184000 is reached, which is about 24 hours.</p>
<h4 id="-wait-tap-"><code>WAIT TAP</code></h4>
<p>Will stop execution of the program until a touch is made.</p>
<p>While waiting for a tap, interrupt sub-routines for <code>VBL/RASTER/PARTICLE/EMITTER</code> are still executed.</p>
<h3 id="display-api">Display API</h3>
<h4 id="-palette-palette-c0-c1-c2-c3-"><code>PALETTE palette,[c0],[c1],[c2],[c3]</code></h4>
<p>Sets the four colors on the height available <code>palette</code> (0..7). The color 0 of the palette 0 is generally used as backdrop color. (It can be change using the <code>SYSTEM</code> command.) <code>c0</code>, <code>c1</code>, <code>c2</code>, <code>c3</code> can accept a numeric value between 0 and 63, omit them to keep the current value. Consult the <a href="#64-colors">64 colors reference</a> to choose the color you want.</p>
<h4 id="-color-palette-color-"><code>=COLOR(palette,color)</code></h4>
<p>Returns one of the <a href="#64-colors">64 colors</a> associated to the pair <code>palette</code> (0..7), <code>color</code> (0..3).</p>
<h4 id="-width-shown-w-br-height-shown-h-"><code>width=SHOWN.W</code><br><code>height=SHOWN.H</code></h4>
<p>Returns the <code>width</code> and <code>height</code> in pixels of the visible area of the fantasy screen.</p>
<h4 id="-left-safe-l-br-top-safe-t-br-right-safe-r-br-bottom-safe-b-"><code>left=SAFE.L</code><br><code>top=SAFE.T</code><br><code>right=SAFE.R</code><br><code>bottom=SAFE.B</code></h4>
<p>Returns the <code>left</code>, <code>top</code>, <code>right</code> and <code>bottom</code> offset in pixels to apply from the boundary of the fantasy device screen to reach the inner safe area specified by the device's operating system.</p>
<p>These functions can be used to avoid the top camera notch or the bottom inset full-width buttons.</p>
<h4 id="-sprite-view-on-br-sprite-view-off-"><code>SPRITE VIEW ON</code><br><code>SPRITE VIEW OFF</code></h4>
<p>Enable or disable the rendering of all sprites.</p>
<h4 id="-bg-view-on-br-bg-view-off-"><code>BG VIEW ON</code><br><code>BG VIEW OFF</code></h4>
<p>Enable or disable the rendering of all background layers.</p>
<h4 id="-wait-vbl-br-wait-frame-"><code>WAIT VBL</code><br><code>WAIT frame</code></h4>
<p>Wait for a number of <code>frame</code> to be drawn. Keyword <code>VBL</code> is similar to 1. This is used to:</p>
<ul>
<li>draw frames at 60 FPS,</li>
<li>reduce device CPU usage,</li>
<li>preserve device battery.</li>
</ul>
<p>It is RECOMMENDED to place at least one <code>WAIT VBL</code> inside every loop that waits for player input or presents something to the player.</p>
<p>Example that show the effect:</p>
<pre><code>sprite <span class="hljs-number">0</span>,shown.w/<span class="hljs-number">2</span><span class="hljs-number">-4</span>,shown.h/<span class="hljs-number">2</span><span class="hljs-number">-4</span>,<span class="hljs-number">240</span>
locate <span class="hljs-number">2</span>,<span class="hljs-number">2</span>
print <span class="hljs-string">"touch to wait vbl"</span>
do
    x=sprite.x(<span class="hljs-number">0</span>)
    y=sprite.y(<span class="hljs-number">0</span>)
    add x,<span class="hljs-number">1</span>,<span class="hljs-number">-8</span> to shown.w
    add y,<span class="hljs-number">1</span>,<span class="hljs-number">-8</span> to shown.h
    sprite <span class="hljs-number">0</span>,x,y,
    if <span class="hljs-section">touch</span> then wait vbl
loop
</code></pre><p><code>WAIT VBL</code> is equal <code>WAIT 1</code></p>
<h4 id="-on-vbl-call-s-"><code>ON VBL CALL s</code></h4>
<p>Before the execution of the code for the next frame, will execute the sub-routine <code>s</code>.</p>
<p>The code MUST be short, read more about <a href="#cycles">CPU cycles</a>.</p>
<p>This can be used to execute code at every frame, independently of which part of the code is generating frames. Here is an example that demonstrate:</p>
<pre><code>sub v
    x=sprite.x(<span class="hljs-number">0</span>)
    <span class="hljs-built_in">add</span> x,<span class="hljs-number">1</span>,<span class="hljs-number">-8</span> <span class="hljs-built_in">to</span> shown.w
    y=sprite.y(<span class="hljs-number">0</span>)
    <span class="hljs-built_in">add</span> y,<span class="hljs-number">1</span>,<span class="hljs-number">-8</span> <span class="hljs-built_in">to</span> shown.h
    sprite <span class="hljs-number">0</span>,x,y,<span class="hljs-number">1</span>
<span class="hljs-function"><span class="hljs-keyword">end</span> <span class="hljs-title">sub</span></span>
<span class="hljs-keyword">on</span> <span class="hljs-title">vbl</span> <span class="hljs-title">call</span> <span class="hljs-title">v</span>

<span class="hljs-literal">one</span>:
palette <span class="hljs-number">0</span>,<span class="hljs-number">43</span>,,,
<span class="hljs-built_in">wait</span> tap
goto <span class="hljs-literal">two</span>

<span class="hljs-literal">two</span>:
palette <span class="hljs-number">0</span>,<span class="hljs-number">59</span>,,,
<span class="hljs-built_in">wait</span> tap
goto <span class="hljs-literal">one</span>

<span class="hljs-comment">#2:MAIN CHARACTERS</span>
<span class="hljs-number">00000000000000000000000000000000</span>
<span class="hljs-number">0000000000000000</span>FFFFFFFFFFFFFFFF
</code></pre><h4 id="-on-vbl-off-"><code>ON VBL OFF</code></h4>
<p>Will stop the execution of a sub-routine during VBL interrupt.</p>
<h4 id="-on-raster-call-routine-"><code>ON RASTER CALL routine</code></h4>
<p>Before the rendering of the next line of the screen, will execute a sub-<code>routine</code>. This is useful in conjunction with <a href="#raster"><code>=RASTER</code></a>.</p>
<p>The code MUST be shortest, read more about <a href="#cycles">CPU cycles</a>.</p>
<p>This can be used to change colors or scroll background layers, example:</p>
<pre><code>text <span class="hljs-number">3</span>,<span class="hljs-number">8</span>,<span class="hljs-string">"tap to toggle"</span>
cell <span class="hljs-number">10</span>,<span class="hljs-number">10</span>,<span class="hljs-number">1</span>

sub r
if raster&gt;=<span class="hljs-number">80</span> then
    scroll <span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">80</span>-raster
    palette <span class="hljs-number">0</span>,,,raster mod <span class="hljs-number">64</span>,
else if raster=<span class="hljs-number">0</span> then
    scroll <span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>
    palette <span class="hljs-number">0</span>,,,<span class="hljs-number">0</span>,
end if
end sub

do
    wait tap
    on raster call r
    wait tap
    on raster off
    scroll <span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>
    palette <span class="hljs-number">0</span>,,,<span class="hljs-number">0</span>,
loop
</code></pre><h4 id="-raster-"><code>=RASTER</code></h4>
<p>Return the fantasy screen line number currently rendered.</p>
<h4 id="-on-raster-off-"><code>ON RASTER OFF</code></h4>
<p>Will stop the execution of a sub-routine during RASTER interrupt.</p>
<h3 id="math-api">Math API</h3>
<h4 id="-pi-pi-"><code>pi=PI</code></h4>
<p>Return the constant œÄ.</p>
<h4 id="-cosine-cos-number-br-sine-sin-number-"><code>cosine=COS(number)</code><br><code>sine=SIN(number)</code></h4>
<p>Return the <code>cosine</code> or <code>sine</code> (0..1) value of a <code>number</code>.</p>
<p><code>COS()</code> and <code>SIN()</code> take (0..1) instead of (0..œÄ*2), and <code>SIN()</code> is inverted.</p>
<h4 id="-arc-atan-x-y-"><code>arc=ATAN(x,y)</code></h4>
<p>Return the <code>arc</code> tangent value of a <code>x</code>,<code>y</code> vector.</p>
<p><code>ATAN()</code> returns an value between (-0.5..0.5) making it suitable for use with <code>COS()</code> and <code>SIN()</code>.</p>
<p>Example that show how to compute an angle from a position, and a position from an angle:</p>
<pre><code>'<span class="hljs-built_in">get</span> the <span class="hljs-built_in">center</span> <span class="hljs-built_in">position</span> of the screen
cx=shown.w/<span class="hljs-number">2</span>-<span class="hljs-number">4</span>
cy=shown.h/<span class="hljs-number">2</span>-<span class="hljs-number">4</span>
sprite <span class="hljs-number">50</span>,cx,cy,<span class="hljs-number">1</span>

'initial <span class="hljs-built_in">position</span> from the <span class="hljs-built_in">center</span>
dx=<span class="hljs-number">40</span>
dy=<span class="hljs-number">20</span>
sprite <span class="hljs-number">40</span>,cx+dx,cy+dy,<span class="hljs-number">1</span>
sprite <span class="hljs-number">40</span> pal <span class="hljs-number">1</span>
sprite <span class="hljs-number">30</span> pal <span class="hljs-number">2</span>

<span class="hljs-keyword">do</span>
    '<span class="hljs-built_in">new</span> <span class="hljs-built_in">position</span> from touch
    dx=touch.x-cx
    dy=touch.y-cy
    sprite <span class="hljs-number">40</span>,cx+dx,cy+dy,<span class="hljs-number">1</span>

    '<span class="hljs-built_in">get</span> angle from <span class="hljs-built_in">vector</span>
    a=<span class="hljs-built_in">atan</span>(dx,dy)

    '<span class="hljs-built_in">get</span> <span class="hljs-built_in">position</span> from angle
    x=<span class="hljs-built_in">cos</span>(a)*<span class="hljs-number">30</span>
    y=<span class="hljs-built_in">sin</span>(a)*<span class="hljs-number">30</span>

    sprite <span class="hljs-number">30</span>,cx+x,cy+y,<span class="hljs-number">1</span>
    wait vbl
loop

#<span class="hljs-number">2</span>:MAIN CHARACTERS
<span class="hljs-number">00000000000000000000000000000000</span>
3C7EFFFFFFFF7E3C0000000000000000
</code></pre><h4 id="-absolute-abs-number-"><code>absolute=ABS(number)</code></h4>
<p>Return the <code>absolute</code> value of a <code>number</code>.</p>
<h4 id="-exponential-exp-number-"><code>exponential=EXP(number)</code></h4>
<p>Return the <code>exponential</code> value of a <code>number</code>.</p>
<h4 id="-logarithm-log-number-"><code>logarithm=LOG(number)</code></h4>
<p>Return the <code>logarithm</code> value of a <code>number</code>.</p>
<h4 id="-square-sqr-number-"><code>square=SQR(number)</code></h4>
<p>Return the <code>square</code> root value of a <code>number</code>.</p>
<h4 id="-sign-sgn-number-"><code>sign=SGN(number)</code></h4>
<p>Return the <code>sign</code> (+1/-1) of a <code>number</code>.</p>
<h4 id="-floor-floor-number-br-floor-int-number-"><code>floor=FLOOR(number)&lt;br&gt;floor=INT(number)</code></h4>
<p>Return the <code>floor</code> value of a <code>number</code>.</p>
<h4 id="-ceil-ceil-number-"><code>ceil=CEIL(number)</code></h4>
<p>Return the <code>ceil</code> value of a <code>number</code>.</p>
<h4 id="-inc-variable-br-dec-variable-"><code>INC variable</code><br><code>DEC variable</code></h4>
<p>Increment or decrement by 1 the value of a <code>variable</code>.</p>
<h4 id="-add-variable-value-br-add-variable-increment-min-to-max-"><code>ADD variable,value</code><br>ADD variable,increment,min TO max`</h4>
<p>Add a <code>value</code> to a <code>variable</code>.</p>
<p>Optionally make it wrap around between <code>min</code> and <code>max</code>.</p>
<h4 id="-minimal-min-a-b-br-maximal-max-a-b-"><code>minimal=MIN(a,b)</code><br><code>maximal=MAX(a,b)</code></h4>
<p>Return the <code>minimal</code> or <code>maximal</code> value between <code>a</code> and <code>b</code>.</p>
<h4 id="-clamped-clamp-value-min-max-"><code>clamped=CLAMP(value,min,max)</code></h4>
<p>Return the <code>value</code> <code>clamped</code> between <code>min</code> and <code>max</code>.</p>
<h4 id="-length-len-x-y-"><code>length=LEN(x,y)</code></h4>
<p>Return the <code>length</code> of a <code>x</code>,<code>y</code> vector.</p>
<h4 id="-interpolation-ease-function-mode-value-"><code>interpolation=EASE(function,mode,value)</code></h4>
<p>This returns the <code>interpolation</code> of <code>value</code> between 0.0 and 1.0, using the üåê<a href="https://easings.net/">specified easing</a> <code>function</code> and <code>mode</code>.</p>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th>function</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td>linear</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td>sine</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td>quad</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td>cubic</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td>quart</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td>quint</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td>circ</td>
</tr>
<tr>
<td style="text-align:right">7</td>
<td>back</td>
</tr>
<tr>
<td style="text-align:right">8</td>
<td>elastic</td>
</tr>
<tr>
<td style="text-align:right">9</td>
<td>bounce</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:right"></th>
<th>mode</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">-1</td>
<td>in</td>
</tr>
<tr>
<td style="text-align:right">0</td>
<td>inout</td>
</tr>
<tr>
<td style="text-align:right">+1</td>
<td>out</td>
</tr>
</tbody>
</table>
<h4 id="-random-rnd-"><code>random=RND</code></h4>
<p>Return a <code>random</code> floating-point number (0..1).</p>
<h4 id="-random-rnd-max-"><code>random=RND(max)</code></h4>
<p>Return a <code>random</code> integer number (0..max).</p>
<h4 id="-randomize-seed-"><code>RANDOMIZE seed</code></h4>
<p>Initialize the random generator with a different <code>seed</code> (0..16777216).</p>
<p>TODO: link to floating point precision loss</p>
<p>Setting a specific <code>seed</code> will guarantee to return the same sequence of random numbers.</p>
<pre><code><span class="hljs-keyword">randomize</span> <span class="hljs-number">123456</span>
<span class="hljs-keyword">for</span> i=<span class="hljs-number">0</span> to <span class="hljs-number">5</span>
    <span class="hljs-keyword">print</span> <span class="hljs-keyword">rnd</span>(<span class="hljs-number">100</span>)
<span class="hljs-keyword">next</span> i

<span class="hljs-keyword">print</span>

<span class="hljs-keyword">randomize</span> <span class="hljs-number">123456</span>
<span class="hljs-keyword">for</span> i=<span class="hljs-number">0</span> to <span class="hljs-number">5</span>
    <span class="hljs-keyword">print</span> <span class="hljs-keyword">rnd</span>(<span class="hljs-number">100</span>)
<span class="hljs-keyword">next</span> i
</code></pre><h4 id="-random-rnd-address-br-random-rnd-max-address-br-randomize-seed-address-"><code>random=RND address&lt;br&gt;random=RND(max,address)&lt;br&gt;RANDOMIZE seed[,address]</code></h4>
<p>Similar to the original functions with a additional <code>address</code> parameter, where the current generator state will be stored.</p>
<p>This is useful if you want to keep multiple generator that still need to be deterministic.</p>
<p>The generator state consume 16 Bytes of memory.</p>
<h3 id="string-api">String API</h3>
<h4 id="-length-len-text-"><code>length=LEN(text)</code></h4>
<p>Return the <code>length</code> in ascii7 character of a <code>text</code> string.</p>
<h4 id="-ascii7-asc-character-"><code>ascii7=ASC(character)</code></h4>
<p>Converts the first <code>character</code> of a string to an <code>ascii7</code> code. See <a href="#ascii-table">ASCII table</a>.</p>
<h4 id="-character-chr-ascii7-"><code>character=CHR$(ascii7)</code></h4>
<p>Converts an <code>ascii7</code> code to a one <code>character</code> string.</p>
<h4 id="-text-str-number-"><code>text=STR$(number)</code></h4>
<p>Converts a <code>number</code> to a <code>text</code> string.</p>
<pre><code><span class="hljs-keyword">print</span> <span class="hljs-keyword">str</span>$(<span class="hljs-number">123.456</span>)
</code></pre><h4 id="-number-val-text-"><code>number=VAL(text)</code></h4>
<p>Converts a <code>text</code> string that starts with digits (and optionally one decimal point <code>.</code>) into a <code>number</code>.</p>
<pre><code><span class="hljs-built_in">print</span> val(<span class="hljs-string">"3.5abc"</span>)
</code></pre><h4 id="-hexadecimal-hex-number-digits-br-binary-bin-number-digits-"><code>hexadecimal=HEX$(number,[digits])</code><br><code>binary=BIN$(number,[digits])</code></h4>
<p>Converts a <code>number</code> to an <code>hexadecimal</code> or <code>binary</code> string with an optional minimal number of <code>digits</code>.</p>
<h4 id="-leading-left-text-length-br-trailing-right-text-length-"><code>leading$=LEFT$(text,length)</code><br><code>trailing$=RIGHT$(text,length)</code></h4>
<p>Return the <code>length</code> number of characters from the beginning or the end of the <code>text</code> string.</p>
<pre><code>shadok: data <span class="hljs-string">"gabuzomeu"</span>
<span class="hljs-keyword">print</span> left$(shadok,<span class="hljs-number">4</span>)
<span class="hljs-keyword">print</span> right$(shadok,<span class="hljs-number">5</span>)
</code></pre><h4 id="-left-text-length-replacement-br-right-text-length-replacement-"><code>LEFT$(text,length)=replacement$</code><br><code>RIGHT$(text,length)=replacement$</code></h4>
<p>Overwrites the <code>length</code> number of characters at the beginning or the end of the <code>text</code> string by the <code>length</code> first characters of the <code>replacement$</code> string.</p>
<h4 id="-extract-mid-text-position-length-"><code>extract$=MID(text,position,length)</code></h4>
<p>Return the <code>length</code> number of characters starting at <code>position</code> (1..) from the <code>text</code> string.</p>
<h4 id="-mid-text-position-length-replacement-"><code>mid$(text,position,length)=replacement$</code></h4>
<p>Overwrites the <code>length</code> number of characters starting at <code>position</code> (1..) from the <code>text</code> string by the <code>length</code> first characters of the <code>replacement$</code> string.</p>
<pre><code>six<span class="hljs-symbol">$</span>=<span class="hljs-string">"hexakosioihexekontahexaphobie"</span>
mid<span class="hljs-symbol">$</span>(six<span class="hljs-symbol">$</span>,<span class="hljs-number">1</span>,<span class="hljs-number">4</span>)=<span class="hljs-string">"-66-"</span>
mid<span class="hljs-symbol">$</span>(six<span class="hljs-symbol">$</span>,<span class="hljs-number">11</span>,<span class="hljs-number">4</span>)=<span class="hljs-string">"-66-"</span>
mid<span class="hljs-symbol">$</span>(six<span class="hljs-symbol">$</span>,<span class="hljs-number">20</span>,<span class="hljs-number">4</span>)=<span class="hljs-string">"-66-"</span>
print six<span class="hljs-symbol">$</span>
</code></pre><h3 id="sound-api">Sound API</h3>
<p>The fantasy hardware simulates 4 voices to play sound effects and music. See <a href="#sound">Sound</a> for an overview.</p>
<h4 id="-play-voice-pitch-length-sound-sound-"><code>PLAY voice,pitch[,length] [SOUND sound]</code></h4>
<p>Play a note at the <code>pitch</code> on the <code>voice</code> with an optional <code>length</code> and <code>sound</code>.</p>
<p>Check the <a href="#pitch-values">pitch references</a> to learn which pitch correspond to which notes.</p>
<p><code>length</code> use 1/60 of seconds as units with the maximum being 255, so 4.25 seconds. A length of 0 means that the sound will not stop until another sound is played on the same <code>voice</code>.</p>
<p><code>sound</code> is a number representing a group of settings that define the sound's characteristics. It requires the usage of the <a href="manual#`SOUND SOURCE [address]`"><code>SOUND SOURCE</code></a> command.</p>
<h4 id="-stop-br-stop-voice-"><code>STOP</code><br><code>STOP [voice]</code></h4>
<p>Stops the sound and track on the <code>voice</code> or all the voices if omitted.</p>
<p>Release duration of envelope are not stop but fade out instead.</p>
<h4 id="-volume-voice-volume-mix-"><code>VOLUME voice,[volume],[mix]</code></h4>
<p>Sets the <code>volume</code> and <code>mix</code> of <code>voice</code>.</p>
<table>
<thead>
<tr>
<th style="text-align:right">parameter</th>
<th>value and range</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right"><code>volume</code></td>
<td><code>0</code> .. <code>15</code></td>
</tr>
<tr>
<td style="text-align:right"><code>mix</code></td>
<td><code>0</code> Muted<br><code>1</code> Left<br><code>2</code> Right<br><code>3</code> Both</td>
</tr>
</tbody>
</table>
<p>All parameters can be omitted to keep their current settings.</p>
<h4 id="-sound-voice-wave-width-length-"><code>SOUND voice,[wave],[width],[length]</code></h4>
<p>Sets the sound's characteristics for the <code>voice</code>.</p>
<p><code>wave</code> control the waveform. With a waveform of Pulse, the <code>width</code> control the pulse width. A value of 8 means a square wave.</p>
<p><code>length</code> control the length of the sound. A length of 0 means that the sound will not stop until another sound is played on the same <code>voice</code>. This value can be overriden by the parameter <code>length</code> of the <a href="#play-voice-pitch-length-sound-sound"><code>PLAY</code> command</a>.</p>
<table>
<thead>
<tr>
<th style="text-align:right">parameter</th>
<th>value and range</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right"><code>wave</code></td>
<td><code>0</code> Sawtooth<br><code>1</code> Triangle<br><code>2</code> Pulse<br><code>3</code> Noise</td>
</tr>
<tr>
<td style="text-align:right"><code>width</code></td>
<td><code>0</code> .. <code>15</code></td>
</tr>
<tr>
<td style="text-align:right"><code>length</code></td>
<td><code>0</code> Infinite<br>1 16.67ms .. <code>255</code> 4.25s</td>
</tr>
</tbody>
</table>
<p>Omitted parameters will keep their previous values.</p>
<h4 id="-envelope-voice-attack-decay-sustain-release-"><code>ENVELOPE voice,[attack],[decay],[sustain],[release]</code></h4>
<p>Set the volume envelope for the <code>voice</code>.</p>
<p>Allow to change the <code>attack</code>, <code>decay</code> and <code>release</code> duration.</p>
<p><code>sustain</code> control the volume after the decay and before the release.</p>
<table>
<thead>
<tr>
<th style="text-align:right">parameter</th>
<th>range</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right"><code>attack</code></td>
<td><code>0</code> 2ms .. <code>15</code> 12s</td>
</tr>
<tr>
<td style="text-align:right"><code>decay</code></td>
<td><code>0</code> 2ms .. <code>15</code> 12s</td>
</tr>
<tr>
<td style="text-align:right"><code>release</code></td>
<td><code>0</code> 2ms .. <code>15</code> 12s</td>
</tr>
<tr>
<td style="text-align:right"><code>sustain</code></td>
<td><code>0</code> .. <code>15</code></td>
</tr>
</tbody>
</table>
<p>All parameters can be omitted to keep their current settings.</p>
<h4 id="-lfo-voice-rate-frequency-volume-width-"><code>LFO voice,[rate],[frequency],[volume],[width]</code></h4>
<p>Set the Low Frequency Oscillator (LFO) for the <code>voice</code>.</p>
<p>Allow to change the <code>rate</code>, the <code>frequency</code>, the <code>volume</code> and the <code>width</code> for Pulse waveform.</p>
<table>
<thead>
<tr>
<th style="text-align:right">parameter</th>
<th>range</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right"><code>rate</code></td>
<td><code>0</code> 0.12Hz .. <code>15</code> 18Hz</td>
</tr>
<tr>
<td style="text-align:right"><code>frequency</code></td>
<td><code>0</code> .. <code>15</code></td>
</tr>
<tr>
<td style="text-align:right"><code>volume</code></td>
<td><code>0</code> .. <code>15</code></td>
</tr>
<tr>
<td style="text-align:right"><code>width</code></td>
<td><code>0</code> .. <code>15</code></td>
</tr>
</tbody>
</table>
<p>All parameters can be omitted to keep their current settings.</p>
<h4 id="-lfo-wave-voice-wave-invert-env-trigger-"><code>LFO WAVE voice,[wave],[invert],[env],[trigger]</code></h4>
<p>Set options for the a second Low Frequency Oscillator (LFO) for the <code>voice</code>.</p>
<p>Allow to change the <code>wave</code> and enable or disable <code>invert</code>, <code>env</code> and <code>trigger</code>.</p>
<p>With <code>invert</code> off, the wave is added (+) to the output signal. With <code>invert</code> on, the wave is substracted (-).</p>
<p>When <code>env</code> on, this second LFO will be played once. Will implictly set <code>trigger</code> on.</p>
<p>With <code>trigger</code> on, this second LFO is restarted at every <code>PLAY</code>, otherwise the LFO is continously applied.</p>
<table>
<thead>
<tr>
<th style="text-align:right">parameter</th>
<th>value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right"><code>wave</code></td>
<td><code>0</code> Triangle<br><code>1</code> Sawtooth<br><code>2</code> Square<br><code>3</code> Random</td>
</tr>
<tr>
<td style="text-align:right"><code>invert</code></td>
<td><code>0</code> Off<br><code>1</code> On</td>
</tr>
<tr>
<td style="text-align:right"><code>env</code></td>
<td><code>0</code> Off<br><code>1</code> On</td>
</tr>
<tr>
<td style="text-align:right"><code>trigger</code></td>
<td><code>0</code> Off<br><code>1</code> On</td>
</tr>
</tbody>
</table>
<p>All parameters can be omitted to keep their current settings.</p>
<h4 id="-sound-source-address-"><code>SOUND SOURCE [address]</code></h4>
<p>Set the <code>address</code> on memory to use as source for <code>MUSIC</code>, <code>TRACK</code> and <code>PLAY</code> commands. The <a href="#sound-source-format-data">sound source format data</a> is used to decode the information.</p>
<p>This will not affect already started playback.</p>
<p>If not specified the default address is taken by internally executing <code>=ROM(15)</code></p>
<h4 id="-music-pattern-"><code>MUSIC [pattern]</code></h4>
<p>Starts playing at the <code>pattern</code>. If omitted, it starts at pattern <code>0</code>.</p>
<p>This will consider that the data respects the <a href="#sound-source-format-data">sound source format data</a>.</p>
<h4 id="-music-what-"><code>=MUSIC(what)</code></h4>
<p>Question the current playback.</p>
<table>
<thead>
<tr>
<th style="text-align:right"><code>what</code></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td>The current pattern</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td>The current row</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td>The current tick</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td>The current speed<br><code>0</code> when stopped</td>
</tr>
</tbody>
</table>
<h4 id="-track-track-voice-"><code>TRACK track,voice</code></h4>
<p>Starts playing the <code>track</code> on <code>voice</code>.</p>
<p>This will consider that the data respects the <a href="#sound-source-format-data">sound source format data</a>.</p>
<h3 id="memory-api">Memory API</h3>
<h4 id="-poke-address-value-"><code>POKE address,value</code></h4>
<p>Write an 8bits <code>value</code> (0..255) in memory at <code>address</code>.</p>
<p>The <code>address</code> MUST be writable. See <a href="#memory-mapping">memory mapping</a> for details.</p>
<p>Example that change the background color:</p>
<pre><code>c=<span class="hljs-number">0</span>
do
    poke $ff00,C
    add c,<span class="hljs-number">1</span>,<span class="hljs-number">0</span> to <span class="hljs-number">63</span>
    wait <span class="hljs-number">5</span>
loop
</code></pre><h4 id="-peek-address-"><code>=PEEK(address)</code></h4>
<p>Read and return a 8bits value (0..255) from memory at <code>address</code>.</p>
<p>Example that print the last pressed ASCII key code:</p>
<pre><code><span class="hljs-keyword">do</span>
    keyboard <span class="hljs-keyword">on</span>
    <span class="hljs-keyword">print</span> <span class="hljs-keyword">str</span>$(<span class="hljs-keyword">peek</span>($ff84))
    <span class="hljs-keyword">wait</span> <span class="hljs-number">5</span>
<span class="hljs-keyword">loop</span>
</code></pre><h4 id="-pokew-address-value-"><code>POKEW address,value</code></h4>
<p>Write a 16bits <code>value</code> (-32768..32767) in memory at <code>address</code>.</p>
<h4 id="-peekw-address-"><code>=PEEKW(address)</code></h4>
<p>Read and return a 16bits value (-32768..32767) from memory at <code>address</code>.</p>
<p>Example that print the width and height of the visible pixels:</p>
<pre><code><span class="hljs-keyword">print</span> <span class="hljs-string">"width"</span>,peekw(<span class="hljs-variable">$ff78</span>),shown.<span class="hljs-built_in">w</span>
<span class="hljs-keyword">print</span> <span class="hljs-string">"height"</span>,peekw(<span class="hljs-variable">$ff7a</span>),shown.<span class="hljs-built_in">h</span>
</code></pre><h4 id="-pokel-address-value-"><code>POKEL address,value</code></h4>
<p>Write a 32bits <code>value</code> value (-16777216..16777216) in memory at <code>address</code>.</p>
<p>Note: Values are stored as floating-point. See <a href="#number-limits">number limits</a> for precision details.</p>
<h4 id="-peekl-address-"><code>=PEEKL(address)</code></h4>
<p>Read and return a 32bits value (-16777216..16777216) from memory at <code>address</code>.</p>
<p>Note: Values are stored as floating-point. See <a href="#number-limits">number limits</a> for precision details.</p>
<h4 id="-address-rom-file-"><code>address=ROM(file)</code></h4>
<p>Return the <code>address</code> in memory of the virtual <code>file</code>.</p>
<h4 id="-size-size-file-"><code>size=SIZE(file)</code></h4>
<p>Return the <code>size</code> in bytes of the virtual <code>file</code>.</p>
<h4 id="-copy-source-count-to-destination-"><code>COPY source,count TO destination</code></h4>
<p>Copies <code>count</code> bytes from <code>source</code> address from memory to <code>destination</code> address in memory.</p>
<p>The <code>source</code> and <code>destination</code> CAN overlap.</p>
<h4 id="-fill-address-count-value-"><code>FILL address,count[,value]</code></h4>
<p>Sets <code>count</code> bytes from <code>address</code> in memory with the <code>value</code> or 0 when not specified.</p>
<h4 id="-rol-address-places-br-ror-address-places-"><code>ROL address,places</code><br><code>ROR address,places</code></h4>
<p>Rotates the bits of the byte stored at <code>address</code> by a number of <code>places</code> to the left or the right.</p>
<pre><code>poke $9000,%00001111
again:
<span class="hljs-keyword">print</span> right$(<span class="hljs-string">"0000000"</span>+bin$(peek($9000)),<span class="hljs-number">8</span>)
wait tap
rol $9000,<span class="hljs-number">2</span>
goto again
</code></pre><h4 id="-dma-copy-rom-"><code>DMA COPY [ROM]</code></h4>
<p>Performs a fast memory copy that can only be done during interrupt calls: <code>VBL/RASTER/EMITTER/PARTICLE</code>.</p>
<p>It uses the following registers as data:</p>
<table>
<thead>
<tr>
<th style="text-align:right">addr</th>
<th>size</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right"><code>$FFA0</code></td>
<td>2 Bytes</td>
<td>Source address</td>
</tr>
<tr>
<td style="text-align:right"><code>$FFA2</code></td>
<td>2 Bytes</td>
<td>Bytes count</td>
</tr>
<tr>
<td style="text-align:right"><code>$FFA4</code></td>
<td>2 Bytes</td>
<td>Destination address</td>
</tr>
</tbody>
</table>
<p>To copy from an address greater or equal than <code>$10000</code>, the OPTIONAL <code>[ROM]</code> argument MUST be used.</p>
<h3 id="file-api">File API</h3>
<p>Give access to the <a href="#virtual-file">virtual file embedded</a> in the cartridge.</p>
<h4 id="-files-"><code>FILES</code></h4>
<p>Enable the access to the files, allowing to use the other commands of the file API.</p>
<p>Getting access to files allow to create editor program, like characters, map or custom editor. The official GFX and SFX use this command.</p>
<p>When the <code>FILES</code> command is called, it will map the data stored in the fantasy cartridge to virtual files indexed from 0 to 15.</p>
<h4 id="-comment-file-file-"><code>comment$=FILE$(file)</code></h4>
<p>Return the <code>comment$</code> string of the <code>file</code>.</p>
<p>The command <a href="#files"><code>FILES</code></a> MUST be called before.</p>
<h4 id="-size-fsize-file-"><code>size=FSIZE(file)</code></h4>
<p>Return the <code>size</code> in bytes stored in the <code>file</code>.</p>
<p>The command <a href="#files"><code>FILES</code></a> MUST be called before.</p>
<h4 id="-load-file-address-limit-offset-"><code>LOAD file,address[,limit[,offset]]</code></h4>
<p>Load the virtual <code>file</code> at <code>address</code>. Optionnaly <code>limit</code> the number of bytes read and start at <code>offset</code>.</p>
<p>The command <a href="#files"><code>FILES</code></a> MUST be called before.</p>
<h4 id="-save-file-comment-address-size-"><code>SAVE file,comment$,address,size</code></h4>
<p>Save <code>size</code> bytes from <code>address</code> to the <code>file</code> and <strong>erase previous data</strong>. The <code>comment$</code> is just a reminder of what is stored.</p>
<p>The command <a href="#files"><code>FILES</code></a> MUST be called before.</p>
<h3 id="other-api">Other API</h3>
<h4 id="-trace-expression-expression-"><code>TRACE expression[,expression...]</code></h4>
<p>Output the evaluated <code>expression</code> on the <a href="#overlay">overlay</a>.</p>
<h4 id="-message-text-"><code>MESSAGE text</code></h4>
<p>Output <code>text</code> in the bottom-left corner of the fantasy screen, in the <a href="#overlay">overlay</a>.</p>
<h4 id="-system-setting-value-"><code>SYSTEM setting,value</code></h4>
<p>Sets the <code>value</code> to system <code>setting</code>.</p>
<table>
<thead>
<tr>
<th style="text-align:right">setting</th>
<th style="text-align:left">purpose</th>
<th style="text-align:left">values</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:left">energy saving mode</td>
<td style="text-align:left">0 or 1</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:left">color 0 opacity for layer 0</td>
<td style="text-align:left">0 or 1</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:left">color 0 opacity for layer 1</td>
<td style="text-align:left">0 or 1</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:left">color 0 opacity for layer 2</td>
<td style="text-align:left">0 or 1</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:left">color 0 opacity for layer 3</td>
<td style="text-align:left">0 or 1</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td style="text-align:left">double size for layer 0</td>
<td style="text-align:left">0 or 1</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td style="text-align:left">double size for layer 1</td>
<td style="text-align:left">0 or 1</td>
</tr>
<tr>
<td style="text-align:right">7</td>
<td style="text-align:left">double size for layer 2</td>
<td style="text-align:left">0 or 1</td>
</tr>
<tr>
<td style="text-align:right">8</td>
<td style="text-align:left">double size for layer</td>
<td style="text-align:left">0 or 1</td>
</tr>
</tbody>
</table>
<p>Enabling the <em>energy saving mode</em> setting will reduce the refresh rate whenever there is no user input. The CPU cycles are not affected.</p>
<p>Enabling the <em>color 0 opacity</em> will make the color 0 of each palette non transparent.</p>
<blockquote>
<p>It makes no sens for layer 0.</p>
</blockquote>
<p>Enabling the <em>double size</em> will make the background layer rendered at twice the size. The scrolling values are not affected.</p>
<h4 id="-haptic-pattern-"><code>HAPTIC pattern</code></h4>
<p>Trigger an haptic feedback on the device make it vibrate using a <code>pattern</code> (0..9).</p>
<table>
<thead>
<tr>
<th style="text-align:right">pattern</th>
<th>feeling</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td></td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td>tok-tirti</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td>tok-tik</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td>took-ti</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td>took</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td>tik</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td>tok</td>
</tr>
<tr>
<td style="text-align:right">7</td>
<td>ti</td>
</tr>
<tr>
<td style="text-align:right">8</td>
<td>tf</td>
</tr>
<tr>
<td style="text-align:right">9</td>
<td>t</td>
</tr>
</tbody>
</table>
<p>Not supported on all devices.</p>
<h4 id="-compat-"><code>COMPAT</code></h4>
<p>Enables compatibility mode:</p>
<ul>
<li>Forces the rendering process to keep the original device screen.</li>
<li>Reverts the <code>RND</code> command and <code>=RND()</code> function to their original behavior.</li>
</ul>
<p>This does not guarantee full compatibility but can help with some aspects. For instance:</p>
<ul>
<li>Commands and functions that have been removed will still be unavailable.</li>
<li>Double cell support for background is not emulated.</li>
</ul>
<blockquote>
<p>This command will be removed at some point.</p>
</blockquote>
<h4 id="-pause-"><code>PAUSE</code></h4>
<p>Halt the execution of bring the debugger console.</p>
<p>Check the <a href="#debugger-instructions">debugger instructions</a> to learn what you can to do with it.</p>
<h2 id="debugger-instructions">Debugger instructions</h2>
<h4 id="dbg-pause-">dbg: <code>PAUSE</code></h4>
<p>Enter the debugger. It bring a console where user can enter debugger specific commands. The scope used in the debugger is the same as the one in the program where the <code>PAUSE</code> appear.</p>
<h4 id="dbg-a-variable-name">dbg: a variable name</h4>
<p>By typing the name of a variable, the debugger will print it's value. The variable use the same syntax as inside a program: <code>$</code> for string, <code>()</code> for array.</p>
<p>The variable MUST be accessible throughout the scope of where the <code>PAUSE</code> has been used to enter the debugger. Global variables are still available everywhere.</p>
<h4 id="dbg-a-variable-name-new-value">dbg: a variable name <code>=</code> new value</h4>
<p>Allow to change the value of a variable.</p>
<p>Number literal use the same syntax as inside a program, it support integer, float, <code>$</code> hexadecimal and <code>%</code> binary.</p>
<p>String literal SHOULD use the same syntax as inside a program: <code>&quot;</code>.</p>
<h4 id="dbg-an-address">dbg: an address</h4>
<p>By typing a memory address, the debugger will print it's value as if it was read by <code>peek()</code>.</p>
<p>The address can be indicated using the <code>$</code> hexadecimal or by any other valid numeric literal.</p>
<h4 id="dbg-an-address-a-value">dbg: an address <code>=</code> a value</h4>
<p>Will try to modify the value store inside a memory address.</p>
<pre><code>`$FF00=<span class="hljs-number">3</span>`
</code></pre><h4 id="dbg-cls-">dbg: <code>CLS</code></h4>
<p>Clear the debugger console.</p>
<h4 id="dbg-wait-">dbg: <code>WAIT</code></h4>
<p>Resume execution until a <code>WAIT</code> command is found in the program, the scope may change.</p>
<h4 id="dbg-dim-filter-pagination-">dbg: <code>DIM [filter] [pagination]</code></h4>
<p>Print the list of accessible variable at the current scope.</p>
<p>Allow to limit the output to the variables that matchs the <code>[filter]</code>.</p>
<p>Allow to output more variables using the <code>[pagination]</code> with an index that start at <code>0</code> zero.</p>
<h4 id="dbg-trace-">dbg: <code>TRACE</code></h4>
<p>Print the current call stack in order: label and procedure names.</p>
<h2 id="references">References</h2>
<p>This annex provides technical information about how things work under the hood.</p>
<h3 id="64-colors">64 Colors</h3>
<p><style>
.famicube{display:flex;flex-wrap:wrap}
.famicube div{font-family:monospace;padding:0.8em 1em;width:2em}
.famicube div:nth-child(1){background:#000000;color:#fff}
.famicube div:nth-child(2){background:#e03c28;color:#000}
.famicube div:nth-child(3){background:#ffffff;color:#000}
.famicube div:nth-child(4){background:#d7d7d7;color:#000}
.famicube div:nth-child(5){background:#a8a8a8;color:#000}
.famicube div:nth-child(6){background:#7b7b7b;color:#fff}
.famicube div:nth-child(7){background:#343434;color:#fff}
.famicube div:nth-child(8){background:#151515;color:#fff}
.famicube div:nth-child(9){background:#0d2030;color:#fff}
.famicube div:nth-child(10){background:#415d66;color:#fff}
.famicube div:nth-child(11){background:#71a6a1;color:#000}
.famicube div:nth-child(12){background:#bdffca;color:#000}
.famicube div:nth-child(13){background:#25e2cd;color:#000}
.famicube div:nth-child(14){background:#0a98ac;color:#fff}
.famicube div:nth-child(15){background:#005280;color:#fff}
.famicube div:nth-child(16){background:#00604b;color:#fff}
.famicube div:nth-child(17){background:#20b562;color:#000}
.famicube div:nth-child(18){background:#58d332;color:#000}
.famicube div:nth-child(19){background:#139d08;color:#fff}
.famicube div:nth-child(20){background:#004e00;color:#fff}
.famicube div:nth-child(21){background:#172808;color:#fff}
.famicube div:nth-child(22){background:#376d03;color:#fff}
.famicube div:nth-child(23){background:#6ab417;color:#000}
.famicube div:nth-child(24){background:#8cd612;color:#000}
.famicube div:nth-child(25){background:#beeb71;color:#000}
.famicube div:nth-child(26){background:#eeffa9;color:#000}
.famicube div:nth-child(27){background:#b6c121;color:#000}
.famicube div:nth-child(28){background:#939717;color:#fff}
.famicube div:nth-child(29){background:#cc8f15;color:#000}
.famicube div:nth-child(30){background:#ffbb31;color:#000}
.famicube div:nth-child(31){background:#ffe737;color:#000}
.famicube div:nth-child(32){background:#f68f37;color:#000}
.famicube div:nth-child(33){background:#ad4e1a;color:#fff}
.famicube div:nth-child(34){background:#231712;color:#fff}
.famicube div:nth-child(35){background:#5c3c0d;color:#fff}
.famicube div:nth-child(36){background:#ae6c37;color:#000}
.famicube div:nth-child(37){background:#c59782;color:#000}
.famicube div:nth-child(38){background:#e2d7b5;color:#000}
.famicube div:nth-child(39){background:#4f1507;color:#fff}
.famicube div:nth-child(40){background:#823c3d;color:#fff}
.famicube div:nth-child(41){background:#da655e;color:#000}
.famicube div:nth-child(42){background:#e18289;color:#000}
.famicube div:nth-child(43){background:#f5b784;color:#000}
.famicube div:nth-child(44){background:#ffe9c5;color:#000}
.famicube div:nth-child(45){background:#ff82ce;color:#000}
.famicube div:nth-child(46){background:#cf3c71;color:#fff}
.famicube div:nth-child(47){background:#871646;color:#fff}
.famicube div:nth-child(48){background:#a328b3;color:#fff}
.famicube div:nth-child(49){background:#cc69e4;color:#000}
.famicube div:nth-child(50){background:#d59cfc;color:#000}
.famicube div:nth-child(51){background:#fec9ed;color:#000}
.famicube div:nth-child(52){background:#e2c9ff;color:#000}
.famicube div:nth-child(53){background:#a675fe;color:#000}
.famicube div:nth-child(54){background:#6a31ca;color:#fff}
.famicube div:nth-child(55){background:#5a1991;color:#fff}
.famicube div:nth-child(56){background:#211640;color:#fff}
.famicube div:nth-child(57){background:#3d34a5;color:#fff}
.famicube div:nth-child(58){background:#6264dc;color:#000}
.famicube div:nth-child(59){background:#9ba0ef;color:#000}
.famicube div:nth-child(60){background:#98dcff;color:#000}
.famicube div:nth-child(61){background:#5ba8ff;color:#000}
.famicube div:nth-child(62){background:#0a89ff;color:#fff}
.famicube div:nth-child(63){background:#024aca;color:#fff}
.famicube div:nth-child(64){background:#00177d;color:#fff}
</style></p>
<div class="famicube">
    <div>00</div><div>01</div><div>02</div><div>03</div><div>04</div><div>05</div><div>06</div><div>07</div>
    <div>08</div><div>09</div><div>10</div><div>11</div><div>12</div><div>13</div><div>14</div><div>15</div>
    <div>16</div><div>17</div><div>18</div><div>19</div><div>20</div><div>21</div><div>22</div><div>23</div>
    <div>24</div><div>25</div><div>26</div><div>27</div><div>28</div><div>29</div><div>30</div><div>31</div>
    <div>32</div><div>33</div><div>34</div><div>35</div><div>36</div><div>37</div><div>38</div><div>39</div>
    <div>40</div><div>41</div><div>42</div><div>43</div><div>44</div><div>45</div><div>46</div><div>47</div>
    <div>48</div><div>49</div><div>50</div><div>51</div><div>52</div><div>53</div><div>54</div><div>55</div>
    <div>56</div><div>57</div><div>58</div><div>59</div><div>60</div><div>61</div><div>62</div><div>63</div>
</div>

<h3 id="memory-mapping">Memory mapping</h3>
<table>
<thead>
<tr>
<th style="text-align:right">address</th>
<th>size</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right"><code>$00000</code></td>
<td>8 Kibibyte</td>
<td>Layer 0 data</td>
</tr>
<tr>
<td style="text-align:right"><code>$02000</code></td>
<td>8 Kibibyte</td>
<td>Layer 1 data</td>
</tr>
<tr>
<td style="text-align:right"><code>$04000</code></td>
<td>8 Kibibyte</td>
<td>Layer 2 data</td>
</tr>
<tr>
<td style="text-align:right"><code>$06000</code></td>
<td>8 Kibibyte</td>
<td>Layer 3 data</td>
</tr>
<tr>
<td style="text-align:right"><code>$08000</code></td>
<td>4 Kibibyte</td>
<td>Character data</td>
</tr>
<tr>
<td style="text-align:right"><code>$09000</code></td>
<td>20 Kibibyte</td>
<td>Working RAM</td>
</tr>
<tr>
<td style="text-align:right"><code>$0E000</code></td>
<td>6 Kibibyte</td>
<td>Persistent RAM</td>
</tr>
<tr>
<td style="text-align:right"><code>$0FB00</code></td>
<td>1020 Bytes</td>
<td>Sprite registers</td>
</tr>
<tr>
<td style="text-align:right"><code>$0FF00</code></td>
<td>32 Bytes</td>
<td>Color registers</td>
</tr>
<tr>
<td style="text-align:right"><code>$0FF20</code></td>
<td>10 Bytes</td>
<td>Video registers</td>
</tr>
<tr>
<td style="text-align:right"><code>$0FF40</code></td>
<td>48 Bytes</td>
<td>Audio registers</td>
</tr>
<tr>
<td style="text-align:right"><code>$0FF70</code></td>
<td>28 Bytes</td>
<td>I/O registers</td>
</tr>
<tr>
<td style="text-align:right"><code>$0FFA0</code></td>
<td>6 Bytes</td>
<td>DMA registers</td>
</tr>
<tr>
<td style="text-align:right"><code>$0FFA6</code></td>
<td>10 Bytes</td>
<td>Internal registers</td>
</tr>
<tr>
<td style="text-align:right"><code>$10000</code></td>
<td>64 Kibibyte</td>
<td>Cartridge ROM</td>
</tr>
</tbody>
</table>
<p>TODO: Add particle/emitter registers</p>
<h3 id="todo-color-data">TODO: Color data</h3>
<h3 id="background-data">Background data</h3>
<p>The 4 background layers use the following format:</p>
<ul>
<li>64x64 cells</li>
<li>2 bytes per cell</li>
</ul>
<p>For each cell:</p>
<table>
<thead>
<tr>
<th style="text-align:right">address</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">addr+0</td>
<td>character number (0..255)</td>
</tr>
<tr>
<td style="text-align:right">addr+2</td>
<td>cell attributes</td>
</tr>
</tbody>
</table>
<h3 id="cell-attributes">Cell attributes</h3>
<table>
<thead>
<tr>
<th style="text-align:right">bit mask</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right"><code>%00000111</code></td>
<td>palette number (0..7)</td>
</tr>
<tr>
<td style="text-align:right"><code>%00001000</code></td>
<td>horizontal flip (0..1)</td>
</tr>
<tr>
<td style="text-align:right"><code>%00010000</code></td>
<td>vertical flip (0..1)</td>
</tr>
<tr>
<td style="text-align:right"><code>%00100000</code></td>
<td>priority flag (0..1)</td>
</tr>
</tbody>
</table>
<p><em>the last 2 bits are unused</em></p>
<h3 id="character-data">Character data</h3>
<p>The 256 characters use the following format:</p>
<ul>
<li>8x8 pixels</li>
<li>2 bits per pixel</li>
<li>16 bytes per character</li>
<li>üåê<a href="https://en.wikipedia.org/wiki/Bit_plane">bit plane encoded</a></li>
</ul>
<p>The pixels are encoded bit per bit, from left to right, then top to bottom, one plane at a time.
The 1st 8 bytes store the low bit for all the 8x8 pixels. The 2nd 8 bytes store the high bit.</p>
<h3 id="background-source-format-data">Background source format data</h3>
<p>When using <a href="#bg-source-addresswidthheight"><code>BG SOURCE address[,width,height]</code></a> without specifying <code>width</code> and <code>height</code>, a specific header is added before the regular <a href="#background-data">background data</a>:</p>
<table>
<thead>
<tr>
<th style="text-align:right">address</th>
<th>size</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">addr+0</td>
<td>1 Byte</td>
<td>always zero</td>
</tr>
<tr>
<td style="text-align:right">addr+1</td>
<td>1 Byte</td>
<td>always zero</td>
</tr>
<tr>
<td style="text-align:right">addr+2</td>
<td>1 Byte</td>
<td>width in cell</td>
</tr>
<tr>
<td style="text-align:right">addr+3</td>
<td>1 Byte</td>
<td>height in cell</td>
</tr>
<tr>
<td style="text-align:right">addr+4</td>
<td>...</td>
<td>background data</td>
</tr>
</tbody>
</table>
<h3 id="sound-source-format-data">Sound source format data</h3>
<p>When using <a href="manual#`SOUND SOURCE [address]`"><code>SOUND SOURCE</code></a>, Retro Game Creator will use the following data format to store sounds, patterns and tracks.</p>
<p>TODO: continue</p>
<table>
<thead>
<tr>
<th style="text-align:right">address</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">addr+0</td>
<td>16 sound presets</td>
</tr>
<tr>
<td style="text-align:right">addr+128</td>
<td>64 patterns</td>
</tr>
<tr>
<td style="text-align:right">addr+384</td>
<td>64 tracks</td>
</tr>
</tbody>
</table>
<p>For each sound preset:</p>
<table>
<thead>
<tr>
<th style="text-align:right">address</th>
<th>size</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">addr+0</td>
<td>1</td>
<td><a href="manual#Attributes bits:">Attributes</a></td>
</tr>
<tr>
<td style="text-align:right">addr+1</td>
<td>1</td>
<td>Length</td>
</tr>
<tr>
<td style="text-align:right">addr+2</td>
<td>2</td>
<td><a href="manual#Envelope bits:">Envelope</a></td>
</tr>
<tr>
<td style="text-align:right">addr+4</td>
<td>1</td>
<td>LFO attributes</td>
</tr>
<tr>
<td style="text-align:right">addr+5</td>
<td>2</td>
<td>LFO settings</td>
</tr>
<tr>
<td style="text-align:right">addr+7</td>
<td>1</td>
<td>Not used</td>
</tr>
</tbody>
</table>
<h4 id="attributes-bits-">Attributes bits:</h4>
<table>
<thead>
<tr>
<th style="text-align:right">bits</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0..3</td>
<td>Pulse width</td>
</tr>
<tr>
<td style="text-align:right">4..5</td>
<td>Wave<br><code>0</code> Sawtooth<br><code>1</code> Triangle<br><code>2</code> Pulse<br><code>3</code> Noise</td>
</tr>
<tr>
<td style="text-align:right">6</td>
<td>Timeout enabled</td>
</tr>
</tbody>
</table>
<h4 id="envelope-bits-">Envelope bits:</h4>
<table>
<thead>
<tr>
<th style="text-align:right">bits</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0..3</td>
<td>Attack duration</td>
</tr>
<tr>
<td style="text-align:right">4..7</td>
<td>Decay duration</td>
</tr>
<tr>
<td style="text-align:right">8..11</td>
<td>Sustain volume</td>
</tr>
<tr>
<td style="text-align:right">12..15</td>
<td>Decay volume</td>
</tr>
</tbody>
</table>
<p>TODO: every attributes and settings</p>
<h3 id="pitch-values">Pitch values</h3>
<table>
<thead>
<tr>
<th style="text-align:right">alpha</th>
<th style="text-align:right">sylla</th>
<th>pitch per octave</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">C</td>
<td style="text-align:right">Do</td>
<td>01 13 25 37 49 61 73 85</td>
</tr>
<tr>
<td style="text-align:right">C#</td>
<td style="text-align:right">#Do</td>
<td>02 14 26 38 50 62 74 86</td>
</tr>
<tr>
<td style="text-align:right">D</td>
<td style="text-align:right">Re</td>
<td>03 15 27 39 51 63 75 87</td>
</tr>
<tr>
<td style="text-align:right">D#</td>
<td style="text-align:right">#Re</td>
<td>04 16 28 40 52 64 76 88</td>
</tr>
<tr>
<td style="text-align:right">E</td>
<td style="text-align:right">Mi</td>
<td>05 17 29 41 53 65 77 89</td>
</tr>
<tr>
<td style="text-align:right">F</td>
<td style="text-align:right">Fa</td>
<td>06 18 30 42 54 66 78 90</td>
</tr>
<tr>
<td style="text-align:right">F#</td>
<td style="text-align:right">#Fa</td>
<td>07 19 31 43 55 67 79 91</td>
</tr>
<tr>
<td style="text-align:right">G</td>
<td style="text-align:right">Sol</td>
<td>08 20 32 44 56 68 80 92</td>
</tr>
<tr>
<td style="text-align:right">G#</td>
<td style="text-align:right">#Sol</td>
<td>09 21 33 45 57 69 81 93</td>
</tr>
<tr>
<td style="text-align:right">A</td>
<td style="text-align:right">La</td>
<td>10 22 34 46 58 70 82 94</td>
</tr>
<tr>
<td style="text-align:right">A#</td>
<td style="text-align:right">#La</td>
<td>11 23 35 47 59 71 83 95</td>
</tr>
<tr>
<td style="text-align:right">B</td>
<td style="text-align:right">Si</td>
<td>12 24 36 48 60 72 84 96</td>
</tr>
</tbody>
</table>
<h3 id="ascii-table">ASCII table</h3>
<p>Retro Game Creator understand ASCII7 characters (0..127).</p>
<p>The <a href="#text-api">text API</a> can only print a fraction of it and remap it. The <a href="#font-first"><code>FONT</code> command</a> is used to indicate which characters are use to print the ASCII characters.</p>
<table>
<thead>
<tr>
<th style="text-align:right">ascii code</th>
<th>usage</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0..31</td>
<td>not used</td>
</tr>
<tr>
<td style="text-align:right">32..95</td>
<td>used by <a href="#font-first"><code>FONT</code></a></td>
</tr>
<tr>
<td style="text-align:right">95..255</td>
<td>not used</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:right">code</th>
<th style="text-align:right">hexa</th>
<th>character</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">17</td>
<td style="text-align:right">$11</td>
<td>right arrow</td>
</tr>
<tr>
<td style="text-align:right">18</td>
<td style="text-align:right">$12</td>
<td>left arrow</td>
</tr>
<tr>
<td style="text-align:right">19</td>
<td style="text-align:right">$13</td>
<td>down arrow</td>
</tr>
<tr>
<td style="text-align:right">20</td>
<td style="text-align:right">$14</td>
<td>up arrow</td>
</tr>
<tr>
<td style="text-align:right">32</td>
<td style="text-align:right">$20</td>
<td>whitespace</td>
</tr>
<tr>
<td style="text-align:right">33</td>
<td style="text-align:right">$21</td>
<td>&quot;!&quot;</td>
</tr>
<tr>
<td style="text-align:right">34</td>
<td style="text-align:right">$22</td>
<td>'&quot;'</td>
</tr>
<tr>
<td style="text-align:right">35</td>
<td style="text-align:right">$23</td>
<td>&quot;#&quot;</td>
</tr>
<tr>
<td style="text-align:right">36</td>
<td style="text-align:right">$24</td>
<td>&quot;$&quot;</td>
</tr>
<tr>
<td style="text-align:right">37</td>
<td style="text-align:right">$25</td>
<td>&quot;%&quot;</td>
</tr>
<tr>
<td style="text-align:right">38</td>
<td style="text-align:right">$26</td>
<td>&quot;&amp;&quot;</td>
</tr>
<tr>
<td style="text-align:right">39</td>
<td style="text-align:right">$27</td>
<td>&quot;'&quot;</td>
</tr>
<tr>
<td style="text-align:right">40</td>
<td style="text-align:right">$28</td>
<td>&quot;(&quot;</td>
</tr>
<tr>
<td style="text-align:right">41</td>
<td style="text-align:right">$29</td>
<td>&quot;)&quot;</td>
</tr>
<tr>
<td style="text-align:right">42</td>
<td style="text-align:right">$2A</td>
<td>&quot;*&quot;</td>
</tr>
<tr>
<td style="text-align:right">43</td>
<td style="text-align:right">$2B</td>
<td>&quot;+&quot;</td>
</tr>
<tr>
<td style="text-align:right">44</td>
<td style="text-align:right">$2C</td>
<td>&quot;,&quot;</td>
</tr>
<tr>
<td style="text-align:right">45</td>
<td style="text-align:right">$2D</td>
<td>&quot;-&quot;</td>
</tr>
<tr>
<td style="text-align:right">46</td>
<td style="text-align:right">$2E</td>
<td>&quot;.&quot;</td>
</tr>
<tr>
<td style="text-align:right">47</td>
<td style="text-align:right">$2F</td>
<td>&quot;/&quot;</td>
</tr>
<tr>
<td style="text-align:right">48</td>
<td style="text-align:right">$30</td>
<td>&quot;0&quot;</td>
</tr>
<tr>
<td style="text-align:right">49</td>
<td style="text-align:right">$31</td>
<td>&quot;1&quot;</td>
</tr>
<tr>
<td style="text-align:right">50</td>
<td style="text-align:right">$32</td>
<td>&quot;2&quot;</td>
</tr>
<tr>
<td style="text-align:right">51</td>
<td style="text-align:right">$33</td>
<td>&quot;3&quot;</td>
</tr>
<tr>
<td style="text-align:right">52</td>
<td style="text-align:right">$34</td>
<td>&quot;4&quot;</td>
</tr>
<tr>
<td style="text-align:right">53</td>
<td style="text-align:right">$35</td>
<td>&quot;5&quot;</td>
</tr>
<tr>
<td style="text-align:right">54</td>
<td style="text-align:right">$36</td>
<td>&quot;6&quot;</td>
</tr>
<tr>
<td style="text-align:right">55</td>
<td style="text-align:right">$37</td>
<td>&quot;7&quot;</td>
</tr>
<tr>
<td style="text-align:right">56</td>
<td style="text-align:right">$38</td>
<td>&quot;8&quot;</td>
</tr>
<tr>
<td style="text-align:right">57</td>
<td style="text-align:right">$39</td>
<td>&quot;9&quot;</td>
</tr>
<tr>
<td style="text-align:right">58</td>
<td style="text-align:right">$3A</td>
<td>&quot;:&quot;</td>
</tr>
<tr>
<td style="text-align:right">59</td>
<td style="text-align:right">$3B</td>
<td>&quot;;&quot;</td>
</tr>
<tr>
<td style="text-align:right">60</td>
<td style="text-align:right">$3C</td>
<td>&quot;&lt;&quot;</td>
</tr>
<tr>
<td style="text-align:right">61</td>
<td style="text-align:right">$3D</td>
<td>&quot;=&quot;</td>
</tr>
<tr>
<td style="text-align:right">62</td>
<td style="text-align:right">$3E</td>
<td>&quot;&gt;&quot;</td>
</tr>
<tr>
<td style="text-align:right">63</td>
<td style="text-align:right">$3F</td>
<td>&quot;?&quot;</td>
</tr>
<tr>
<td style="text-align:right">64</td>
<td style="text-align:right">$40</td>
<td>&quot;@&quot;</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:right">code</th>
<th style="text-align:right">hexa</th>
<th>character</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">65</td>
<td style="text-align:right">$41</td>
<td>&quot;A&quot;</td>
</tr>
<tr>
<td style="text-align:right">66</td>
<td style="text-align:right">$42</td>
<td>&quot;B&quot;</td>
</tr>
<tr>
<td style="text-align:right">67</td>
<td style="text-align:right">$43</td>
<td>&quot;C&quot;</td>
</tr>
<tr>
<td style="text-align:right">68</td>
<td style="text-align:right">$44</td>
<td>&quot;D&quot;</td>
</tr>
<tr>
<td style="text-align:right">69</td>
<td style="text-align:right">$45</td>
<td>&quot;E&quot;</td>
</tr>
<tr>
<td style="text-align:right">70</td>
<td style="text-align:right">$46</td>
<td>&quot;F&quot;</td>
</tr>
<tr>
<td style="text-align:right">71</td>
<td style="text-align:right">$47</td>
<td>&quot;G&quot;</td>
</tr>
<tr>
<td style="text-align:right">72</td>
<td style="text-align:right">$48</td>
<td>&quot;H&quot;</td>
</tr>
<tr>
<td style="text-align:right">73</td>
<td style="text-align:right">$49</td>
<td>&quot;I&quot;</td>
</tr>
<tr>
<td style="text-align:right">74</td>
<td style="text-align:right">$4A</td>
<td>&quot;J&quot;</td>
</tr>
<tr>
<td style="text-align:right">75</td>
<td style="text-align:right">$4B</td>
<td>&quot;K&quot;</td>
</tr>
<tr>
<td style="text-align:right">76</td>
<td style="text-align:right">$4C</td>
<td>&quot;L&quot;</td>
</tr>
<tr>
<td style="text-align:right">77</td>
<td style="text-align:right">$4D</td>
<td>&quot;M&quot;</td>
</tr>
<tr>
<td style="text-align:right">78</td>
<td style="text-align:right">$4E</td>
<td>&quot;N&quot;</td>
</tr>
<tr>
<td style="text-align:right">79</td>
<td style="text-align:right">$4F</td>
<td>&quot;O&quot;</td>
</tr>
<tr>
<td style="text-align:right">80</td>
<td style="text-align:right">$50</td>
<td>&quot;P&quot;</td>
</tr>
<tr>
<td style="text-align:right">81</td>
<td style="text-align:right">$51</td>
<td>&quot;Q&quot;</td>
</tr>
<tr>
<td style="text-align:right">82</td>
<td style="text-align:right">$52</td>
<td>&quot;R&quot;</td>
</tr>
<tr>
<td style="text-align:right">83</td>
<td style="text-align:right">$53</td>
<td>&quot;S&quot;</td>
</tr>
<tr>
<td style="text-align:right">84</td>
<td style="text-align:right">$54</td>
<td>&quot;T&quot;</td>
</tr>
<tr>
<td style="text-align:right">85</td>
<td style="text-align:right">$55</td>
<td>&quot;U&quot;</td>
</tr>
<tr>
<td style="text-align:right">86</td>
<td style="text-align:right">$56</td>
<td>&quot;V&quot;</td>
</tr>
<tr>
<td style="text-align:right">87</td>
<td style="text-align:right">$57</td>
<td>&quot;W&quot;</td>
</tr>
<tr>
<td style="text-align:right">88</td>
<td style="text-align:right">$58</td>
<td>&quot;X&quot;</td>
</tr>
<tr>
<td style="text-align:right">89</td>
<td style="text-align:right">$59</td>
<td>&quot;Y&quot;</td>
</tr>
<tr>
<td style="text-align:right">90</td>
<td style="text-align:right">$5A</td>
<td>&quot;Z&quot;</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:right">code</th>
<th style="text-align:right">hexa</th>
<th>character</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">91</td>
<td style="text-align:right">$5B</td>
<td>&quot;[&quot;</td>
</tr>
<tr>
<td style="text-align:right">92</td>
<td style="text-align:right">$5C</td>
<td>&quot;\&quot;</td>
</tr>
<tr>
<td style="text-align:right">93</td>
<td style="text-align:right">$5D</td>
<td>&quot;]&quot;</td>
</tr>
<tr>
<td style="text-align:right">94</td>
<td style="text-align:right">$5E</td>
<td>&quot;^&quot;</td>
</tr>
<tr>
<td style="text-align:right">95</td>
<td style="text-align:right">$5F</td>
<td>&quot;_&quot;</td>
</tr>
<tr>
<td style="text-align:right">96</td>
<td style="text-align:right">$60</td>
<td>&quot;`&quot;</td>
</tr>
<tr>
<td style="text-align:right">97</td>
<td style="text-align:right">$61</td>
<td>&quot;a&quot;</td>
</tr>
<tr>
<td style="text-align:right">98</td>
<td style="text-align:right">$62</td>
<td>&quot;b&quot;</td>
</tr>
<tr>
<td style="text-align:right">99</td>
<td style="text-align:right">$63</td>
<td>&quot;c&quot;</td>
</tr>
<tr>
<td style="text-align:right">100</td>
<td style="text-align:right">$64</td>
<td>&quot;d&quot;</td>
</tr>
<tr>
<td style="text-align:right">101</td>
<td style="text-align:right">$65</td>
<td>&quot;e&quot;</td>
</tr>
<tr>
<td style="text-align:right">102</td>
<td style="text-align:right">$66</td>
<td>&quot;f&quot;</td>
</tr>
<tr>
<td style="text-align:right">103</td>
<td style="text-align:right">$67</td>
<td>&quot;g&quot;</td>
</tr>
<tr>
<td style="text-align:right">104</td>
<td style="text-align:right">$68</td>
<td>&quot;h&quot;</td>
</tr>
<tr>
<td style="text-align:right">105</td>
<td style="text-align:right">$69</td>
<td>&quot;i&quot;</td>
</tr>
<tr>
<td style="text-align:right">106</td>
<td style="text-align:right">$6A</td>
<td>&quot;j&quot;</td>
</tr>
<tr>
<td style="text-align:right">107</td>
<td style="text-align:right">$6B</td>
<td>&quot;k&quot;</td>
</tr>
<tr>
<td style="text-align:right">108</td>
<td style="text-align:right">$6C</td>
<td>&quot;l&quot;</td>
</tr>
<tr>
<td style="text-align:right">109</td>
<td style="text-align:right">$6D</td>
<td>&quot;m&quot;</td>
</tr>
<tr>
<td style="text-align:right">110</td>
<td style="text-align:right">$6E</td>
<td>&quot;n&quot;</td>
</tr>
<tr>
<td style="text-align:right">111</td>
<td style="text-align:right">$6F</td>
<td>&quot;o&quot;</td>
</tr>
<tr>
<td style="text-align:right">112</td>
<td style="text-align:right">$70</td>
<td>&quot;p&quot;</td>
</tr>
<tr>
<td style="text-align:right">113</td>
<td style="text-align:right">$71</td>
<td>&quot;q&quot;</td>
</tr>
<tr>
<td style="text-align:right">114</td>
<td style="text-align:right">$72</td>
<td>&quot;r&quot;</td>
</tr>
<tr>
<td style="text-align:right">115</td>
<td style="text-align:right">$73</td>
<td>&quot;s&quot;</td>
</tr>
<tr>
<td style="text-align:right">116</td>
<td style="text-align:right">$74</td>
<td>&quot;t&quot;</td>
</tr>
<tr>
<td style="text-align:right">117</td>
<td style="text-align:right">$75</td>
<td>&quot;u&quot;</td>
</tr>
<tr>
<td style="text-align:right">118</td>
<td style="text-align:right">$76</td>
<td>&quot;v&quot;</td>
</tr>
<tr>
<td style="text-align:right">119</td>
<td style="text-align:right">$77</td>
<td>&quot;w&quot;</td>
</tr>
<tr>
<td style="text-align:right">120</td>
<td style="text-align:right">$78</td>
<td>&quot;x&quot;</td>
</tr>
<tr>
<td style="text-align:right">121</td>
<td style="text-align:right">$79</td>
<td>&quot;y&quot;</td>
</tr>
<tr>
<td style="text-align:right">122</td>
<td style="text-align:right">$7A</td>
<td>&quot;z&quot;</td>
</tr>
</tbody>
</table>
<h3 id="registers">Registers</h3>
<p>Registers are one or more bytes mapped in memory thats as an internal usage.</p>
<h4 id="character-registers">Character Registers</h4>
<p>Each one of the 256 character occupies 16 bytes.</p>
<table>
<thead>
<tr>
<th style="text-align:right">address</th>
<th>size</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right"><code>$8000</code></td>
<td>16 Bytes</td>
<td>1st character</td>
</tr>
<tr>
<td style="text-align:right"><code>$8010</code></td>
<td>16 Bytes</td>
<td>2nd character</td>
</tr>
<tr>
<td style="text-align:right"><code>$8020</code></td>
<td>16 Bytes</td>
<td>3rd character</td>
</tr>
<tr>
<td style="text-align:right">‚Ä¶</td>
<td>16 Bytes</td>
<td>‚Ä¶</td>
</tr>
<tr>
<td style="text-align:right"><code>$8FE0</code></td>
<td>16 Bytes</td>
<td>255th character</td>
</tr>
<tr>
<td style="text-align:right"><code>$8FF0</code></td>
<td>16 Bytes</td>
<td>256th character</td>
</tr>
</tbody>
</table>
<h4 id="sprite-registers">Sprite Registers</h4>
<p>There are 170 sprites, each occupies 6 bytes:</p>
<table>
<thead>
<tr>
<th style="text-align:right">address</th>
<th>size</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right"><code>$FB00</code></td>
<td>6 Bytes</td>
<td>1st sprite</td>
</tr>
<tr>
<td style="text-align:right"><code>$FB06</code></td>
<td>6 Bytes</td>
<td>2nd sprite</td>
</tr>
<tr>
<td style="text-align:right"><code>$FB0C</code></td>
<td>6 Bytes</td>
<td>3rd sprite</td>
</tr>
<tr>
<td style="text-align:right">‚Ä¶</td>
<td></td>
<td>‚Ä¶</td>
</tr>
<tr>
<td style="text-align:right"><code>$FEF6</code></td>
<td>6 Bytes</td>
<td>170th sprite</td>
</tr>
<tr>
<td style="text-align:right"><code>$FEFC</code></td>
<td>4 Bytes</td>
<td>Not used</td>
</tr>
</tbody>
</table>
<p>For each sprite:</p>
<table>
<thead>
<tr>
<th style="text-align:right">offset</th>
<th>size</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">+0</td>
<td>2 Bytes</td>
<td>Position on X axis</td>
</tr>
<tr>
<td style="text-align:right">+2</td>
<td>2 Bytes</td>
<td>Position on Y axis</td>
</tr>
<tr>
<td style="text-align:right">+4</td>
<td>1 Byte</td>
<td>Character number</td>
</tr>
<tr>
<td style="text-align:right">+5</td>
<td>1 Byte</td>
<td>Character attributes</td>
</tr>
</tbody>
</table>
<p>Both position on x and y axis use sub-pixels values. To advance by 1 pixel, the values SHOULD get increased by 16.
Also, they are both offseted by 32 pixels. To place a sprite in the 0x0 coordinates, the values SHOULD be 512x512.</p>
<h4 id="character-attributes">Character attributes</h4>
<table>
<thead>
<tr>
<th style="text-align:right">bits</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0..2</td>
<td>Palette number</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td>Horizontal flip</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td>Vertical flip</td>
</tr>
<tr>
<td style="text-align:right">5</td>
<td>Priority</td>
</tr>
<tr>
<td style="text-align:right">6..7</td>
<td>Size</td>
</tr>
</tbody>
</table>
<p>Sprite size:</p>
<table>
<thead>
<tr>
<th style="text-align:right">binary</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right"><code>%00</code></td>
<td>8x8 pixels or 1x1 character</td>
</tr>
<tr>
<td style="text-align:right"><code>%01</code></td>
<td>16x16 pixels or 2x2 characters</td>
</tr>
<tr>
<td style="text-align:right"><code>%10</code></td>
<td>24x24 pixels or 3x3 characters</td>
</tr>
<tr>
<td style="text-align:right"><code>%11</code></td>
<td>32x32 pixels or 4x4 characters</td>
</tr>
</tbody>
</table>
<h4 id="color-registers">Color registers</h4>
<p>There are 8 palettes with 4 colors each:</p>
<table>
<thead>
<tr>
<th style="text-align:right">addr</th>
<th>size</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right"><code>$FF00</code></td>
<td>32 Bytes</td>
<td>Color registers</td>
</tr>
</tbody>
</table>
<p>For each palette:</p>
<table>
<thead>
<tr>
<th style="text-align:right">offset</th>
<th>size</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">+0</td>
<td>1 Byte</td>
<td>1st color value</td>
</tr>
<tr>
<td style="text-align:right">+1</td>
<td>1 Byte</td>
<td>2nd color value</td>
</tr>
<tr>
<td style="text-align:right">+2</td>
<td>1 Byte</td>
<td>3rd color value</td>
</tr>
<tr>
<td style="text-align:right">+3</td>
<td>1 Byte</td>
<td>4th color value</td>
</tr>
</tbody>
</table>
<h4 id="video-registers">Video registers</h4>
<table>
<thead>
<tr>
<th style="text-align:right">addr</th>
<th>size</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right"><code>$FF20</code></td>
<td>2 Bytes</td>
<td>Background layer 0 scroll X</td>
</tr>
<tr>
<td style="text-align:right"><code>$FF22</code></td>
<td>2 Bytes</td>
<td>Background layer 0 scroll Y</td>
</tr>
<tr>
<td style="text-align:right"><code>$FF24</code></td>
<td>2 Bytes</td>
<td>Background layer 1 scroll X</td>
</tr>
<tr>
<td style="text-align:right"><code>$FF26</code></td>
<td>2 Bytes</td>
<td>Background layer 1 scroll Y</td>
</tr>
<tr>
<td style="text-align:right"><code>$FF28</code></td>
<td>2 Bytes</td>
<td>Background layer 2 scroll X</td>
</tr>
<tr>
<td style="text-align:right"><code>$FF2A</code></td>
<td>2 Bytes</td>
<td>Background layer 2 scroll Y</td>
</tr>
<tr>
<td style="text-align:right"><code>$FF2C</code></td>
<td>2 Bytes</td>
<td>Background layer 3 scroll X</td>
</tr>
<tr>
<td style="text-align:right"><code>$FF2E</code></td>
<td>2 Bytes</td>
<td>Background layer 3 scroll Y</td>
</tr>
<tr>
<td style="text-align:right"><code>$FF30</code></td>
<td>2 Bytes</td>
<td>Raster line number</td>
</tr>
<tr>
<td style="text-align:right"><code>$FF32</code></td>
<td>1 Byte</td>
<td>Display attributes</td>
</tr>
<tr>
<td style="text-align:right"><code>$FF33</code></td>
<td>12 Bytes</td>
<td>Not used</td>
</tr>
</tbody>
</table>
<h4 id="display-attributes">Display attributes</h4>
<table>
<thead>
<tr>
<th style="text-align:right">bits</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td>Sprites enabled</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td>Background layer 0 enabled</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td>Background layer 1 enabled</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td>Background layer 2 enabled</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td>Background layer 3 enabled</td>
</tr>
</tbody>
</table>
<h4 id="todo-audio-registers">TODO: Audio registers</h4>
<table>
<thead>
<tr>
<th style="text-align:right">addr</th>
<th>size</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right"><code>$FF40</code></td>
<td>48 Bytes</td>
<td>Audio registers</td>
</tr>
</tbody>
</table>
<h4 id="i-o-registers">I/O registers</h4>
<table>
<thead>
<tr>
<th style="text-align:right">addr</th>
<th>size</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right"><code>$FF70</code></td>
<td>4 Bytes</td>
<td>Last touch position X</td>
</tr>
<tr>
<td style="text-align:right"><code>$FF74</code></td>
<td>4 Bytes</td>
<td>Last touch position Y</td>
</tr>
<tr>
<td style="text-align:right"><code>$FF78</code></td>
<td>2 Bytes</td>
<td>Pixels shown in width</td>
</tr>
<tr>
<td style="text-align:right"><code>$FF7a</code></td>
<td>2 Bytes</td>
<td>Pixels shown in height</td>
</tr>
<tr>
<td style="text-align:right"><code>$FF7c</code></td>
<td>2 Bytes</td>
<td>Pixels outside the safe zone</td>
</tr>
<tr>
<td style="text-align:right"><code>$FF7e</code></td>
<td>2 Bytes</td>
<td>Pixels outside the safe zone</td>
</tr>
<tr>
<td style="text-align:right"><code>$FF80</code></td>
<td>2 Bytes</td>
<td>Pixels outside the safe zone</td>
</tr>
<tr>
<td style="text-align:right"><code>$FF82</code></td>
<td>2 Bytes</td>
<td>Pixels outside the safe zone</td>
</tr>
<tr>
<td style="text-align:right"><code>$FF84</code></td>
<td>1 Byte</td>
<td>ASCII code of last pressed key</td>
</tr>
<tr>
<td style="text-align:right"><code>$FF85</code></td>
<td>1 Byte</td>
<td>Other I/O status bits</td>
</tr>
</tbody>
</table>
<p>Last touch position X and Y are stored as float and currently Retro Game Creator do not have a way to peek float from memory, use <a href="#xtouchxytouchy"><code>TOUCH.X</code> and <code>TOUCH.Y</code></a> functions instead.</p>
<p>Pixels shown represent the number of fantasy pixels that is visible by the user according to their device screen ratio. Use the practical <a href="#widthshownxheightshownh"><code>SHOWN.W</code> and <code>SHOWN.H</code></a> functions.</p>
<p>Pixels outside the safe zone represent the number of fantasy pixels that are visible but SHOULD be considered unsafe for touch input as they are outside the safe area. Use the easy memorable <a href="#leftsafeltopsafetrightsaferbottomsafeb"><code>SAFE.L</code>, <code>SAFE.T</code>, <code>SAFE.R</code> and <code>SAFE.B</code></a> functions.</p>
<h4 id="other-i-o-status-bits">Other I/O status bits</h4>
<table>
<thead>
<tr>
<th style="text-align:right">bits</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td>Pause currently active</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td>Fantasy screen currently touched</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td>Device virtual keyboard currently visible</td>
</tr>
</tbody>
</table>
<h4 id="dma-registers">DMA registers</h4>
<table>
<thead>
<tr>
<th style="text-align:right">addr</th>
<th>size</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right"><code>$FFA0</code></td>
<td>2 Bytes</td>
<td>Source address</td>
</tr>
<tr>
<td style="text-align:right"><code>$FFA2</code></td>
<td>2 Bytes</td>
<td>Number of bytes to copy</td>
</tr>
<tr>
<td style="text-align:right"><code>$FFA4</code></td>
<td>2 Bytes</td>
<td>Destination address</td>
</tr>
</tbody>
</table>
<h3 id="cycles">Cycles</h3>
<p>The fantasy hardware simulates CPU cycles. A cycle a fixed time duration that can be used to compute things. In Retro Game Creator each instructions cost a number of cycles that follow a set of rules.</p>
<ul>
<li>1 cycle per instruction,</li>
<li>1 cycle for reading the value of a variable,</li>
<li>1 cycle per operator in expression evaluation,</li>
<li>1 cycle per array item creation,</li>
<li>1 cycle per function execution,</li>
<li>1 cycle per literals evaluation,</li>
<li>1 cycle per label read as value,</li>
<li>1 cycle per command execution,</li>
<li>8 cycles for copying sound data for each sound play,</li>
<li>1 cycle per character for string creation, modification, concatenation,</li>
<li>1 cycle per byte for memory copy or modification (except <code>DMA COPY</code>),</li>
<li>almost 1/32 cycle per byte copied using <code>DMA COPY</code>,</li>
<li>2 cycles per cells modification including text.</li>
</ul>
<p>Limit of cycles a program can execute:</p>
<ul>
<li>52668 per frames</li>
</ul>
<p>During interrupt, additional limits are also applied:</p>
<ul>
<li>3420 for VBL interrupt</li>
<li>204 per line for RASTER interrupt</li>
<li>51 per particle for PARTICLE interrupt</li>
<li>102 per emitter for EMITTER interrupt</li>
</ul>
<h3 id="number-limits">Number limits</h3>
<p>Retro Game Creator internally store numbers as üåê<a href="https://en.wikipedia.org/wiki/IEEE_754">floating point</a> on 32 bits.</p>
<p>This enough to store integers values (-16777216..16777216) with a 1 to 1 precision.</p>
<p>With lower or bigger numbers, precision will decrease, making those number equal.</p>
<pre><code><span class="hljs-keyword">if</span> <span class="hljs-number">16777216</span>=<span class="hljs-number">16777217</span> <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">print</span> <span class="hljs-string">"yes"</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">print</span> <span class="hljs-string">"no"</span>
<span class="hljs-keyword">end</span> <span class="hljs-keyword">if</span>
</code></pre><p>With floating-point numbers, the maximum precision varies depending on the magnitude of the number.</p>
<pre><code>print <span class="hljs-number">4.000000299</span>=<span class="hljs-number">4</span>
print <span class="hljs-number">4.000000300</span>&lt;&gt;<span class="hljs-number">4</span>

print <span class="hljs-number">1.0000000599</span>=<span class="hljs-number">1</span>
print <span class="hljs-number">1.0000000600</span>&lt;&gt;<span class="hljs-number">1</span>

print <span class="hljs-number">0.000000235</span>=<span class="hljs-number">0</span>
print <span class="hljs-number">0.000000239</span>&lt;&gt;<span class="hljs-number">0</span>
</code></pre><h3 id="language-limits">Language limits</h3>
<ol>
<li><p>16384 max tokens per program.</p>
<p> A token is one identifier, one number or one symblols.</p>
</li>
<li><p>2048 max symbols per program.</p>
<p> A symbol is an identifier that was defined by the user: a variable, procedure or label name.</p>
</li>
<li><p>20 max characters per identifier</p>
</li>
<li><p>128 max jump stack.</p>
<p> The jump stack is increased at each <code>GOSUB</code> but also internally by the commands <code>IF</code>, <code>ELSE</code>, <code>FOR</code>, <code>DO</code>, <code>WHILE</code> and <code>UNTIL</code>.</p>
<p> The jump stack is decreased at each <code>RETURN</code> and internally by the same commands as above.</p>
</li>
<li><p>256 max labels declared.</p>
</li>
<li><p>256 max procedures declared.</p>
</li>
<li><p>256 max number or string variables.</p>
</li>
<li><p>256 max number or string array variables.</p>
</li>
<li><p>4 max dimensions per array.</p>
</li>
<li><p>32768 max items per array in all dimensions.</p>
</li>
</ol>















</body>
</html>
